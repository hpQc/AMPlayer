(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const Au="./assets/amll_lyric_bg-Dy4VPaCX.wasm",Su=async(i={},t)=>{let e;if(t.startsWith("data:")){const r=t.replace(/^data:.*?base64,/,"");let s;if(typeof Buffer=="function"&&typeof Buffer.from=="function")s=Buffer.from(r,"base64");else if(typeof atob=="function"){const n=atob(r);s=new Uint8Array(n.length);for(let a=0;a<n.length;a++)s[a]=n.charCodeAt(a)}else throw new Error("Cannot decode base64-encoded data URL");e=await WebAssembly.instantiate(s,i)}else{const r=await fetch(t),s=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&s.startsWith("application/wasm"))e=await WebAssembly.instantiateStreaming(r,i);else{const n=await r.arrayBuffer();e=await WebAssembly.instantiate(n,i)}}return e.instance.exports};let K;function sh(i){K=i}const fe=new Array(128).fill(void 0);fe.push(void 0,null,!0,!1);function nt(i){return fe[i]}let Nr=fe.length;function Mu(i){i<132||(fe[i]=Nr,Nr=i)}function le(i){const t=nt(i);return Mu(i),t}function St(i){Nr===fe.length&&fe.push(fe.length+1);const t=Nr;return Nr=fe[t],fe[t]=i,t}const Iu=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let nh=new Iu("utf-8",{ignoreBOM:!0,fatal:!0});nh.decode();let Xr=null;function mi(){return(Xr===null||Xr.byteLength===0)&&(Xr=new Uint8Array(K.memory.buffer)),Xr}function ee(i,t){return i=i>>>0,nh.decode(mi().subarray(i,i+t))}let te=0;const Ru=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let gi=new Ru("utf-8");const Cu=typeof gi.encodeInto=="function"?function(i,t){return gi.encodeInto(i,t)}:function(i,t){const e=gi.encode(i);return t.set(e),{read:i.length,written:e.length}};function ge(i,t,e){if(e===void 0){const o=gi.encode(i),h=t(o.length,1)>>>0;return mi().subarray(h,h+o.length).set(o),te=o.length,h}let r=i.length,s=t(r,1)>>>0;const n=mi();let a=0;for(;a<r;a++){const o=i.charCodeAt(a);if(o>127)break;n[s+a]=o}if(a!==r){a!==0&&(i=i.slice(a)),s=e(s,r,r=a+i.length*3,1)>>>0;const o=mi().subarray(s+a,s+r),h=Cu(i,o);a+=h.written,s=e(s,r,a,1)>>>0}return te=a,s}function Ur(i){return i==null}let Ze=null;function It(){return(Ze===null||Ze.buffer.detached===!0||Ze.buffer.detached===void 0&&Ze.buffer!==K.memory.buffer)&&(Ze=new DataView(K.memory.buffer)),Ze}function cn(i){const t=typeof i;if(t=="number"||t=="boolean"||i==null)return`${i}`;if(t=="string")return`"${i}"`;if(t=="symbol"){const s=i.description;return s==null?"Symbol":`Symbol(${s})`}if(t=="function"){const s=i.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(i)){const s=i.length;let n="[";s>0&&(n+=cn(i[0]));for(let a=1;a<s;a++)n+=", "+cn(i[a]);return n+="]",n}const e=/\[object ([^\]]+)\]/.exec(toString.call(i));let r;if(e.length>1)r=e[1];else return toString.call(i);if(r=="Object")try{return"Object("+JSON.stringify(i)+")"}catch{return"Object"}return i instanceof Error?`${i.name}: ${i.message}
${i.stack}`:r}function Lu(i){let t,e;try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.stringifyAss(n,St(i));var r=It().getInt32(n+0,!0),s=It().getInt32(n+4,!0);return t=r,e=s,ee(r,s)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,e,1)}}function Fu(i){let t,e;try{const n=K.__wbindgen_add_to_stack_pointer(-16),a=ge(i,K.__wbindgen_malloc,K.__wbindgen_realloc),o=te;K.decryptQrcHex(n,a,o);var r=It().getInt32(n+0,!0),s=It().getInt32(n+4,!0);return t=r,e=s,ee(r,s)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,e,1)}}function Pu(i){const t=ge(i,K.__wbindgen_malloc,K.__wbindgen_realloc),e=te,r=K.parseEslrc(t,e);return le(r)}function Nu(i){let t,e;try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.stringifyEslrc(n,St(i));var r=It().getInt32(n+0,!0),s=It().getInt32(n+4,!0);return t=r,e=s,ee(r,s)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,e,1)}}function ah(i){const t=ge(i,K.__wbindgen_malloc,K.__wbindgen_realloc),e=te,r=K.parseLrc(t,e);return le(r)}function Ou(i){let t,e;try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.stringifyLrc(n,St(i));var r=It().getInt32(n+0,!0),s=It().getInt32(n+4,!0);return t=r,e=s,ee(r,s)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,e,1)}}function oh(i){const t=ge(i,K.__wbindgen_malloc,K.__wbindgen_realloc),e=te,r=K.parseLys(t,e);return le(r)}function Bu(i){let t,e;try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.stringifyLys(n,St(i));var r=It().getInt32(n+0,!0),s=It().getInt32(n+4,!0);return t=r,e=s,ee(r,s)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,e,1)}}function hh(i){const t=ge(i,K.__wbindgen_malloc,K.__wbindgen_realloc),e=te,r=K.parseQrc(t,e);return le(r)}function ku(i){let t,e;try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.stringifyQrc(n,St(i));var r=It().getInt32(n+0,!0),s=It().getInt32(n+4,!0);return t=r,e=s,ee(r,s)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,e,1)}}function On(i){const t=ge(i,K.__wbindgen_malloc,K.__wbindgen_realloc),e=te,r=K.parseTTML(t,e);return le(r)}function Du(i){let t,e;try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.stringifyTTML(n,St(i));var r=It().getInt32(n+0,!0),s=It().getInt32(n+4,!0);return t=r,e=s,ee(r,s)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,e,1)}}function lh(i){const t=ge(i,K.__wbindgen_malloc,K.__wbindgen_realloc),e=te,r=K.parseYrc(t,e);return le(r)}function Uu(i){let t,e;try{const n=K.__wbindgen_add_to_stack_pointer(-16);K.stringifyYrc(n,St(i));var r=It().getInt32(n+0,!0),s=It().getInt32(n+4,!0);return t=r,e=s,ee(r,s)}finally{K.__wbindgen_add_to_stack_pointer(16),K.__wbindgen_free(t,e,1)}}function Gu(){K.wasm_start()}function Bn(i,t){try{return i.apply(this,t)}catch(e){K.__wbindgen_exn_store(St(e))}}function uh(i){le(i)}function ch(i){return typeof nt(i)=="bigint"}function dh(i){const t=BigInt.asUintN(64,i);return St(t)}function fh(i,t){return nt(i)===nt(t)}function ph(i,t){const e=new Error(ee(i,t));return St(e)}function mh(i){const t=nt(i);return typeof t=="object"&&t!==null}function gh(i){return nt(i)===void 0}function yh(i,t){return nt(i)in nt(t)}function _h(i,t){const e=nt(t),r=typeof e=="string"?e:void 0;var s=Ur(r)?0:ge(r,K.__wbindgen_malloc,K.__wbindgen_realloc),n=te;It().setInt32(i+4,n,!0),It().setInt32(i+0,s,!0)}function vh(i){const t=nt(i);return typeof t=="boolean"?t?1:0:2}function bh(i,t){return nt(i)==nt(t)}function xh(i,t){const e=nt(t),r=typeof e=="number"?e:void 0;It().setFloat64(i+8,Ur(r)?0:r,!0),It().setInt32(i+0,!Ur(r),!0)}function wh(i){return+nt(i)}function Th(i){return St(i)}function Eh(i){const t=nt(i);return St(t)}function Ah(i,t){const e=ee(i,t);return St(e)}function Sh(i,t){const e=nt(i)[nt(t)];return St(e)}function Mh(i,t,e){nt(i)[le(t)]=le(e)}function Ih(){return Bn(function(i,t){const e=nt(i).call(nt(t));return St(e)},arguments)}function Rh(i,t){const e=nt(i)[t>>>0];return St(e)}function Ch(i){return nt(i).length}function Lh(){const i=new Array;return St(i)}function Fh(i){return typeof nt(i)=="function"}function Ph(i){const t=nt(i).next;return St(t)}function Nh(){return Bn(function(i){const t=nt(i).next();return St(t)},arguments)}function Oh(i){return nt(i).done}function Bh(i){const t=nt(i).value;return St(t)}function kh(){return St(Symbol.iterator)}function Dh(){return Bn(function(i,t){const e=Reflect.get(nt(i),nt(t));return St(e)},arguments)}function Uh(){const i=new Object;return St(i)}function Gh(i,t,e){nt(i)[t>>>0]=le(e)}function $h(i){return Array.isArray(nt(i))}function Vh(i){let t;try{t=nt(i)instanceof ArrayBuffer}catch{t=!1}return t}function zh(i){return Number.isSafeInteger(nt(i))}function Hh(i){const t=nt(i).buffer;return St(t)}function qh(i){const t=new Uint8Array(nt(i));return St(t)}function Xh(i,t,e){nt(i).set(nt(t),e>>>0)}function jh(i){return nt(i).length}function Wh(i){let t;try{t=nt(i)instanceof Uint8Array}catch{t=!1}return t}function Yh(i,t){const e=nt(t),r=typeof e=="bigint"?e:void 0;It().setBigInt64(i+8,Ur(r)?BigInt(0):r,!0),It().setInt32(i+0,!Ur(r),!0)}function Kh(i,t){const e=cn(nt(t)),r=ge(e,K.__wbindgen_malloc,K.__wbindgen_realloc),s=te;It().setInt32(i+4,s,!0),It().setInt32(i+0,r,!0)}function Zh(i,t){throw new Error(ee(i,t))}function Jh(){const i=K.memory;return St(i)}URL=globalThis.URL;const Lt=await Su({"./amll_lyric_bg.js":{__wbindgen_object_drop_ref:uh,__wbindgen_is_bigint:ch,__wbindgen_bigint_from_u64:dh,__wbindgen_jsval_eq:fh,__wbindgen_error_new:ph,__wbindgen_is_object:mh,__wbindgen_is_undefined:gh,__wbindgen_in:yh,__wbindgen_string_get:_h,__wbindgen_boolean_get:vh,__wbindgen_jsval_loose_eq:bh,__wbindgen_number_get:xh,__wbindgen_as_number:wh,__wbindgen_number_new:Th,__wbindgen_object_clone_ref:Eh,__wbindgen_string_new:Ah,__wbg_getwithrefkey_edc2c8960f0f1191:Sh,__wbg_set_f975102236d3c502:Mh,__wbg_call_1084a111329e68ce:Ih,__wbg_get_3baa728f9d58d3f6:Rh,__wbg_length_ae22078168b726f5:Ch,__wbg_new_a220cf903aa02ca2:Lh,__wbindgen_is_function:Fh,__wbg_next_de3e9db4440638b2:Ph,__wbg_next_f9cb570345655b9a:Nh,__wbg_done_bfda7aa8f252b39f:Oh,__wbg_value_6d39332ab4788d86:Bh,__wbg_iterator_888179a48810a9fe:kh,__wbg_get_224d16597dbbfd96:Dh,__wbg_new_525245e2b9901204:Uh,__wbg_set_673dda6c73d19609:Gh,__wbg_isArray_8364a5371e9737d8:$h,__wbg_instanceof_ArrayBuffer_61dfc3198373c902:Vh,__wbg_isSafeInteger_7f1ed56200d90674:zh,__wbg_buffer_b7b08af79b0b0974:Hh,__wbg_new_ea1883e1e5e86686:qh,__wbg_set_d1e79e2388520f18:Xh,__wbg_length_8339fcf5d8ecd12e:jh,__wbg_instanceof_Uint8Array_247a91427532499e:Wh,__wbindgen_bigint_get_as_i64:Yh,__wbindgen_debug_string:Kh,__wbindgen_throw:Zh,__wbindgen_memory:Jh}},Au),$u=Lt.memory,Vu=Lt.stringifyAss,zu=Lt.decryptQrcHex,Hu=Lt.parseEslrc,qu=Lt.stringifyEslrc,Xu=Lt.parseLrc,ju=Lt.stringifyLrc,Wu=Lt.parseLys,Yu=Lt.stringifyLys,Ku=Lt.parseQrc,Zu=Lt.stringifyQrc,Ju=Lt.parseTTML,Qu=Lt.stringifyTTML,tc=Lt.parseYrc,ec=Lt.stringifyYrc,rc=Lt.wasm_start,ic=Lt.__wbindgen_malloc,sc=Lt.__wbindgen_realloc,nc=Lt.__wbindgen_add_to_stack_pointer,ac=Lt.__wbindgen_free,oc=Lt.__wbindgen_exn_store,Qh=Lt.__wbindgen_start,hc=Object.freeze(Object.defineProperty({__proto__:null,__wbindgen_add_to_stack_pointer:nc,__wbindgen_exn_store:oc,__wbindgen_free:ac,__wbindgen_malloc:ic,__wbindgen_realloc:sc,__wbindgen_start:Qh,decryptQrcHex:zu,memory:$u,parseEslrc:Hu,parseLrc:Xu,parseLys:Wu,parseQrc:Ku,parseTTML:Ju,parseYrc:tc,stringifyAss:Vu,stringifyEslrc:qu,stringifyLrc:ju,stringifyLys:Yu,stringifyQrc:Zu,stringifyTTML:Qu,stringifyYrc:ec,wasm_start:rc},Symbol.toStringTag,{value:"Module"}));sh(hc);Qh();const lc=Object.freeze(Object.defineProperty({__proto__:null,__wbg_buffer_b7b08af79b0b0974:Hh,__wbg_call_1084a111329e68ce:Ih,__wbg_done_bfda7aa8f252b39f:Oh,__wbg_get_224d16597dbbfd96:Dh,__wbg_get_3baa728f9d58d3f6:Rh,__wbg_getwithrefkey_edc2c8960f0f1191:Sh,__wbg_instanceof_ArrayBuffer_61dfc3198373c902:Vh,__wbg_instanceof_Uint8Array_247a91427532499e:Wh,__wbg_isArray_8364a5371e9737d8:$h,__wbg_isSafeInteger_7f1ed56200d90674:zh,__wbg_iterator_888179a48810a9fe:kh,__wbg_length_8339fcf5d8ecd12e:jh,__wbg_length_ae22078168b726f5:Ch,__wbg_new_525245e2b9901204:Uh,__wbg_new_a220cf903aa02ca2:Lh,__wbg_new_ea1883e1e5e86686:qh,__wbg_next_de3e9db4440638b2:Ph,__wbg_next_f9cb570345655b9a:Nh,__wbg_set_673dda6c73d19609:Gh,__wbg_set_d1e79e2388520f18:Xh,__wbg_set_f975102236d3c502:Mh,__wbg_set_wasm:sh,__wbg_value_6d39332ab4788d86:Bh,__wbindgen_as_number:wh,__wbindgen_bigint_from_u64:dh,__wbindgen_bigint_get_as_i64:Yh,__wbindgen_boolean_get:vh,__wbindgen_debug_string:Kh,__wbindgen_error_new:ph,__wbindgen_in:yh,__wbindgen_is_bigint:ch,__wbindgen_is_function:Fh,__wbindgen_is_object:mh,__wbindgen_is_undefined:gh,__wbindgen_jsval_eq:fh,__wbindgen_jsval_loose_eq:bh,__wbindgen_memory:Jh,__wbindgen_number_get:xh,__wbindgen_number_new:Th,__wbindgen_object_clone_ref:Eh,__wbindgen_object_drop_ref:uh,__wbindgen_string_get:_h,__wbindgen_string_new:Ah,__wbindgen_throw:Zh,decryptQrcHex:Fu,parseEslrc:Pu,parseLrc:ah,parseLys:oh,parseQrc:hh,parseTTML:On,parseYrc:lh,stringifyAss:Lu,stringifyEslrc:Nu,stringifyLrc:Ou,stringifyLys:Bu,stringifyQrc:ku,stringifyTTML:Du,stringifyYrc:Uu,wasm_start:Gu},Symbol.toStringTag,{value:"Module"}));/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.20.0
 * @author George Michael Brower
 * @license MIT
 */class ae{constructor(t,e,r,s,n="div"){this.parent=t,this.object=e,this.property=r,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(n),this.domElement.classList.add("controller"),this.domElement.classList.add(s),this.$name=document.createElement("div"),this.$name.classList.add("name"),ae.nextNameID=ae.nextNameID||0,this.$name.id=`lil-gui-name-${++ae.nextNameID}`,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",a=>a.stopPropagation()),this.domElement.addEventListener("keyup",a=>a.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(r)}name(t){return this._name=t,this.$name.textContent=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled?this:(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t),this)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.getValue()!==t&&(this.object[this.property]=t,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class uc extends ae{constructor(t,e,r){super(t,e,r,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function dn(i){let t,e;return(t=i.match(/(#|0x)?([a-f0-9]{6})/i))?e=t[2]:(t=i.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?e=parseInt(t[1]).toString(16).padStart(2,0)+parseInt(t[2]).toString(16).padStart(2,0)+parseInt(t[3]).toString(16).padStart(2,0):(t=i.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(e=t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),e?"#"+e:!1}const cc={isPrimitive:!0,match:i=>typeof i=="string",fromHexString:dn,toHexString:dn},Gr={isPrimitive:!0,match:i=>typeof i=="number",fromHexString:i=>parseInt(i.substring(1),16),toHexString:i=>"#"+i.toString(16).padStart(6,0)},dc={isPrimitive:!1,match:i=>Array.isArray(i),fromHexString(i,t,e=1){const r=Gr.fromHexString(i);t[0]=(r>>16&255)/255*e,t[1]=(r>>8&255)/255*e,t[2]=(r&255)/255*e},toHexString([i,t,e],r=1){r=255/r;const s=i*r<<16^t*r<<8^e*r<<0;return Gr.toHexString(s)}},fc={isPrimitive:!1,match:i=>Object(i)===i,fromHexString(i,t,e=1){const r=Gr.fromHexString(i);t.r=(r>>16&255)/255*e,t.g=(r>>8&255)/255*e,t.b=(r&255)/255*e},toHexString({r:i,g:t,b:e},r=1){r=255/r;const s=i*r<<16^t*r<<8^e*r<<0;return Gr.toHexString(s)}},pc=[cc,Gr,dc,fc];function mc(i){return pc.find(t=>t.match(i))}class gc extends ae{constructor(t,e,r,s){super(t,e,r,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=mc(this.initialValue),this._rgbScale=s,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const n=dn(this.$text.value);n&&this._setValueFromHexString(n)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Ji extends ae{constructor(t,e,r){super(t,e,r,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",s=>{s.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class yc extends ae{constructor(t,e,r,s,n,a){super(t,e,r,"number"),this._initInput(),this.min(s),this.max(n);const o=a!==void 0;this.step(o?a:this._getImplicitStep(),o),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=e*100+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=()=>{let _=parseFloat(this.$input.value);isNaN(_)||(this._stepExplicit&&(_=this._snap(_)),this.setValue(this._clamp(_)))},r=_=>{const x=parseFloat(this.$input.value);isNaN(x)||(this._snapClampSetValue(x+_),this.$input.value=this.getValue())},s=_=>{_.key==="Enter"&&this.$input.blur(),_.code==="ArrowUp"&&(_.preventDefault(),r(this._step*this._arrowKeyMultiplier(_))),_.code==="ArrowDown"&&(_.preventDefault(),r(this._step*this._arrowKeyMultiplier(_)*-1))},n=_=>{this._inputFocused&&(_.preventDefault(),r(this._step*this._normalizeMouseWheel(_)))};let a=!1,o,h,l,u,c;const f=5,p=_=>{o=_.clientX,h=l=_.clientY,a=!0,u=this.getValue(),c=0,window.addEventListener("mousemove",g),window.addEventListener("mouseup",y)},g=_=>{if(a){const x=_.clientX-o,E=_.clientY-h;Math.abs(E)>f?(_.preventDefault(),this.$input.blur(),a=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(x)>f&&y()}if(!a){const x=_.clientY-l;c-=x*this._step*this._arrowKeyMultiplier(_),u+c>this._max?c=this._max-u:u+c<this._min&&(c=this._min-u),this._snapClampSetValue(u+c)}l=_.clientY},y=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",y)},d=()=>{this._inputFocused=!0},m=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",e),this.$input.addEventListener("keydown",s),this.$input.addEventListener("wheel",n,{passive:!1}),this.$input.addEventListener("mousedown",p),this.$input.addEventListener("focus",d),this.$input.addEventListener("blur",m)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=(m,_,x,E,v)=>(m-_)/(x-_)*(v-E)+E,e=m=>{const _=this.$slider.getBoundingClientRect();let x=t(m,_.left,_.right,this._min,this._max);this._snapClampSetValue(x)},r=m=>{this._setDraggingStyle(!0),e(m.clientX),window.addEventListener("mousemove",s),window.addEventListener("mouseup",n)},s=m=>{e(m.clientX)},n=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",n)};let a=!1,o,h;const l=m=>{m.preventDefault(),this._setDraggingStyle(!0),e(m.touches[0].clientX),a=!1},u=m=>{m.touches.length>1||(this._hasScrollBar?(o=m.touches[0].clientX,h=m.touches[0].clientY,a=!0):l(m),window.addEventListener("touchmove",c,{passive:!1}),window.addEventListener("touchend",f))},c=m=>{if(a){const _=m.touches[0].clientX-o,x=m.touches[0].clientY-h;Math.abs(_)>Math.abs(x)?l(m):(window.removeEventListener("touchmove",c),window.removeEventListener("touchend",f))}else m.preventDefault(),e(m.touches[0].clientX)},f=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",f)},p=this._callOnFinishChange.bind(this),g=400;let y;const d=m=>{if(Math.abs(m.deltaX)<Math.abs(m.deltaY)&&this._hasScrollBar)return;m.preventDefault();const x=this._normalizeMouseWheel(m)*this._step;this._snapClampSetValue(this.getValue()+x),this.$input.value=this.getValue(),clearTimeout(y),y=setTimeout(p,g)};this.$slider.addEventListener("mousedown",r),this.$slider.addEventListener("touchstart",u,{passive:!1}),this.$slider.addEventListener("wheel",d,{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:r}=t;return Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,r=-t.wheelDelta/120,r*=this._stepExplicit?1:10),e+-r}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){let e=0;return this._hasMin?e=this._min:this._hasMax&&(e=this._max),t-=e,t=Math.round(t/this._step)*this._step,t+=e,t=parseFloat(t.toPrecision(15)),t}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class _c extends ae{constructor(t,e,r,s){super(t,e,r,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(s)}options(t){return this._values=Array.isArray(t)?t:Object.values(t),this._names=Array.isArray(t)?t:Object.keys(t),this.$select.replaceChildren(),this._names.forEach(e=>{const r=document.createElement("option");r.textContent=e,this.$select.appendChild(r)}),this.updateDisplay(),this}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.textContent=e===-1?t:this._names[e],this}}class vc extends ae{constructor(t,e,r){super(t,e,r,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",s=>{s.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}var bc=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
  background: var(--background-color);
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "↕";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  font-weight: 600;
  padding: 0 var(--padding);
  width: 100%;
  text-align: left;
  background: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "▾";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "▸";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui label, .lil-gui input, .lil-gui button {
  -webkit-tap-highlight-color: transparent;
}
.lil-gui input {
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
  -moz-appearance: textfield;
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input[type=checkbox] {
  appearance: none;
  width: var(--checkbox-size);
  height: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "✓";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  border: none;
}
.lil-gui .controller button {
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
}
@media (hover: hover) {
  .lil-gui .controller button:hover {
    background: var(--hover-color);
  }
  .lil-gui .controller button:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui .controller button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`;function xc(i){const t=document.createElement("style");t.innerHTML=i;const e=document.querySelector("head link[rel=stylesheet], head style");e?document.head.insertBefore(t,e):document.head.appendChild(t)}let ha=!1;class kn{constructor({parent:t,autoPlace:e=t===void 0,container:r,width:s,title:n="Controls",closeFolders:a=!1,injectStyles:o=!0,touchStyles:h=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("button"),this.$title.classList.add("title"),this.$title.setAttribute("aria-expanded",!0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(n),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),h&&this.domElement.classList.add("allow-touch-styles"),!ha&&o&&(xc(bc),ha=!0),r?r.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),s&&this.domElement.style.setProperty("--width",s+"px"),this._closeFolders=a}add(t,e,r,s,n){if(Object(r)===r)return new _c(this,t,e,r);const a=t[e];switch(typeof a){case"number":return new yc(this,t,e,r,s,n);case"boolean":return new uc(this,t,e);case"string":return new vc(this,t,e);case"function":return new Ji(this,t,e)}console.error(`gui.add failed
	property:`,e,`
	object:`,t,`
	value:`,a)}addColor(t,e,r=1){return new gc(this,t,e,r)}addFolder(t){const e=new kn({parent:this,title:t});return this.root._closeFolders&&e.close(),e}load(t,e=!0){return t.controllers&&this.controllers.forEach(r=>{r instanceof Ji||r._name in t.controllers&&r.load(t.controllers[r._name])}),e&&t.folders&&this.folders.forEach(r=>{r._title in t.folders&&r.load(t.folders[r._title])}),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach(r=>{if(!(r instanceof Ji)){if(r._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${r._name}"`);e.controllers[r._name]=r.save()}}),t&&this.folders.forEach(r=>{if(r._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${r._title}"`);e.folders[r._title]=r.save()}),e}open(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(t){this._closed!==t&&(this._closed=t,this._callOnOpenClose(this))}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const r=n=>{n.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",r))};this.$children.addEventListener("transitionend",r);const s=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame(()=>{this.$children.style.height=s+"px"})}),this}title(t){return this._title=t,this.$title.textContent=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach(r=>r.reset()),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),this._onChange!==void 0&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onOpenClose(t){return this._onOpenClose=t,this}_callOnOpenClose(t){this.parent&&this.parent._callOnOpenClose(t),this._onOpenClose!==void 0&&this._onOpenClose.call(this,t)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(t=>t.destroy())}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach(e=>{t=t.concat(e.controllersRecursive())}),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach(e=>{t=t.concat(e.foldersRecursive())}),t}}var Ei=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tl(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function wc(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var t=i.default;if(typeof t=="function"){var e=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var s=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:function(){return i[r]}})}),e}var yi={exports:{}},Tc=yi.exports,la;function Ec(){return la||(la=1,function(i,t){(function(e,r){i.exports=r()})(Tc,function(){var e=function(){function r(p){return a.appendChild(p.dom),p}function s(p){for(var g=0;g<a.children.length;g++)a.children[g].style.display=g===p?"block":"none";n=p}var n=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(p){p.preventDefault(),s(++n%a.children.length)},!1);var o=(performance||Date).now(),h=o,l=0,u=r(new e.Panel("FPS","#0ff","#002")),c=r(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=r(new e.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:a,addPanel:r,showPanel:s,begin:function(){o=(performance||Date).now()},end:function(){l++;var p=(performance||Date).now();if(c.update(p-o,200),p>h+1e3&&(u.update(1e3*l/(p-h),100),h=p,l=0,f)){var g=performance.memory;f.update(g.usedJSHeapSize/1048576,g.jsHeapSizeLimit/1048576)}return p},update:function(){o=this.end()},domElement:a,setMode:s}};return e.Panel=function(r,s,n){var a=1/0,o=0,h=Math.round,l=h(window.devicePixelRatio||1),u=80*l,c=48*l,f=3*l,p=2*l,g=3*l,y=15*l,d=74*l,m=30*l,_=document.createElement("canvas");_.width=u,_.height=c,_.style.cssText="width:80px;height:48px";var x=_.getContext("2d");return x.font="bold "+9*l+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=n,x.fillRect(0,0,u,c),x.fillStyle=s,x.fillText(r,f,p),x.fillRect(g,y,d,m),x.fillStyle=n,x.globalAlpha=.9,x.fillRect(g,y,d,m),{dom:_,update:function(E,v){a=Math.min(a,E),o=Math.max(o,E),x.fillStyle=n,x.globalAlpha=1,x.fillRect(0,0,u,y),x.fillStyle=s,x.fillText(h(E)+" "+r+" ("+h(a)+"-"+h(o)+")",f,p),x.drawImage(_,g+l,y,d-l,m,g,y,d-l,m),x.fillRect(g+d-l,y,l,m),x.fillStyle=n,x.globalAlpha=.9,x.fillRect(g+d-l,y,l,h((1-E/v)*m))}}},e})}(yi)),yi.exports}var Ac=Ec();const Sc=tl(Ac);var ze=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(ze||{}),el=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(el||{}),fn=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(fn||{}),st=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(st||{}),Ai=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(Ai||{}),X=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(X||{}),fr=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(fr||{}),ht=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(ht||{}),W=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(W||{}),pe=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(pe||{}),Dn=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Dn||{}),Ge=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(Ge||{}),He=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(He||{}),ne=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(ne||{}),Un=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(Un||{}),qt=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(qt||{}),Ot=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(Ot||{}),Pt=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(Pt||{}),oe=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(oe||{});const Mc={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},ft={ADAPTER:Mc,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Qi=/iPhone/i,ua=/iPod/i,ca=/iPad/i,da=/\biOS-universal(?:.+)Mac\b/i,ts=/\bAndroid(?:.+)Mobile\b/i,fa=/Android/i,Je=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,jr=/Silk/i,ue=/Windows Phone/i,pa=/\bWindows(?:.+)ARM\b/i,ma=/BlackBerry/i,ga=/BB10/i,ya=/Opera Mini/i,_a=/\b(CriOS|Chrome)(?:.+)Mobile/i,va=/Mobile(?:.+)Firefox\b/i,ba=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function Ic(i){return function(t){return t.test(i)}}function xa(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var s=Ic(e),n={apple:{phone:s(Qi)&&!s(ue),ipod:s(ua),tablet:!s(Qi)&&(s(ca)||ba(t))&&!s(ue),universal:s(da),device:(s(Qi)||s(ua)||s(ca)||s(da)||ba(t))&&!s(ue)},amazon:{phone:s(Je),tablet:!s(Je)&&s(jr),device:s(Je)||s(jr)},android:{phone:!s(ue)&&s(Je)||!s(ue)&&s(ts),tablet:!s(ue)&&!s(Je)&&!s(ts)&&(s(jr)||s(fa)),device:!s(ue)&&(s(Je)||s(jr)||s(ts)||s(fa))||s(/\bokhttp\b/i)},windows:{phone:s(ue),tablet:s(pa),device:s(ue)||s(pa)},other:{blackberry:s(ma),blackberry10:s(ga),opera:s(ya),firefox:s(va),chrome:s(_a),device:s(ma)||s(ga)||s(ya)||s(va)||s(_a)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Rc=xa.default??xa,ur=Rc(globalThis.navigator);ft.RETINA_PREFIX=/@([0-9\.]+)x/;ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var es={exports:{}},wa;function Cc(){return wa||(wa=1,function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function s(h,l,u){this.fn=h,this.context=l,this.once=u||!1}function n(h,l,u,c,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new s(u,c||h,f),g=e?e+l:l;return h._events[g]?h._events[g].fn?h._events[g]=[h._events[g],p]:h._events[g].push(p):(h._events[g]=p,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new r:delete h._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],u,c;if(this._eventsCount===0)return l;for(c in u=this._events)t.call(u,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},o.prototype.listeners=function(l){var u=e?e+l:l,c=this._events[u];if(!c)return[];if(c.fn)return[c.fn];for(var f=0,p=c.length,g=new Array(p);f<p;f++)g[f]=c[f].fn;return g},o.prototype.listenerCount=function(l){var u=e?e+l:l,c=this._events[u];return c?c.fn?1:c.length:0},o.prototype.emit=function(l,u,c,f,p,g){var y=e?e+l:l;if(!this._events[y])return!1;var d=this._events[y],m=arguments.length,_,x;if(d.fn){switch(d.once&&this.removeListener(l,d.fn,void 0,!0),m){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,u),!0;case 3:return d.fn.call(d.context,u,c),!0;case 4:return d.fn.call(d.context,u,c,f),!0;case 5:return d.fn.call(d.context,u,c,f,p),!0;case 6:return d.fn.call(d.context,u,c,f,p,g),!0}for(x=1,_=new Array(m-1);x<m;x++)_[x-1]=arguments[x];d.fn.apply(d.context,_)}else{var E=d.length,v;for(x=0;x<E;x++)switch(d[x].once&&this.removeListener(l,d[x].fn,void 0,!0),m){case 1:d[x].fn.call(d[x].context);break;case 2:d[x].fn.call(d[x].context,u);break;case 3:d[x].fn.call(d[x].context,u,c);break;case 4:d[x].fn.call(d[x].context,u,c,f);break;default:if(!_)for(v=1,_=new Array(m-1);v<m;v++)_[v-1]=arguments[v];d[x].fn.apply(d[x].context,_)}}return!0},o.prototype.on=function(l,u,c){return n(this,l,u,c,!1)},o.prototype.once=function(l,u,c){return n(this,l,u,c,!0)},o.prototype.removeListener=function(l,u,c,f){var p=e?e+l:l;if(!this._events[p])return this;if(!u)return a(this,p),this;var g=this._events[p];if(g.fn)g.fn===u&&(!f||g.once)&&(!c||g.context===c)&&a(this,p);else{for(var y=0,d=[],m=g.length;y<m;y++)(g[y].fn!==u||f&&!g[y].once||c&&g[y].context!==c)&&d.push(g[y]);d.length?this._events[p]=d.length===1?d[0]:d:a(this,p)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&a(this,u)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,i.exports=o}(es)),es.exports}var Lc=Cc();const Bi=tl(Lc);var Wr={exports:{}},Ta;function Fc(){if(Ta)return Wr.exports;Ta=1,Wr.exports=i,Wr.exports.default=i;function i(T,S,w){w=w||2;var L=S&&S.length,M=L?S[0]*w:T.length,I=t(T,0,M,w,!0),N=[];if(!I||I.next===I.prev)return N;var F,G,$,Y,Z,J,et;if(L&&(I=h(T,S,I,w)),T.length>80*w){F=$=T[0],G=Y=T[1];for(var q=w;q<M;q+=w)Z=T[q],J=T[q+1],Z<F&&(F=Z),J<G&&(G=J),Z>$&&($=Z),J>Y&&(Y=J);et=Math.max($-F,Y-G),et=et!==0?32767/et:0}return r(I,N,w,F,G,et,0),N}function t(T,S,w,L,M){var I,N;if(M===z(T,S,w,L)>0)for(I=S;I<w;I+=L)N=P(I,T[I],T[I+1],N);else for(I=w-L;I>=S;I-=L)N=P(I,T[I],T[I+1],N);return N&&E(N,N.next)&&(j(N),N=N.next),N}function e(T,S){if(!T)return T;S||(S=T);var w=T,L;do if(L=!1,!w.steiner&&(E(w,w.next)||x(w.prev,w,w.next)===0)){if(j(w),w=S=w.prev,w===w.next)break;L=!0}else w=w.next;while(L||w!==S);return S}function r(T,S,w,L,M,I,N){if(T){!N&&I&&p(T,L,M,I);for(var F=T,G,$;T.prev!==T.next;){if(G=T.prev,$=T.next,I?n(T,L,M,I):s(T)){S.push(G.i/w|0),S.push(T.i/w|0),S.push($.i/w|0),j(T),T=$.next,F=$.next;continue}if(T=$,T===F){N?N===1?(T=a(e(T),S,w),r(T,S,w,L,M,I,2)):N===2&&o(T,S,w,L,M,I):r(e(T),S,w,L,M,I,1);break}}}}function s(T){var S=T.prev,w=T,L=T.next;if(x(S,w,L)>=0)return!1;for(var M=S.x,I=w.x,N=L.x,F=S.y,G=w.y,$=L.y,Y=M<I?M<N?M:N:I<N?I:N,Z=F<G?F<$?F:$:G<$?G:$,J=M>I?M>N?M:N:I>N?I:N,et=F>G?F>$?F:$:G>$?G:$,q=L.next;q!==S;){if(q.x>=Y&&q.x<=J&&q.y>=Z&&q.y<=et&&m(M,F,I,G,N,$,q.x,q.y)&&x(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function n(T,S,w,L){var M=T.prev,I=T,N=T.next;if(x(M,I,N)>=0)return!1;for(var F=M.x,G=I.x,$=N.x,Y=M.y,Z=I.y,J=N.y,et=F<G?F<$?F:$:G<$?G:$,q=Y<Z?Y<J?Y:J:Z<J?Z:J,rt=F>G?F>$?F:$:G>$?G:$,it=Y>Z?Y>J?Y:J:Z>J?Z:J,ut=y(et,q,S,w,L),mt=y(rt,it,S,w,L),Q=T.prevZ,tt=T.nextZ;Q&&Q.z>=ut&&tt&&tt.z<=mt;){if(Q.x>=et&&Q.x<=rt&&Q.y>=q&&Q.y<=it&&Q!==M&&Q!==N&&m(F,Y,G,Z,$,J,Q.x,Q.y)&&x(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,tt.x>=et&&tt.x<=rt&&tt.y>=q&&tt.y<=it&&tt!==M&&tt!==N&&m(F,Y,G,Z,$,J,tt.x,tt.y)&&x(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;Q&&Q.z>=ut;){if(Q.x>=et&&Q.x<=rt&&Q.y>=q&&Q.y<=it&&Q!==M&&Q!==N&&m(F,Y,G,Z,$,J,Q.x,Q.y)&&x(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;tt&&tt.z<=mt;){if(tt.x>=et&&tt.x<=rt&&tt.y>=q&&tt.y<=it&&tt!==M&&tt!==N&&m(F,Y,G,Z,$,J,tt.x,tt.y)&&x(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function a(T,S,w){var L=T;do{var M=L.prev,I=L.next.next;!E(M,I)&&v(M,L,L.next,I)&&U(M,I)&&U(I,M)&&(S.push(M.i/w|0),S.push(L.i/w|0),S.push(I.i/w|0),j(L),j(L.next),L=T=I),L=L.next}while(L!==T);return e(L)}function o(T,S,w,L,M,I){var N=T;do{for(var F=N.next.next;F!==N.prev;){if(N.i!==F.i&&_(N,F)){var G=k(N,F);N=e(N,N.next),G=e(G,G.next),r(N,S,w,L,M,I,0),r(G,S,w,L,M,I,0);return}F=F.next}N=N.next}while(N!==T)}function h(T,S,w,L){var M=[],I,N,F,G,$;for(I=0,N=S.length;I<N;I++)F=S[I]*L,G=I<N-1?S[I+1]*L:T.length,$=t(T,F,G,L,!1),$===$.next&&($.steiner=!0),M.push(d($));for(M.sort(l),I=0;I<M.length;I++)w=u(M[I],w);return w}function l(T,S){return T.x-S.x}function u(T,S){var w=c(T,S);if(!w)return S;var L=k(w,T);return e(L,L.next),e(w,w.next)}function c(T,S){var w=S,L=T.x,M=T.y,I=-1/0,N;do{if(M<=w.y&&M>=w.next.y&&w.next.y!==w.y){var F=w.x+(M-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(F<=L&&F>I&&(I=F,N=w.x<w.next.x?w:w.next,F===L))return N}w=w.next}while(w!==S);if(!N)return null;var G=N,$=N.x,Y=N.y,Z=1/0,J;w=N;do L>=w.x&&w.x>=$&&L!==w.x&&m(M<Y?L:I,M,$,Y,M<Y?I:L,M,w.x,w.y)&&(J=Math.abs(M-w.y)/(L-w.x),U(w,T)&&(J<Z||J===Z&&(w.x>N.x||w.x===N.x&&f(N,w)))&&(N=w,Z=J)),w=w.next;while(w!==G);return N}function f(T,S){return x(T.prev,T,S.prev)<0&&x(S.next,T,T.next)<0}function p(T,S,w,L){var M=T;do M.z===0&&(M.z=y(M.x,M.y,S,w,L)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==T);M.prevZ.nextZ=null,M.prevZ=null,g(M)}function g(T){var S,w,L,M,I,N,F,G,$=1;do{for(w=T,T=null,I=null,N=0;w;){for(N++,L=w,F=0,S=0;S<$&&(F++,L=L.nextZ,!!L);S++);for(G=$;F>0||G>0&&L;)F!==0&&(G===0||!L||w.z<=L.z)?(M=w,w=w.nextZ,F--):(M=L,L=L.nextZ,G--),I?I.nextZ=M:T=M,M.prevZ=I,I=M;w=L}I.nextZ=null,$*=2}while(N>1);return T}function y(T,S,w,L,M){return T=(T-w)*M|0,S=(S-L)*M|0,T=(T|T<<8)&16711935,T=(T|T<<4)&252645135,T=(T|T<<2)&858993459,T=(T|T<<1)&1431655765,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,T|S<<1}function d(T){var S=T,w=T;do(S.x<w.x||S.x===w.x&&S.y<w.y)&&(w=S),S=S.next;while(S!==T);return w}function m(T,S,w,L,M,I,N,F){return(M-N)*(S-F)>=(T-N)*(I-F)&&(T-N)*(L-F)>=(w-N)*(S-F)&&(w-N)*(I-F)>=(M-N)*(L-F)}function _(T,S){return T.next.i!==S.i&&T.prev.i!==S.i&&!B(T,S)&&(U(T,S)&&U(S,T)&&D(T,S)&&(x(T.prev,T,S.prev)||x(T,S.prev,S))||E(T,S)&&x(T.prev,T,T.next)>0&&x(S.prev,S,S.next)>0)}function x(T,S,w){return(S.y-T.y)*(w.x-S.x)-(S.x-T.x)*(w.y-S.y)}function E(T,S){return T.x===S.x&&T.y===S.y}function v(T,S,w,L){var M=b(x(T,S,w)),I=b(x(T,S,L)),N=b(x(w,L,T)),F=b(x(w,L,S));return!!(M!==I&&N!==F||M===0&&A(T,w,S)||I===0&&A(T,L,S)||N===0&&A(w,T,L)||F===0&&A(w,S,L))}function A(T,S,w){return S.x<=Math.max(T.x,w.x)&&S.x>=Math.min(T.x,w.x)&&S.y<=Math.max(T.y,w.y)&&S.y>=Math.min(T.y,w.y)}function b(T){return T>0?1:T<0?-1:0}function B(T,S){var w=T;do{if(w.i!==T.i&&w.next.i!==T.i&&w.i!==S.i&&w.next.i!==S.i&&v(w,w.next,T,S))return!0;w=w.next}while(w!==T);return!1}function U(T,S){return x(T.prev,T,T.next)<0?x(T,S,T.next)>=0&&x(T,T.prev,S)>=0:x(T,S,T.prev)<0||x(T,T.next,S)<0}function D(T,S){var w=T,L=!1,M=(T.x+S.x)/2,I=(T.y+S.y)/2;do w.y>I!=w.next.y>I&&w.next.y!==w.y&&M<(w.next.x-w.x)*(I-w.y)/(w.next.y-w.y)+w.x&&(L=!L),w=w.next;while(w!==T);return L}function k(T,S){var w=new H(T.i,T.x,T.y),L=new H(S.i,S.x,S.y),M=T.next,I=S.prev;return T.next=S,S.prev=T,w.next=M,M.prev=w,L.next=w,w.prev=L,I.next=L,L.prev=I,L}function P(T,S,w,L){var M=new H(T,S,w);return L?(M.next=L.next,M.prev=L,L.next.prev=M,L.next=M):(M.prev=M,M.next=M),M}function j(T){T.next.prev=T.prev,T.prev.next=T.next,T.prevZ&&(T.prevZ.nextZ=T.nextZ),T.nextZ&&(T.nextZ.prevZ=T.prevZ)}function H(T,S,w){this.i=T,this.x=S,this.y=w,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(T,S,w,L){var M=S&&S.length,I=M?S[0]*w:T.length,N=Math.abs(z(T,0,I,w));if(M)for(var F=0,G=S.length;F<G;F++){var $=S[F]*w,Y=F<G-1?S[F+1]*w:T.length;N-=Math.abs(z(T,$,Y,w))}var Z=0;for(F=0;F<L.length;F+=3){var J=L[F]*w,et=L[F+1]*w,q=L[F+2]*w;Z+=Math.abs((T[J]-T[q])*(T[et+1]-T[J+1])-(T[J]-T[et])*(T[q+1]-T[J+1]))}return N===0&&Z===0?0:Math.abs((Z-N)/N)};function z(T,S,w,L){for(var M=0,I=S,N=w-L;I<w;I+=L)M+=(T[N]-T[I])*(T[I+1]+T[N+1]),N=I;return M}return i.flatten=function(T){for(var S=T[0][0].length,w={vertices:[],holes:[],dimensions:S},L=0,M=0;M<T.length;M++){for(var I=0;I<T[M].length;I++)for(var N=0;N<S;N++)w.vertices.push(T[M][I][N]);M>0&&(L+=T[M-1].length,w.holes.push(L))}return w},Wr.exports}Fc();var Re={},Mr={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var Pc=Mr.exports,Ea;function Nc(){return Ea||(Ea=1,function(i,t){(function(e){var r=t&&!t.nodeType&&t,s=i&&!i.nodeType&&i,n=typeof Ei=="object"&&Ei;(n.global===n||n.window===n||n.self===n)&&(e=n);var a,o=2147483647,h=36,l=1,u=26,c=38,f=700,p=72,g=128,y="-",d=/^xn--/,m=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=h-l,v=Math.floor,A=String.fromCharCode,b;function B(M){throw new RangeError(x[M])}function U(M,I){for(var N=M.length,F=[];N--;)F[N]=I(M[N]);return F}function D(M,I){var N=M.split("@"),F="";N.length>1&&(F=N[0]+"@",M=N[1]),M=M.replace(_,".");var G=M.split("."),$=U(G,I).join(".");return F+$}function k(M){for(var I=[],N=0,F=M.length,G,$;N<F;)G=M.charCodeAt(N++),G>=55296&&G<=56319&&N<F?($=M.charCodeAt(N++),($&64512)==56320?I.push(((G&1023)<<10)+($&1023)+65536):(I.push(G),N--)):I.push(G);return I}function P(M){return U(M,function(I){var N="";return I>65535&&(I-=65536,N+=A(I>>>10&1023|55296),I=56320|I&1023),N+=A(I),N}).join("")}function j(M){return M-48<10?M-22:M-65<26?M-65:M-97<26?M-97:h}function H(M,I){return M+22+75*(M<26)-((I!=0)<<5)}function z(M,I,N){var F=0;for(M=N?v(M/f):M>>1,M+=v(M/I);M>E*u>>1;F+=h)M=v(M/E);return v(F+(E+1)*M/(M+c))}function T(M){var I=[],N=M.length,F,G=0,$=g,Y=p,Z,J,et,q,rt,it,ut,mt,Q;for(Z=M.lastIndexOf(y),Z<0&&(Z=0),J=0;J<Z;++J)M.charCodeAt(J)>=128&&B("not-basic"),I.push(M.charCodeAt(J));for(et=Z>0?Z+1:0;et<N;){for(q=G,rt=1,it=h;et>=N&&B("invalid-input"),ut=j(M.charCodeAt(et++)),(ut>=h||ut>v((o-G)/rt))&&B("overflow"),G+=ut*rt,mt=it<=Y?l:it>=Y+u?u:it-Y,!(ut<mt);it+=h)Q=h-mt,rt>v(o/Q)&&B("overflow"),rt*=Q;F=I.length+1,Y=z(G-q,F,q==0),v(G/F)>o-$&&B("overflow"),$+=v(G/F),G%=F,I.splice(G++,0,$)}return P(I)}function S(M){var I,N,F,G,$,Y,Z,J,et,q,rt,it=[],ut,mt,Q,tt;for(M=k(M),ut=M.length,I=g,N=0,$=p,Y=0;Y<ut;++Y)rt=M[Y],rt<128&&it.push(A(rt));for(F=G=it.length,G&&it.push(y);F<ut;){for(Z=o,Y=0;Y<ut;++Y)rt=M[Y],rt>=I&&rt<Z&&(Z=rt);for(mt=F+1,Z-I>v((o-N)/mt)&&B("overflow"),N+=(Z-I)*mt,I=Z,Y=0;Y<ut;++Y)if(rt=M[Y],rt<I&&++N>o&&B("overflow"),rt==I){for(J=N,et=h;q=et<=$?l:et>=$+u?u:et-$,!(J<q);et+=h)tt=J-q,Q=h-q,it.push(A(H(q+tt%Q,0))),J=v(tt/Q);it.push(A(H(J,0))),$=z(N,mt,F==G),N=0,++F}++N,++I}return it.join("")}function w(M){return D(M,function(I){return d.test(I)?T(I.slice(4).toLowerCase()):I})}function L(M){return D(M,function(I){return m.test(I)?"xn--"+S(I):I})}if(a={version:"1.4.1",ucs2:{decode:k,encode:P},decode:T,encode:S,toASCII:L,toUnicode:w},r&&s)if(i.exports==r)s.exports=a;else for(b in a)a.hasOwnProperty(b)&&(r[b]=a[b]);else e.punycode=a})(Pc)}(Mr,Mr.exports)),Mr.exports}var rs,Aa;function _r(){return Aa||(Aa=1,rs=TypeError),rs}const Oc={},Bc=Object.freeze(Object.defineProperty({__proto__:null,default:Oc},Symbol.toStringTag,{value:"Module"})),kc=wc(Bc);var is,Sa;function ki(){if(Sa)return is;Sa=1;var i=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=i&&t&&typeof t.get=="function"?t.get:null,r=i&&Map.prototype.forEach,s=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=s&&n&&typeof n.get=="function"?n.get:null,o=s&&Set.prototype.forEach,h=typeof WeakMap=="function"&&WeakMap.prototype,l=h?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,c=u?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,p=f?WeakRef.prototype.deref:null,g=Boolean.prototype.valueOf,y=Object.prototype.toString,d=Function.prototype.toString,m=String.prototype.match,_=String.prototype.slice,x=String.prototype.replace,E=String.prototype.toUpperCase,v=String.prototype.toLowerCase,A=RegExp.prototype.test,b=Array.prototype.concat,B=Array.prototype.join,U=Array.prototype.slice,D=Math.floor,k=typeof BigInt=="function"?BigInt.prototype.valueOf:null,P=Object.getOwnPropertySymbols,j=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,H=typeof Symbol=="function"&&typeof Symbol.iterator=="object",z=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===H||!0)?Symbol.toStringTag:null,T=Object.prototype.propertyIsEnumerable,S=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(C){return C.__proto__}:null);function w(C,O){if(C===1/0||C===-1/0||C!==C||C&&C>-1e3&&C<1e3||A.call(/e/,O))return O;var yt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof C=="number"){var At=C<0?-D(-C):D(C);if(At!==C){var Mt=String(At),ot=_.call(O,Mt.length+1);return x.call(Mt,yt,"$&_")+"."+x.call(x.call(ot,/([0-9]{3})/g,"$&_"),/_$/,"")}}return x.call(O,yt,"$&_")}var L=kc,M=L.custom,I=mt(M)?M:null,N={__proto__:null,double:'"',single:"'"},F={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};is=function C(O,yt,At,Mt){var ot=yt||{};if(Nt(ot,"quoteStyle")&&!Nt(N,ot.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Nt(ot,"maxStringLength")&&(typeof ot.maxStringLength=="number"?ot.maxStringLength<0&&ot.maxStringLength!==1/0:ot.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var _e=Nt(ot,"customInspect")?ot.customInspect:!0;if(typeof _e!="boolean"&&_e!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Nt(ot,"indent")&&ot.indent!==null&&ot.indent!=="	"&&!(parseInt(ot.indent,10)===ot.indent&&ot.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Nt(ot,"numericSeparator")&&typeof ot.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Ie=ot.numericSeparator;if(typeof O>"u")return"undefined";if(O===null)return"null";if(typeof O=="boolean")return O?"true":"false";if(typeof O=="string")return Jn(O,ot);if(typeof O=="number"){if(O===0)return 1/0/O>0?"0":"-0";var Vt=String(O);return Ie?w(O,Vt):Vt}if(typeof O=="bigint"){var ve=String(O)+"n";return Ie?w(O,ve):ve}var qi=typeof ot.depth>"u"?5:ot.depth;if(typeof At>"u"&&(At=0),At>=qi&&qi>0&&typeof O=="object")return Z(O)?"[Array]":"[Object]";var Ye=wu(ot,At);if(typeof Mt>"u")Mt=[];else if(ye(Mt,O)>=0)return"[Circular]";function Yt(Ke,qr,Eu){if(qr&&(Mt=U.call(Mt),Mt.push(qr)),Eu){var oa={depth:ot.depth};return Nt(ot,"quoteStyle")&&(oa.quoteStyle=ot.quoteStyle),C(Ke,oa,At+1,Mt)}return C(Ke,ot,At+1,Mt)}if(typeof O=="function"&&!et(O)){var ta=qe(O),ea=zr(O,Yt);return"[Function"+(ta?": "+ta:" (anonymous)")+"]"+(ea.length>0?" { "+B.call(ea,", ")+" }":"")}if(mt(O)){var ra=H?x.call(String(O),/^(Symbol\(.*\))_[^)]*$/,"$1"):j.call(O);return typeof O=="object"&&!H?xr(ra):ra}if(vu(O)){for(var wr="<"+v.call(String(O.nodeName)),Xi=O.attributes||[],Hr=0;Hr<Xi.length;Hr++)wr+=" "+Xi[Hr].name+"="+G($(Xi[Hr].value),"double",ot);return wr+=">",O.childNodes&&O.childNodes.length&&(wr+="..."),wr+="</"+v.call(String(O.nodeName))+">",wr}if(Z(O)){if(O.length===0)return"[]";var ji=zr(O,Yt);return Ye&&!xu(ji)?"["+Hi(ji,Ye)+"]":"[ "+B.call(ji,", ")+" ]"}if(q(O)){var Wi=zr(O,Yt);return!("cause"in Error.prototype)&&"cause"in O&&!T.call(O,"cause")?"{ ["+String(O)+"] "+B.call(b.call("[cause]: "+Yt(O.cause),Wi),", ")+" }":Wi.length===0?"["+String(O)+"]":"{ ["+String(O)+"] "+B.call(Wi,", ")+" }"}if(typeof O=="object"&&_e){if(I&&typeof O[I]=="function"&&L)return L(O,{depth:qi-At});if(_e!=="symbol"&&typeof O.inspect=="function")return O.inspect()}if(Wt(O)){var ia=[];return r&&r.call(O,function(Ke,qr){ia.push(Yt(qr,O,!0)+" => "+Yt(Ke,O))}),Qn("Map",e.call(O),ia,Ye)}if(We(O)){var sa=[];return o&&o.call(O,function(Ke){sa.push(Yt(Ke,O))}),Qn("Set",a.call(O),sa,Ye)}if(Xe(O))return zi("WeakMap");if(_u(O))return zi("WeakSet");if(je(O))return zi("WeakRef");if(it(O))return xr(Yt(Number(O)));if(Q(O))return xr(Yt(k.call(O)));if(ut(O))return xr(g.call(O));if(rt(O))return xr(Yt(String(O)));if(typeof window<"u"&&O===window)return"{ [object Window] }";if(typeof globalThis<"u"&&O===globalThis||typeof Ei<"u"&&O===Ei)return"{ [object globalThis] }";if(!J(O)&&!et(O)){var Yi=zr(O,Yt),na=S?S(O)===Object.prototype:O instanceof Object||O.constructor===Object,Ki=O instanceof Object?"":"null prototype",aa=!na&&z&&Object(O)===O&&z in O?_.call(Gt(O),8,-1):Ki?"Object":"",Tu=na||typeof O.constructor!="function"?"":O.constructor.name?O.constructor.name+" ":"",Zi=Tu+(aa||Ki?"["+B.call(b.call([],aa||[],Ki||[]),": ")+"] ":"");return Yi.length===0?Zi+"{}":Ye?Zi+"{"+Hi(Yi,Ye)+"}":Zi+"{ "+B.call(Yi,", ")+" }"}return String(O)};function G(C,O,yt){var At=yt.quoteStyle||O,Mt=N[At];return Mt+C+Mt}function $(C){return x.call(String(C),/"/g,"&quot;")}function Y(C){return!z||!(typeof C=="object"&&(z in C||typeof C[z]<"u"))}function Z(C){return Gt(C)==="[object Array]"&&Y(C)}function J(C){return Gt(C)==="[object Date]"&&Y(C)}function et(C){return Gt(C)==="[object RegExp]"&&Y(C)}function q(C){return Gt(C)==="[object Error]"&&Y(C)}function rt(C){return Gt(C)==="[object String]"&&Y(C)}function it(C){return Gt(C)==="[object Number]"&&Y(C)}function ut(C){return Gt(C)==="[object Boolean]"&&Y(C)}function mt(C){if(H)return C&&typeof C=="object"&&C instanceof Symbol;if(typeof C=="symbol")return!0;if(!C||typeof C!="object"||!j)return!1;try{return j.call(C),!0}catch{}return!1}function Q(C){if(!C||typeof C!="object"||!k)return!1;try{return k.call(C),!0}catch{}return!1}var tt=Object.prototype.hasOwnProperty||function(C){return C in this};function Nt(C,O){return tt.call(C,O)}function Gt(C){return y.call(C)}function qe(C){if(C.name)return C.name;var O=m.call(d.call(C),/^function\s*([\w$]+)/);return O?O[1]:null}function ye(C,O){if(C.indexOf)return C.indexOf(O);for(var yt=0,At=C.length;yt<At;yt++)if(C[yt]===O)return yt;return-1}function Wt(C){if(!e||!C||typeof C!="object")return!1;try{e.call(C);try{a.call(C)}catch{return!0}return C instanceof Map}catch{}return!1}function Xe(C){if(!l||!C||typeof C!="object")return!1;try{l.call(C,l);try{c.call(C,c)}catch{return!0}return C instanceof WeakMap}catch{}return!1}function je(C){if(!p||!C||typeof C!="object")return!1;try{return p.call(C),!0}catch{}return!1}function We(C){if(!a||!C||typeof C!="object")return!1;try{a.call(C);try{e.call(C)}catch{return!0}return C instanceof Set}catch{}return!1}function _u(C){if(!c||!C||typeof C!="object")return!1;try{c.call(C,c);try{l.call(C,l)}catch{return!0}return C instanceof WeakSet}catch{}return!1}function vu(C){return!C||typeof C!="object"?!1:typeof HTMLElement<"u"&&C instanceof HTMLElement?!0:typeof C.nodeName=="string"&&typeof C.getAttribute=="function"}function Jn(C,O){if(C.length>O.maxStringLength){var yt=C.length-O.maxStringLength,At="... "+yt+" more character"+(yt>1?"s":"");return Jn(_.call(C,0,O.maxStringLength),O)+At}var Mt=F[O.quoteStyle||"single"];Mt.lastIndex=0;var ot=x.call(x.call(C,Mt,"\\$1"),/[\x00-\x1f]/g,bu);return G(ot,"single",O)}function bu(C){var O=C.charCodeAt(0),yt={8:"b",9:"t",10:"n",12:"f",13:"r"}[O];return yt?"\\"+yt:"\\x"+(O<16?"0":"")+E.call(O.toString(16))}function xr(C){return"Object("+C+")"}function zi(C){return C+" { ? }"}function Qn(C,O,yt,At){var Mt=At?Hi(yt,At):B.call(yt,", ");return C+" ("+O+") {"+Mt+"}"}function xu(C){for(var O=0;O<C.length;O++)if(ye(C[O],`
`)>=0)return!1;return!0}function wu(C,O){var yt;if(C.indent==="	")yt="	";else if(typeof C.indent=="number"&&C.indent>0)yt=B.call(Array(C.indent+1)," ");else return null;return{base:yt,prev:B.call(Array(O+1),yt)}}function Hi(C,O){if(C.length===0)return"";var yt=`
`+O.prev+O.base;return yt+B.call(C,","+yt)+`
`+O.prev}function zr(C,O){var yt=Z(C),At=[];if(yt){At.length=C.length;for(var Mt=0;Mt<C.length;Mt++)At[Mt]=Nt(C,Mt)?O(C[Mt],C):""}var ot=typeof P=="function"?P(C):[],_e;if(H){_e={};for(var Ie=0;Ie<ot.length;Ie++)_e["$"+ot[Ie]]=ot[Ie]}for(var Vt in C)Nt(C,Vt)&&(yt&&String(Number(Vt))===Vt&&Vt<C.length||H&&_e["$"+Vt]instanceof Symbol||(A.call(/[^\w$]/,Vt)?At.push(O(Vt,C)+": "+O(C[Vt],C)):At.push(Vt+": "+O(C[Vt],C))));if(typeof P=="function")for(var ve=0;ve<ot.length;ve++)T.call(C,ot[ve])&&At.push("["+O(ot[ve])+"]: "+O(C[ot[ve]],C));return At}return is}var ss,Ma;function Dc(){if(Ma)return ss;Ma=1;var i=ki(),t=_r(),e=function(o,h,l){for(var u=o,c;(c=u.next)!=null;u=c)if(c.key===h)return u.next=c.next,l||(c.next=o.next,o.next=c),c},r=function(o,h){if(o){var l=e(o,h);return l&&l.value}},s=function(o,h,l){var u=e(o,h);u?u.value=l:o.next={key:h,next:o.next,value:l}},n=function(o,h){return o?!!e(o,h):!1},a=function(o,h){if(o)return e(o,h,!0)};return ss=function(){var h,l={assert:function(u){if(!l.has(u))throw new t("Side channel does not contain "+i(u))},delete:function(u){var c=h&&h.next,f=a(h,u);return f&&c&&c===f&&(h=void 0),!!f},get:function(u){return r(h,u)},has:function(u){return n(h,u)},set:function(u,c){h||(h={next:void 0}),s(h,u,c)}};return l},ss}var ns,Ia;function rl(){return Ia||(Ia=1,ns=Object),ns}var as,Ra;function Uc(){return Ra||(Ra=1,as=Error),as}var os,Ca;function Gc(){return Ca||(Ca=1,os=EvalError),os}var hs,La;function $c(){return La||(La=1,hs=RangeError),hs}var ls,Fa;function Vc(){return Fa||(Fa=1,ls=ReferenceError),ls}var us,Pa;function zc(){return Pa||(Pa=1,us=SyntaxError),us}var cs,Na;function Hc(){return Na||(Na=1,cs=URIError),cs}var ds,Oa;function qc(){return Oa||(Oa=1,ds=Math.abs),ds}var fs,Ba;function Xc(){return Ba||(Ba=1,fs=Math.floor),fs}var ps,ka;function jc(){return ka||(ka=1,ps=Math.max),ps}var ms,Da;function Wc(){return Da||(Da=1,ms=Math.min),ms}var gs,Ua;function Yc(){return Ua||(Ua=1,gs=Math.pow),gs}var ys,Ga;function Kc(){return Ga||(Ga=1,ys=Math.round),ys}var _s,$a;function Zc(){return $a||($a=1,_s=Number.isNaN||function(t){return t!==t}),_s}var vs,Va;function Jc(){if(Va)return vs;Va=1;var i=Zc();return vs=function(e){return i(e)||e===0?e:e<0?-1:1},vs}var bs,za;function Qc(){return za||(za=1,bs=Object.getOwnPropertyDescriptor),bs}var xs,Ha;function il(){if(Ha)return xs;Ha=1;var i=Qc();if(i)try{i([],"length")}catch{i=null}return xs=i,xs}var ws,qa;function td(){if(qa)return ws;qa=1;var i=Object.defineProperty||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return ws=i,ws}var Ts,Xa;function ed(){return Xa||(Xa=1,Ts=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(var n in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var a=Object.getOwnPropertySymbols(t);if(a.length!==1||a[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(t,e);if(o.value!==s||o.enumerable!==!0)return!1}return!0}),Ts}var Es,ja;function rd(){if(ja)return Es;ja=1;var i=typeof Symbol<"u"&&Symbol,t=ed();return Es=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Es}var As,Wa;function sl(){return Wa||(Wa=1,As=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),As}var Ss,Ya;function nl(){if(Ya)return Ss;Ya=1;var i=rl();return Ss=i.getPrototypeOf||null,Ss}var Ms,Ka;function id(){if(Ka)return Ms;Ka=1;var i="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,r="[object Function]",s=function(h,l){for(var u=[],c=0;c<h.length;c+=1)u[c]=h[c];for(var f=0;f<l.length;f+=1)u[f+h.length]=l[f];return u},n=function(h,l){for(var u=[],c=l,f=0;c<h.length;c+=1,f+=1)u[f]=h[c];return u},a=function(o,h){for(var l="",u=0;u<o.length;u+=1)l+=o[u],u+1<o.length&&(l+=h);return l};return Ms=function(h){var l=this;if(typeof l!="function"||t.apply(l)!==r)throw new TypeError(i+l);for(var u=n(arguments,1),c,f=function(){if(this instanceof c){var m=l.apply(this,s(u,arguments));return Object(m)===m?m:this}return l.apply(h,s(u,arguments))},p=e(0,l.length-u.length),g=[],y=0;y<p;y++)g[y]="$"+y;if(c=Function("binder","return function ("+a(g,",")+"){ return binder.apply(this,arguments); }")(f),l.prototype){var d=function(){};d.prototype=l.prototype,c.prototype=new d,d.prototype=null}return c},Ms}var Is,Za;function Di(){if(Za)return Is;Za=1;var i=id();return Is=Function.prototype.bind||i,Is}var Rs,Ja;function Gn(){return Ja||(Ja=1,Rs=Function.prototype.call),Rs}var Cs,Qa;function al(){return Qa||(Qa=1,Cs=Function.prototype.apply),Cs}var Ls,to;function sd(){return to||(to=1,Ls=typeof Reflect<"u"&&Reflect&&Reflect.apply),Ls}var Fs,eo;function nd(){if(eo)return Fs;eo=1;var i=Di(),t=al(),e=Gn(),r=sd();return Fs=r||i.call(e,t),Fs}var Ps,ro;function ol(){if(ro)return Ps;ro=1;var i=Di(),t=_r(),e=Gn(),r=nd();return Ps=function(n){if(n.length<1||typeof n[0]!="function")throw new t("a function is required");return r(i,e,n)},Ps}var Ns,io;function ad(){if(io)return Ns;io=1;var i=ol(),t=il(),e;try{e=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var r=!!e&&t&&t(Object.prototype,"__proto__"),s=Object,n=s.getPrototypeOf;return Ns=r&&typeof r.get=="function"?i([r.get]):typeof n=="function"?function(o){return n(o==null?o:s(o))}:!1,Ns}var Os,so;function od(){if(so)return Os;so=1;var i=sl(),t=nl(),e=ad();return Os=i?function(s){return i(s)}:t?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return t(s)}:e?function(s){return e(s)}:null,Os}var Bs,no;function hd(){if(no)return Bs;no=1;var i=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Di();return Bs=e.call(i,t),Bs}var ks,ao;function $n(){if(ao)return ks;ao=1;var i,t=rl(),e=Uc(),r=Gc(),s=$c(),n=Vc(),a=zc(),o=_r(),h=Hc(),l=qc(),u=Xc(),c=jc(),f=Wc(),p=Yc(),g=Kc(),y=Jc(),d=Function,m=function(et){try{return d('"use strict"; return ('+et+").constructor;")()}catch{}},_=il(),x=td(),E=function(){throw new o},v=_?function(){try{return arguments.callee,E}catch{try{return _(arguments,"callee").get}catch{return E}}}():E,A=rd()(),b=od(),B=nl(),U=sl(),D=al(),k=Gn(),P={},j=typeof Uint8Array>"u"||!b?i:b(Uint8Array),H={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":A&&b?b([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":P,"%AsyncGenerator%":P,"%AsyncGeneratorFunction%":P,"%AsyncIteratorPrototype%":P,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?i:Float16Array,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":d,"%GeneratorFunction%":P,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":A&&b?b(b([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!A||!b?i:b(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":_,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":s,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!A||!b?i:b(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":A&&b?b(""[Symbol.iterator]()):i,"%Symbol%":A?Symbol:i,"%SyntaxError%":a,"%ThrowTypeError%":v,"%TypedArray%":j,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":h,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet,"%Function.prototype.call%":k,"%Function.prototype.apply%":D,"%Object.defineProperty%":x,"%Object.getPrototypeOf%":B,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":c,"%Math.min%":f,"%Math.pow%":p,"%Math.round%":g,"%Math.sign%":y,"%Reflect.getPrototypeOf%":U};if(b)try{null.error}catch(et){var z=b(b(et));H["%Error.prototype%"]=z}var T=function et(q){var rt;if(q==="%AsyncFunction%")rt=m("async function () {}");else if(q==="%GeneratorFunction%")rt=m("function* () {}");else if(q==="%AsyncGeneratorFunction%")rt=m("async function* () {}");else if(q==="%AsyncGenerator%"){var it=et("%AsyncGeneratorFunction%");it&&(rt=it.prototype)}else if(q==="%AsyncIteratorPrototype%"){var ut=et("%AsyncGenerator%");ut&&b&&(rt=b(ut.prototype))}return H[q]=rt,rt},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},w=Di(),L=hd(),M=w.call(k,Array.prototype.concat),I=w.call(D,Array.prototype.splice),N=w.call(k,String.prototype.replace),F=w.call(k,String.prototype.slice),G=w.call(k,RegExp.prototype.exec),$=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Y=/\\(\\)?/g,Z=function(q){var rt=F(q,0,1),it=F(q,-1);if(rt==="%"&&it!=="%")throw new a("invalid intrinsic syntax, expected closing `%`");if(it==="%"&&rt!=="%")throw new a("invalid intrinsic syntax, expected opening `%`");var ut=[];return N(q,$,function(mt,Q,tt,Nt){ut[ut.length]=tt?N(Nt,Y,"$1"):Q||mt}),ut},J=function(q,rt){var it=q,ut;if(L(S,it)&&(ut=S[it],it="%"+ut[0]+"%"),L(H,it)){var mt=H[it];if(mt===P&&(mt=T(it)),typeof mt>"u"&&!rt)throw new o("intrinsic "+q+" exists, but is not available. Please file an issue!");return{alias:ut,name:it,value:mt}}throw new a("intrinsic "+q+" does not exist!")};return ks=function(q,rt){if(typeof q!="string"||q.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof rt!="boolean")throw new o('"allowMissing" argument must be a boolean');if(G(/^%?[^%]*%?$/,q)===null)throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var it=Z(q),ut=it.length>0?it[0]:"",mt=J("%"+ut+"%",rt),Q=mt.name,tt=mt.value,Nt=!1,Gt=mt.alias;Gt&&(ut=Gt[0],I(it,M([0,1],Gt)));for(var qe=1,ye=!0;qe<it.length;qe+=1){var Wt=it[qe],Xe=F(Wt,0,1),je=F(Wt,-1);if((Xe==='"'||Xe==="'"||Xe==="`"||je==='"'||je==="'"||je==="`")&&Xe!==je)throw new a("property names with quotes must have matching quotes");if((Wt==="constructor"||!ye)&&(Nt=!0),ut+="."+Wt,Q="%"+ut+"%",L(H,Q))tt=H[Q];else if(tt!=null){if(!(Wt in tt)){if(!rt)throw new o("base intrinsic for "+q+" exists, but the property is not available.");return}if(_&&qe+1>=it.length){var We=_(tt,Wt);ye=!!We,ye&&"get"in We&&!("originalValue"in We.get)?tt=We.get:tt=tt[Wt]}else ye=L(tt,Wt),tt=tt[Wt];ye&&!Nt&&(H[Q]=tt)}}return tt},ks}var Ds,oo;function hl(){if(oo)return Ds;oo=1;var i=$n(),t=ol(),e=t([i("%String.prototype.indexOf%")]);return Ds=function(s,n){var a=i(s,!!n);return typeof a=="function"&&e(s,".prototype.")>-1?t([a]):a},Ds}var Us,ho;function ll(){if(ho)return Us;ho=1;var i=$n(),t=hl(),e=ki(),r=_r(),s=i("%Map%",!0),n=t("Map.prototype.get",!0),a=t("Map.prototype.set",!0),o=t("Map.prototype.has",!0),h=t("Map.prototype.delete",!0),l=t("Map.prototype.size",!0);return Us=!!s&&function(){var c,f={assert:function(p){if(!f.has(p))throw new r("Side channel does not contain "+e(p))},delete:function(p){if(c){var g=h(c,p);return l(c)===0&&(c=void 0),g}return!1},get:function(p){if(c)return n(c,p)},has:function(p){return c?o(c,p):!1},set:function(p,g){c||(c=new s),a(c,p,g)}};return f},Us}var Gs,lo;function ld(){if(lo)return Gs;lo=1;var i=$n(),t=hl(),e=ki(),r=ll(),s=_r(),n=i("%WeakMap%",!0),a=t("WeakMap.prototype.get",!0),o=t("WeakMap.prototype.set",!0),h=t("WeakMap.prototype.has",!0),l=t("WeakMap.prototype.delete",!0);return Gs=n?function(){var c,f,p={assert:function(g){if(!p.has(g))throw new s("Side channel does not contain "+e(g))},delete:function(g){if(n&&g&&(typeof g=="object"||typeof g=="function")){if(c)return l(c,g)}else if(r&&f)return f.delete(g);return!1},get:function(g){return n&&g&&(typeof g=="object"||typeof g=="function")&&c?a(c,g):f&&f.get(g)},has:function(g){return n&&g&&(typeof g=="object"||typeof g=="function")&&c?h(c,g):!!f&&f.has(g)},set:function(g,y){n&&g&&(typeof g=="object"||typeof g=="function")?(c||(c=new n),o(c,g,y)):r&&(f||(f=r()),f.set(g,y))}};return p}:r,Gs}var $s,uo;function ud(){if(uo)return $s;uo=1;var i=_r(),t=ki(),e=Dc(),r=ll(),s=ld(),n=s||r||e;return $s=function(){var o,h={assert:function(l){if(!h.has(l))throw new i("Side channel does not contain "+t(l))},delete:function(l){return!!o&&o.delete(l)},get:function(l){return o&&o.get(l)},has:function(l){return!!o&&o.has(l)},set:function(l,u){o||(o=n()),o.set(l,u)}};return h},$s}var Vs,co;function Vn(){if(co)return Vs;co=1;var i=String.prototype.replace,t=/%20/g,e={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Vs={default:e.RFC3986,formatters:{RFC1738:function(r){return i.call(r,t,"+")},RFC3986:function(r){return String(r)}},RFC1738:e.RFC1738,RFC3986:e.RFC3986},Vs}var zs,fo;function ul(){if(fo)return zs;fo=1;var i=Vn(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r=function(){for(var d=[],m=0;m<256;++m)d.push("%"+((m<16?"0":"")+m.toString(16)).toUpperCase());return d}(),s=function(m){for(;m.length>1;){var _=m.pop(),x=_.obj[_.prop];if(e(x)){for(var E=[],v=0;v<x.length;++v)typeof x[v]<"u"&&E.push(x[v]);_.obj[_.prop]=E}}},n=function(m,_){for(var x=_&&_.plainObjects?{__proto__:null}:{},E=0;E<m.length;++E)typeof m[E]<"u"&&(x[E]=m[E]);return x},a=function d(m,_,x){if(!_)return m;if(typeof _!="object"&&typeof _!="function"){if(e(m))m.push(_);else if(m&&typeof m=="object")(x&&(x.plainObjects||x.allowPrototypes)||!t.call(Object.prototype,_))&&(m[_]=!0);else return[m,_];return m}if(!m||typeof m!="object")return[m].concat(_);var E=m;return e(m)&&!e(_)&&(E=n(m,x)),e(m)&&e(_)?(_.forEach(function(v,A){if(t.call(m,A)){var b=m[A];b&&typeof b=="object"&&v&&typeof v=="object"?m[A]=d(b,v,x):m.push(v)}else m[A]=v}),m):Object.keys(_).reduce(function(v,A){var b=_[A];return t.call(v,A)?v[A]=d(v[A],b,x):v[A]=b,v},E)},o=function(m,_){return Object.keys(_).reduce(function(x,E){return x[E]=_[E],x},m)},h=function(d,m,_){var x=d.replace(/\+/g," ");if(_==="iso-8859-1")return x.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(x)}catch{return x}},l=1024,u=function(m,_,x,E,v){if(m.length===0)return m;var A=m;if(typeof m=="symbol"?A=Symbol.prototype.toString.call(m):typeof m!="string"&&(A=String(m)),x==="iso-8859-1")return escape(A).replace(/%u[0-9a-f]{4}/gi,function(j){return"%26%23"+parseInt(j.slice(2),16)+"%3B"});for(var b="",B=0;B<A.length;B+=l){for(var U=A.length>=l?A.slice(B,B+l):A,D=[],k=0;k<U.length;++k){var P=U.charCodeAt(k);if(P===45||P===46||P===95||P===126||P>=48&&P<=57||P>=65&&P<=90||P>=97&&P<=122||v===i.RFC1738&&(P===40||P===41)){D[D.length]=U.charAt(k);continue}if(P<128){D[D.length]=r[P];continue}if(P<2048){D[D.length]=r[192|P>>6]+r[128|P&63];continue}if(P<55296||P>=57344){D[D.length]=r[224|P>>12]+r[128|P>>6&63]+r[128|P&63];continue}k+=1,P=65536+((P&1023)<<10|U.charCodeAt(k)&1023),D[D.length]=r[240|P>>18]+r[128|P>>12&63]+r[128|P>>6&63]+r[128|P&63]}b+=D.join("")}return b},c=function(m){for(var _=[{obj:{o:m},prop:"o"}],x=[],E=0;E<_.length;++E)for(var v=_[E],A=v.obj[v.prop],b=Object.keys(A),B=0;B<b.length;++B){var U=b[B],D=A[U];typeof D=="object"&&D!==null&&x.indexOf(D)===-1&&(_.push({obj:A,prop:U}),x.push(D))}return s(_),m},f=function(m){return Object.prototype.toString.call(m)==="[object RegExp]"},p=function(m){return!m||typeof m!="object"?!1:!!(m.constructor&&m.constructor.isBuffer&&m.constructor.isBuffer(m))},g=function(m,_){return[].concat(m,_)},y=function(m,_){if(e(m)){for(var x=[],E=0;E<m.length;E+=1)x.push(_(m[E]));return x}return _(m)};return zs={arrayToObject:n,assign:o,combine:g,compact:c,decode:h,encode:u,isBuffer:p,isRegExp:f,maybeMap:y,merge:a},zs}var Hs,po;function cd(){if(po)return Hs;po=1;var i=ud(),t=ul(),e=Vn(),r=Object.prototype.hasOwnProperty,s={brackets:function(d){return d+"[]"},comma:"comma",indices:function(d,m){return d+"["+m+"]"},repeat:function(d){return d}},n=Array.isArray,a=Array.prototype.push,o=function(y,d){a.apply(y,n(d)?d:[d])},h=Date.prototype.toISOString,l=e.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:e.formatters[l],indices:!1,serializeDate:function(d){return h.call(d)},skipNulls:!1,strictNullHandling:!1},c=function(d){return typeof d=="string"||typeof d=="number"||typeof d=="boolean"||typeof d=="symbol"||typeof d=="bigint"},f={},p=function y(d,m,_,x,E,v,A,b,B,U,D,k,P,j,H,z,T,S){for(var w=d,L=S,M=0,I=!1;(L=L.get(f))!==void 0&&!I;){var N=L.get(d);if(M+=1,typeof N<"u"){if(N===M)throw new RangeError("Cyclic object value");I=!0}typeof L.get(f)>"u"&&(M=0)}if(typeof U=="function"?w=U(m,w):w instanceof Date?w=P(w):_==="comma"&&n(w)&&(w=t.maybeMap(w,function(Q){return Q instanceof Date?P(Q):Q})),w===null){if(v)return B&&!z?B(m,u.encoder,T,"key",j):m;w=""}if(c(w)||t.isBuffer(w)){if(B){var F=z?m:B(m,u.encoder,T,"key",j);return[H(F)+"="+H(B(w,u.encoder,T,"value",j))]}return[H(m)+"="+H(String(w))]}var G=[];if(typeof w>"u")return G;var $;if(_==="comma"&&n(w))z&&B&&(w=t.maybeMap(w,B)),$=[{value:w.length>0?w.join(",")||null:void 0}];else if(n(U))$=U;else{var Y=Object.keys(w);$=D?Y.sort(D):Y}var Z=b?String(m).replace(/\./g,"%2E"):String(m),J=x&&n(w)&&w.length===1?Z+"[]":Z;if(E&&n(w)&&w.length===0)return J+"[]";for(var et=0;et<$.length;++et){var q=$[et],rt=typeof q=="object"&&q&&typeof q.value<"u"?q.value:w[q];if(!(A&&rt===null)){var it=k&&b?String(q).replace(/\./g,"%2E"):String(q),ut=n(w)?typeof _=="function"?_(J,it):J:J+(k?"."+it:"["+it+"]");S.set(d,M);var mt=i();mt.set(f,S),o(G,y(rt,ut,_,x,E,v,A,b,_==="comma"&&z&&n(w)?null:B,U,D,k,P,j,H,z,T,mt))}}return G},g=function(d){if(!d)return u;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.encodeDotInKeys<"u"&&typeof d.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(d.encoder!==null&&typeof d.encoder<"u"&&typeof d.encoder!="function")throw new TypeError("Encoder has to be a function.");var m=d.charset||u.charset;if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var _=e.default;if(typeof d.format<"u"){if(!r.call(e.formatters,d.format))throw new TypeError("Unknown format option provided.");_=d.format}var x=e.formatters[_],E=u.filter;(typeof d.filter=="function"||n(d.filter))&&(E=d.filter);var v;if(d.arrayFormat in s?v=d.arrayFormat:"indices"in d?v=d.indices?"indices":"repeat":v=u.arrayFormat,"commaRoundTrip"in d&&typeof d.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var A=typeof d.allowDots>"u"?d.encodeDotInKeys===!0?!0:u.allowDots:!!d.allowDots;return{addQueryPrefix:typeof d.addQueryPrefix=="boolean"?d.addQueryPrefix:u.addQueryPrefix,allowDots:A,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:v,charset:m,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!d.commaRoundTrip,delimiter:typeof d.delimiter>"u"?u.delimiter:d.delimiter,encode:typeof d.encode=="boolean"?d.encode:u.encode,encodeDotInKeys:typeof d.encodeDotInKeys=="boolean"?d.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof d.encoder=="function"?d.encoder:u.encoder,encodeValuesOnly:typeof d.encodeValuesOnly=="boolean"?d.encodeValuesOnly:u.encodeValuesOnly,filter:E,format:_,formatter:x,serializeDate:typeof d.serializeDate=="function"?d.serializeDate:u.serializeDate,skipNulls:typeof d.skipNulls=="boolean"?d.skipNulls:u.skipNulls,sort:typeof d.sort=="function"?d.sort:null,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:u.strictNullHandling}};return Hs=function(y,d){var m=y,_=g(d),x,E;typeof _.filter=="function"?(E=_.filter,m=E("",m)):n(_.filter)&&(E=_.filter,x=E);var v=[];if(typeof m!="object"||m===null)return"";var A=s[_.arrayFormat],b=A==="comma"&&_.commaRoundTrip;x||(x=Object.keys(m)),_.sort&&x.sort(_.sort);for(var B=i(),U=0;U<x.length;++U){var D=x[U],k=m[D];_.skipNulls&&k===null||o(v,p(k,D,A,b,_.allowEmptyArrays,_.strictNullHandling,_.skipNulls,_.encodeDotInKeys,_.encode?_.encoder:null,_.filter,_.sort,_.allowDots,_.serializeDate,_.format,_.formatter,_.encodeValuesOnly,_.charset,B))}var P=v.join(_.delimiter),j=_.addQueryPrefix===!0?"?":"";return _.charsetSentinel&&(_.charset==="iso-8859-1"?j+="utf8=%26%2310003%3B&":j+="utf8=%E2%9C%93&"),P.length>0?j+P:""},Hs}var qs,mo;function dd(){if(mo)return qs;mo=1;var i=ul(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},s=function(f){return f.replace(/&#(\d+);/g,function(p,g){return String.fromCharCode(parseInt(g,10))})},n=function(f,p,g){if(f&&typeof f=="string"&&p.comma&&f.indexOf(",")>-1)return f.split(",");if(p.throwOnLimitExceeded&&g>=p.arrayLimit)throw new RangeError("Array limit exceeded. Only "+p.arrayLimit+" element"+(p.arrayLimit===1?"":"s")+" allowed in an array.");return f},a="utf8=%26%2310003%3B",o="utf8=%E2%9C%93",h=function(p,g){var y={__proto__:null},d=g.ignoreQueryPrefix?p.replace(/^\?/,""):p;d=d.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var m=g.parameterLimit===1/0?void 0:g.parameterLimit,_=d.split(g.delimiter,g.throwOnLimitExceeded?m+1:m);if(g.throwOnLimitExceeded&&_.length>m)throw new RangeError("Parameter limit exceeded. Only "+m+" parameter"+(m===1?"":"s")+" allowed.");var x=-1,E,v=g.charset;if(g.charsetSentinel)for(E=0;E<_.length;++E)_[E].indexOf("utf8=")===0&&(_[E]===o?v="utf-8":_[E]===a&&(v="iso-8859-1"),x=E,E=_.length);for(E=0;E<_.length;++E)if(E!==x){var A=_[E],b=A.indexOf("]="),B=b===-1?A.indexOf("="):b+1,U,D;B===-1?(U=g.decoder(A,r.decoder,v,"key"),D=g.strictNullHandling?null:""):(U=g.decoder(A.slice(0,B),r.decoder,v,"key"),D=i.maybeMap(n(A.slice(B+1),g,e(y[U])?y[U].length:0),function(P){return g.decoder(P,r.decoder,v,"value")})),D&&g.interpretNumericEntities&&v==="iso-8859-1"&&(D=s(String(D))),A.indexOf("[]=")>-1&&(D=e(D)?[D]:D);var k=t.call(y,U);k&&g.duplicates==="combine"?y[U]=i.combine(y[U],D):(!k||g.duplicates==="last")&&(y[U]=D)}return y},l=function(f,p,g,y){var d=0;if(f.length>0&&f[f.length-1]==="[]"){var m=f.slice(0,-1).join("");d=Array.isArray(p)&&p[m]?p[m].length:0}for(var _=y?p:n(p,g,d),x=f.length-1;x>=0;--x){var E,v=f[x];if(v==="[]"&&g.parseArrays)E=g.allowEmptyArrays&&(_===""||g.strictNullHandling&&_===null)?[]:i.combine([],_);else{E=g.plainObjects?{__proto__:null}:{};var A=v.charAt(0)==="["&&v.charAt(v.length-1)==="]"?v.slice(1,-1):v,b=g.decodeDotInKeys?A.replace(/%2E/g,"."):A,B=parseInt(b,10);!g.parseArrays&&b===""?E={0:_}:!isNaN(B)&&v!==b&&String(B)===b&&B>=0&&g.parseArrays&&B<=g.arrayLimit?(E=[],E[B]=_):b!=="__proto__"&&(E[b]=_)}_=E}return _},u=function(p,g,y,d){if(p){var m=y.allowDots?p.replace(/\.([^.[]+)/g,"[$1]"):p,_=/(\[[^[\]]*])/,x=/(\[[^[\]]*])/g,E=y.depth>0&&_.exec(m),v=E?m.slice(0,E.index):m,A=[];if(v){if(!y.plainObjects&&t.call(Object.prototype,v)&&!y.allowPrototypes)return;A.push(v)}for(var b=0;y.depth>0&&(E=x.exec(m))!==null&&b<y.depth;){if(b+=1,!y.plainObjects&&t.call(Object.prototype,E[1].slice(1,-1))&&!y.allowPrototypes)return;A.push(E[1])}if(E){if(y.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+y.depth+" and strictDepth is true");A.push("["+m.slice(E.index)+"]")}return l(A,g,y,d)}},c=function(p){if(!p)return r;if(typeof p.allowEmptyArrays<"u"&&typeof p.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof p.decodeDotInKeys<"u"&&typeof p.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(p.decoder!==null&&typeof p.decoder<"u"&&typeof p.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof p.throwOnLimitExceeded<"u"&&typeof p.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var g=typeof p.charset>"u"?r.charset:p.charset,y=typeof p.duplicates>"u"?r.duplicates:p.duplicates;if(y!=="combine"&&y!=="first"&&y!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var d=typeof p.allowDots>"u"?p.decodeDotInKeys===!0?!0:r.allowDots:!!p.allowDots;return{allowDots:d,allowEmptyArrays:typeof p.allowEmptyArrays=="boolean"?!!p.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof p.allowPrototypes=="boolean"?p.allowPrototypes:r.allowPrototypes,allowSparse:typeof p.allowSparse=="boolean"?p.allowSparse:r.allowSparse,arrayLimit:typeof p.arrayLimit=="number"?p.arrayLimit:r.arrayLimit,charset:g,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:r.charsetSentinel,comma:typeof p.comma=="boolean"?p.comma:r.comma,decodeDotInKeys:typeof p.decodeDotInKeys=="boolean"?p.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof p.decoder=="function"?p.decoder:r.decoder,delimiter:typeof p.delimiter=="string"||i.isRegExp(p.delimiter)?p.delimiter:r.delimiter,depth:typeof p.depth=="number"||p.depth===!1?+p.depth:r.depth,duplicates:y,ignoreQueryPrefix:p.ignoreQueryPrefix===!0,interpretNumericEntities:typeof p.interpretNumericEntities=="boolean"?p.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof p.parameterLimit=="number"?p.parameterLimit:r.parameterLimit,parseArrays:p.parseArrays!==!1,plainObjects:typeof p.plainObjects=="boolean"?p.plainObjects:r.plainObjects,strictDepth:typeof p.strictDepth=="boolean"?!!p.strictDepth:r.strictDepth,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof p.throwOnLimitExceeded=="boolean"?p.throwOnLimitExceeded:!1}};return qs=function(f,p){var g=c(p);if(f===""||f===null||typeof f>"u")return g.plainObjects?{__proto__:null}:{};for(var y=typeof f=="string"?h(f,g):f,d=g.plainObjects?{__proto__:null}:{},m=Object.keys(y),_=0;_<m.length;++_){var x=m[_],E=u(x,y[x],g,typeof f=="string");d=i.merge(d,E,g)}return g.allowSparse===!0?d:i.compact(d)},qs}var Xs,go;function fd(){if(go)return Xs;go=1;var i=cd(),t=dd(),e=Vn();return Xs={formats:e,parse:t,stringify:i},Xs}var yo;function pd(){if(yo)return Re;yo=1;var i=Nc();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var e=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(n),o=["'"].concat(a),h=["%","/","?",";","#"].concat(o),l=["/","?","#"],u=255,c=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},d=fd();function m(v,A,b){if(v&&typeof v=="object"&&v instanceof t)return v;var B=new t;return B.parse(v,A,b),B}t.prototype.parse=function(v,A,b){if(typeof v!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof v);var B=v.indexOf("?"),U=B!==-1&&B<v.indexOf("#")?"?":"#",D=v.split(U),k=/\\/g;D[0]=D[0].replace(k,"/"),v=D.join(U);var P=v;if(P=P.trim(),!b&&v.split("#").length===1){var j=s.exec(P);if(j)return this.path=P,this.href=P,this.pathname=j[1],j[2]?(this.search=j[2],A?this.query=d.parse(this.search.substr(1)):this.query=this.search.substr(1)):A&&(this.search="",this.query={}),this}var H=e.exec(P);if(H){H=H[0];var z=H.toLowerCase();this.protocol=z,P=P.substr(H.length)}if(b||H||P.match(/^\/\/[^@/]+@[^@/]+/)){var T=P.substr(0,2)==="//";T&&!(H&&g[H])&&(P=P.substr(2),this.slashes=!0)}if(!g[H]&&(T||H&&!y[H])){for(var S=-1,w=0;w<l.length;w++){var L=P.indexOf(l[w]);L!==-1&&(S===-1||L<S)&&(S=L)}var M,I;S===-1?I=P.lastIndexOf("@"):I=P.lastIndexOf("@",S),I!==-1&&(M=P.slice(0,I),P=P.slice(I+1),this.auth=decodeURIComponent(M)),S=-1;for(var w=0;w<h.length;w++){var L=P.indexOf(h[w]);L!==-1&&(S===-1||L<S)&&(S=L)}S===-1&&(S=P.length),this.host=P.slice(0,S),P=P.slice(S),this.parseHost(),this.hostname=this.hostname||"";var N=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!N)for(var F=this.hostname.split(/\./),w=0,G=F.length;w<G;w++){var $=F[w];if($&&!$.match(c)){for(var Y="",Z=0,J=$.length;Z<J;Z++)$.charCodeAt(Z)>127?Y+="x":Y+=$[Z];if(!Y.match(c)){var et=F.slice(0,w),q=F.slice(w+1),rt=$.match(f);rt&&(et.push(rt[1]),q.unshift(rt[2])),q.length&&(P="/"+q.join(".")+P),this.hostname=et.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),N||(this.hostname=i.toASCII(this.hostname));var it=this.port?":"+this.port:"",ut=this.hostname||"";this.host=ut+it,this.href+=this.host,N&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),P[0]!=="/"&&(P="/"+P))}if(!p[z])for(var w=0,G=o.length;w<G;w++){var mt=o[w];if(P.indexOf(mt)!==-1){var Q=encodeURIComponent(mt);Q===mt&&(Q=escape(mt)),P=P.split(mt).join(Q)}}var tt=P.indexOf("#");tt!==-1&&(this.hash=P.substr(tt),P=P.slice(0,tt));var Nt=P.indexOf("?");if(Nt!==-1?(this.search=P.substr(Nt),this.query=P.substr(Nt+1),A&&(this.query=d.parse(this.query)),P=P.slice(0,Nt)):A&&(this.search="",this.query={}),P&&(this.pathname=P),y[z]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var it=this.pathname||"",Gt=this.search||"";this.path=it+Gt}return this.href=this.format(),this};function _(v){return typeof v=="string"&&(v=m(v)),v instanceof t?v.format():t.prototype.format.call(v)}t.prototype.format=function(){var v=this.auth||"";v&&(v=encodeURIComponent(v),v=v.replace(/%3A/i,":"),v+="@");var A=this.protocol||"",b=this.pathname||"",B=this.hash||"",U=!1,D="";this.host?U=v+this.host:this.hostname&&(U=v+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(U+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(D=d.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var k=this.search||D&&"?"+D||"";return A&&A.substr(-1)!==":"&&(A+=":"),this.slashes||(!A||y[A])&&U!==!1?(U="//"+(U||""),b&&b.charAt(0)!=="/"&&(b="/"+b)):U||(U=""),B&&B.charAt(0)!=="#"&&(B="#"+B),k&&k.charAt(0)!=="?"&&(k="?"+k),b=b.replace(/[?#]/g,function(P){return encodeURIComponent(P)}),k=k.replace("#","%23"),A+U+b+k+B};function x(v,A){return m(v,!1,!0).resolve(A)}t.prototype.resolve=function(v){return this.resolveObject(m(v,!1,!0)).format()};function E(v,A){return v?m(v,!1,!0).resolveObject(A):A}return t.prototype.resolveObject=function(v){if(typeof v=="string"){var A=new t;A.parse(v,!1,!0),v=A}for(var b=new t,B=Object.keys(this),U=0;U<B.length;U++){var D=B[U];b[D]=this[D]}if(b.hash=v.hash,v.href==="")return b.href=b.format(),b;if(v.slashes&&!v.protocol){for(var k=Object.keys(v),P=0;P<k.length;P++){var j=k[P];j!=="protocol"&&(b[j]=v[j])}return y[b.protocol]&&b.hostname&&!b.pathname&&(b.pathname="/",b.path=b.pathname),b.href=b.format(),b}if(v.protocol&&v.protocol!==b.protocol){if(!y[v.protocol]){for(var H=Object.keys(v),z=0;z<H.length;z++){var T=H[z];b[T]=v[T]}return b.href=b.format(),b}if(b.protocol=v.protocol,!v.host&&!g[v.protocol]){for(var G=(v.pathname||"").split("/");G.length&&!(v.host=G.shift()););v.host||(v.host=""),v.hostname||(v.hostname=""),G[0]!==""&&G.unshift(""),G.length<2&&G.unshift(""),b.pathname=G.join("/")}else b.pathname=v.pathname;if(b.search=v.search,b.query=v.query,b.host=v.host||"",b.auth=v.auth,b.hostname=v.hostname||v.host,b.port=v.port,b.pathname||b.search){var S=b.pathname||"",w=b.search||"";b.path=S+w}return b.slashes=b.slashes||v.slashes,b.href=b.format(),b}var L=b.pathname&&b.pathname.charAt(0)==="/",M=v.host||v.pathname&&v.pathname.charAt(0)==="/",I=M||L||b.host&&v.pathname,N=I,F=b.pathname&&b.pathname.split("/")||[],G=v.pathname&&v.pathname.split("/")||[],$=b.protocol&&!y[b.protocol];if($&&(b.hostname="",b.port=null,b.host&&(F[0]===""?F[0]=b.host:F.unshift(b.host)),b.host="",v.protocol&&(v.hostname=null,v.port=null,v.host&&(G[0]===""?G[0]=v.host:G.unshift(v.host)),v.host=null),I=I&&(G[0]===""||F[0]==="")),M)b.host=v.host||v.host===""?v.host:b.host,b.hostname=v.hostname||v.hostname===""?v.hostname:b.hostname,b.search=v.search,b.query=v.query,F=G;else if(G.length)F||(F=[]),F.pop(),F=F.concat(G),b.search=v.search,b.query=v.query;else if(v.search!=null){if($){b.host=F.shift(),b.hostname=b.host;var Y=b.host&&b.host.indexOf("@")>0?b.host.split("@"):!1;Y&&(b.auth=Y.shift(),b.hostname=Y.shift(),b.host=b.hostname)}return b.search=v.search,b.query=v.query,(b.pathname!==null||b.search!==null)&&(b.path=(b.pathname?b.pathname:"")+(b.search?b.search:"")),b.href=b.format(),b}if(!F.length)return b.pathname=null,b.search?b.path="/"+b.search:b.path=null,b.href=b.format(),b;for(var Z=F.slice(-1)[0],J=(b.host||v.host||F.length>1)&&(Z==="."||Z==="..")||Z==="",et=0,q=F.length;q>=0;q--)Z=F[q],Z==="."?F.splice(q,1):Z===".."?(F.splice(q,1),et++):et&&(F.splice(q,1),et--);if(!I&&!N)for(;et--;et)F.unshift("..");I&&F[0]!==""&&(!F[0]||F[0].charAt(0)!=="/")&&F.unshift(""),J&&F.join("/").substr(-1)!=="/"&&F.push("");var rt=F[0]===""||F[0]&&F[0].charAt(0)==="/";if($){b.hostname=rt?"":F.length?F.shift():"",b.host=b.hostname;var Y=b.host&&b.host.indexOf("@")>0?b.host.split("@"):!1;Y&&(b.auth=Y.shift(),b.hostname=Y.shift(),b.host=b.hostname)}return I=I||b.host&&F.length,I&&!rt&&F.unshift(""),F.length>0?b.pathname=F.join("/"):(b.pathname=null,b.path=null),(b.pathname!==null||b.search!==null)&&(b.path=(b.pathname?b.pathname:"")+(b.search?b.search:"")),b.auth=v.auth||b.auth,b.slashes=b.slashes||v.slashes,b.href=b.format(),b},t.prototype.parseHost=function(){var v=this.host,A=r.exec(v);A&&(A=A[0],A!==":"&&(this.port=A.substr(1)),v=v.substr(0,v.length-A.length)),v&&(this.hostname=v)},Re.parse=m,Re.resolve=x,Re.resolveObject=E,Re.format=_,Re.Url=t,Re}pd();const _o={};function xt(i,t,e=3){if(_o[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),_o[t]=!0}let js;function md(){return typeof js>"u"&&(js=function(){const i={stencil:!0,failIfMajorPerformanceCaveat:ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ft.ADAPTER.getWebGLRenderingContext())return!1;const t=ft.ADAPTER.createCanvas();let e=t.getContext("webgl",i)||t.getContext("experimental-webgl",i);const r=!!e?.getContextAttributes()?.stencil;if(e){const s=e.getExtension("WEBGL_lose_context");s&&s.loseContext()}return e=null,r}catch{return!1}}()),js}var gd={grad:.9,turn:360,rad:360/(2*Math.PI)},ce=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},kt=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Xt=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},cl=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},vo=function(i){return{r:Xt(i.r,0,255),g:Xt(i.g,0,255),b:Xt(i.b,0,255),a:Xt(i.a)}},Ws=function(i){return{r:kt(i.r),g:kt(i.g),b:kt(i.b),a:kt(i.a,3)}},yd=/^#([0-9a-f]{3,8})$/i,Yr=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},dl=function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=Math.max(t,e,r),a=n-Math.min(t,e,r),o=a?n===t?(e-r)/a:n===e?2+(r-t)/a:4+(t-e)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:s}},fl=function(i){var t=i.h,e=i.s,r=i.v,s=i.a;t=t/360*6,e/=100,r/=100;var n=Math.floor(t),a=r*(1-e),o=r*(1-(t-n)*e),h=r*(1-(1-t+n)*e),l=n%6;return{r:255*[r,o,a,a,h,r][l],g:255*[h,r,r,o,a,a][l],b:255*[a,a,h,r,r,o][l],a:s}},bo=function(i){return{h:cl(i.h),s:Xt(i.s,0,100),l:Xt(i.l,0,100),a:Xt(i.a)}},xo=function(i){return{h:kt(i.h),s:kt(i.s),l:kt(i.l),a:kt(i.a,3)}},wo=function(i){return fl((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},Or=function(i){return{h:(t=dl(i)).h,s:(s=(200-(e=t.s))*(r=t.v)/100)>0&&s<200?e*r/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,r,s},_d=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,vd=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,bd=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,xd=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pn={string:[[function(i){var t=yd.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?kt(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?kt(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=bd.exec(i)||xd.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:vo({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=_d.exec(i)||vd.exec(i);if(!t)return null;var e,r,s=bo({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(gd[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return wo(s)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,s=i.a,n=s===void 0?1:s;return ce(t)&&ce(e)&&ce(r)?vo({r:Number(t),g:Number(e),b:Number(r),a:Number(n)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,s=i.a,n=s===void 0?1:s;if(!ce(t)||!ce(e)||!ce(r))return null;var a=bo({h:Number(t),s:Number(e),l:Number(r),a:Number(n)});return wo(a)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,s=i.a,n=s===void 0?1:s;if(!ce(t)||!ce(e)||!ce(r))return null;var a=function(o){return{h:cl(o.h),s:Xt(o.s,0,100),v:Xt(o.v,0,100),a:Xt(o.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(n)});return fl(a)},"hsv"]]},To=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},wd=function(i){return typeof i=="string"?To(i.trim(),pn.string):typeof i=="object"&&i!==null?To(i,pn.object):[null,void 0]},Ys=function(i,t){var e=Or(i);return{h:e.h,s:Xt(e.s+100*t,0,100),l:e.l,a:e.a}},Ks=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Eo=function(i,t){var e=Or(i);return{h:e.h,s:e.s,l:Xt(e.l+100*t,0,100),a:e.a}},mn=function(){function i(t){this.parsed=wd(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return kt(Ks(this.rgba),2)},i.prototype.isDark=function(){return Ks(this.rgba)<.5},i.prototype.isLight=function(){return Ks(this.rgba)>=.5},i.prototype.toHex=function(){return t=Ws(this.rgba),e=t.r,r=t.g,s=t.b,a=(n=t.a)<1?Yr(kt(255*n)):"","#"+Yr(e)+Yr(r)+Yr(s)+a;var t,e,r,s,n,a},i.prototype.toRgb=function(){return Ws(this.rgba)},i.prototype.toRgbString=function(){return t=Ws(this.rgba),e=t.r,r=t.g,s=t.b,(n=t.a)<1?"rgba("+e+", "+r+", "+s+", "+n+")":"rgb("+e+", "+r+", "+s+")";var t,e,r,s,n},i.prototype.toHsl=function(){return xo(Or(this.rgba))},i.prototype.toHslString=function(){return t=xo(Or(this.rgba)),e=t.h,r=t.s,s=t.l,(n=t.a)<1?"hsla("+e+", "+r+"%, "+s+"%, "+n+")":"hsl("+e+", "+r+"%, "+s+"%)";var t,e,r,s,n},i.prototype.toHsv=function(){return t=dl(this.rgba),{h:kt(t.h),s:kt(t.s),v:kt(t.v),a:kt(t.a,3)};var t},i.prototype.invert=function(){return re({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),re(Ys(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),re(Ys(this.rgba,-t))},i.prototype.grayscale=function(){return re(Ys(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),re(Eo(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),re(Eo(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?re({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):kt(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=Or(this.rgba);return typeof t=="number"?re({h:t,s:e.s,l:e.l,a:e.a}):kt(e.h)},i.prototype.isEqual=function(t){return this.toHex()===re(t).toHex()},i}(),re=function(i){return i instanceof mn?i:new mn(i)},Ao=[],Td=function(i){i.forEach(function(t){Ao.indexOf(t)<0&&(t(mn,pn),Ao.push(t))})};function Ed(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var s in e)r[e[s]]=s;var n={};i.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,h,l=r[this.toHex()];if(l)return l;if(a?.closest){var u=this.toRgb(),c=1/0,f="black";if(!n.length)for(var p in e)n[p]=new i(e[p]).toRgb();for(var g in e){var y=(o=u,h=n[g],Math.pow(o.r-h.r,2)+Math.pow(o.g-h.g,2)+Math.pow(o.b-h.b,2));y<c&&(c=y,f=g)}return f}},t.string.push([function(a){var o=a.toLowerCase(),h=o==="transparent"?"#0000":e[o];return h?new i(h).toRgb():null},"name"])}Td([Ed]);const or=class _i{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof _i)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((s,n)=>s===e[n]);if(t!==null&&e!==null){const s=Object.keys(t),n=Object.keys(e);return s.length!==n.length?!1:s.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,r,s]=this._components;return{r:t,g:e,b:r,a:s}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,s]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(s*255),t}toRgbArray(t){t=t??[];const[e,r,s]=this._components;return t[0]=e,t[1]=r,t[2]=s,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,s,n]=_i.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return e&&(r=r*t+.5|0,s=s*t+.5|0,n=n*t+.5|0),(t*255<<24)+(r<<16)+(s<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,s]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(s*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,s,n]=this._components;return t[0]=e,t[1]=r,t[2]=s,t[3]=n,t}normalize(t){let e,r,s,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const a=t;e=(a>>16&255)/255,r=(a>>8&255)/255,s=(a&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,s,n=255]=t,e/=255,r/=255,s/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const o=_i.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const a=re(t);a.isValid()&&({r:e,g:r,b:s,a:n}=a.rgba,e/=255,r/=255,s/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((s,n)=>{t[n]=Math.min(Math.max(s,e),r)}),t)}};or.shared=new or,or.temp=new or,or.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let $e=or;function Ad(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[st.NORMAL_NPM]=st.NORMAL,i[st.ADD_NPM]=st.ADD,i[st.SCREEN_NPM]=st.SCREEN,t[st.NORMAL]=st.NORMAL_NPM,t[st.ADD]=st.ADD_NPM,t[st.SCREEN]=st.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const Sd=Ad();function pl(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function Si(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function So(i){return!(i&i-1)&&!!i}function Mo(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function vi(i,t,e){const r=i.length;let s;if(t>=r||e===0)return;e=t+e>r?r-t:e;const n=r-e;for(s=t;s<n;++s)i[s]=i[s+e];i.length=n}function Kr(i){return i===0?0:i<0?-1:1}let Md=0;function $r(){return++Md}const Io={},ie=Object.create(null),be=Object.create(null);function Id(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Ro(i,t=1){const e=ft.RETINA_PREFIX?.exec(i);return e?parseFloat(e[1]):t}var lt=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(lt||{});const gn=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Co=(i,t)=>gn(i).priority??t,_t={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(gn).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(gn).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,s=this._queue;r[e]?r[e]?.(t):(s[e]=s[e]||[],s[e]?.push(t))})}),this},handle(i,t,e){const r=this._addHandlers,s=this._removeHandlers;if(r[i]||s[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,s[i]=e;const n=this._queue;return n[i]&&(n[i]?.forEach(a=>t(a)),delete n[i]),this},handleByMap(i,t){return this.handle(i,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((s,n)=>Co(n,e)-Co(s,e)))},r=>{const s=t.indexOf(r.ref);s!==-1&&t.splice(s,1)})}};class Rd{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Cd=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Ld(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function Fd(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=Cd.replace(/%forloop%/gi,Ld(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const Zs=0,Js=1,Qs=2,tn=3,en=4,rn=5;class vr{constructor(){this.data=0,this.blendMode=st.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Zs)}set blend(t){!!(this.data&1<<Zs)!==t&&(this.data^=1<<Zs)}get offsets(){return!!(this.data&1<<Js)}set offsets(t){!!(this.data&1<<Js)!==t&&(this.data^=1<<Js)}get culling(){return!!(this.data&1<<Qs)}set culling(t){!!(this.data&1<<Qs)!==t&&(this.data^=1<<Qs)}get depthTest(){return!!(this.data&1<<tn)}set depthTest(t){!!(this.data&1<<tn)!==t&&(this.data^=1<<tn)}get depthMask(){return!!(this.data&1<<rn)}set depthMask(t){!!(this.data&1<<rn)!==t&&(this.data^=1<<rn)}get clockwiseFrontFace(){return!!(this.data&1<<en)}set clockwiseFrontFace(t){!!(this.data&1<<en)!==t&&(this.data^=1<<en)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==st.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new vr;return t.depthTest=!1,t.blend=!0,t}}vr.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const yn=[];function ml(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=yn.length-1;r>=0;--r){const s=yn[r];if(s.test&&s.test(i,e))return new s(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Qt{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,s,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:u}=this;this._aliasCount++;for(let c=0,f=u.length;c<f;c++)u[c][l](t,e,r,s,n,a,o,h);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Qt.prototype,{dispatch:{value:Qt.prototype.emit},run:{value:Qt.prototype.emit}});class Vr{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Qt("setRealSize"),this.onUpdate=new Qt("update"),this.onError=new Qt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class gl extends Vr{constructor(t,e){const{width:r,height:s}=e||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const s=t.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===He.UNPACK);const n=e.realWidth,a=e.realHeight;return r.width===n&&r.height===a?s.texSubImage2D(e.target,0,0,0,n,a,e.format,r.type,this.data):(r.width=n,r.height=a,s.texImage2D(e.target,0,r.internalFormat,n,a,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const Pd={scaleMode:pe.NEAREST,alphaMode:He.NPM},_n=class hr extends Bi{constructor(t=null,e=null){super(),e=Object.assign({},hr.defaultOptions,e);const{alphaMode:r,mipmap:s,anisotropicLevel:n,scaleMode:a,width:o,height:h,wrapMode:l,format:u,type:c,target:f,resolution:p,resourceOptions:g}=e;t&&!(t instanceof Vr)&&(t=ml(t,g),t.internal=!0),this.resolution=p||ft.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=a,this.format=u,this.type=c,this.target=f,this.alphaMode=r,this.uid=$r(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=So(this.realWidth)&&So(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete be[this.cacheId],delete ie[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),hr.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=ft.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else{if(!t._pixiId){const o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${$r()}`}n=t._pixiId}let a=be[n];if(s&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return a||(a=new hr(t,e),a.cacheId=n,hr.addToCache(a,n)),a}static fromBuffer(t,e,r,s){t=t||new Float32Array(e*r*4);const n=new gl(t,{width:e,height:r,...s?.resourceOptions});let a,o;return t instanceof Float32Array?(a=X.RGBA,o=ht.FLOAT):t instanceof Int32Array?(a=X.RGBA_INTEGER,o=ht.INT):t instanceof Uint32Array?(a=X.RGBA_INTEGER,o=ht.UNSIGNED_INT):t instanceof Int16Array?(a=X.RGBA_INTEGER,o=ht.SHORT):t instanceof Uint16Array?(a=X.RGBA_INTEGER,o=ht.UNSIGNED_SHORT):t instanceof Int8Array?(a=X.RGBA,o=ht.BYTE):(a=X.RGBA,o=ht.UNSIGNED_BYTE),n.internal=!0,new hr(n,Object.assign({},Pd,{type:o,format:a},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),be[e]&&be[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),be[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=be[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete be[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete be[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};_n.defaultOptions={mipmap:Ge.POW2,anisotropicLevel:0,scaleMode:pe.LINEAR,wrapMode:Dn.CLAMP,alphaMode:He.UNPACK,target:fr.TEXTURE_2D,format:X.RGBA,type:ht.UNSIGNED_BYTE},_n._globalBatch=0;let wt=_n;class Nd{constructor(){this.texArray=null,this.blend=0,this.type=Ai.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Od=0,Ht=class yl{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Od++,this.disposeRunner=new Qt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?oe.ELEMENT_ARRAY_BUFFER:oe.ARRAY_BUFFER}get index(){return this.type===oe.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new yl(t)}};class Mi{constructor(t,e=0,r=!1,s=ht.FLOAT,n,a,o,h=1){this.buffer=t,this.size=e,this.normalized=r,this.type=s,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(t,e,r,s,n){return new Mi(t,e,r,s,n)}}const Bd={Float32Array,Uint32Array,Int32Array,Uint8Array};function kd(i,t){let e=0,r=0;const s={};for(let h=0;h<i.length;h++)r+=t[h],e+=i[h].length;const n=new ArrayBuffer(e*4);let a=null,o=0;for(let h=0;h<i.length;h++){const l=t[h],u=i[h],c=pl(u);s[c]||(s[c]=new Bd[c](n)),a=s[c];for(let f=0;f<u.length;f++){const p=(f/l|0)*r+o,g=f%l;a[p+g]=u[f]}o+=l}return new Float32Array(n)}const Lo={5126:4,5123:2,5121:1};let Dd=0;const Ud={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class gr{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Dd++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Qt("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,s=!1,n,a,o,h=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ht||(e instanceof Array&&(e=new Float32Array(e)),e=new Ht(e));const l=t.split("|");if(l.length>1){for(let c=0;c<l.length;c++)this.addAttribute(l[c],e,r,s,n);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new Mi(u,r,s,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ht||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ht(t)),t.type=oe.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new Ht;let s;for(s in this.attributes){const n=this.attributes[s],a=this.buffers[n.buffer];t.push(a.data),e.push(n.size*Lo[n.type]/4),n.buffer=0}for(r.data=kd(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new gr;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ht(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new Mi(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=oe.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new gr,r=[],s=[],n=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)s[h]=s[h]||0,s[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)r[o]=new Ud[pl(a.buffers[o].data)](s[o]),e.buffers[o]=new Ht(r[o]);for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)r[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=oe.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,u=0;for(let c=0;c<a.buffers.length;c++)if(a.buffers[c]!==a.indexBuffer){u=c;break}for(const c in a.attributes){const f=a.attributes[c];(f.buffer|0)===u&&(h+=f.size*Lo[f.type]/4)}for(let c=0;c<t.length;c++){const f=t[c].indexBuffer.data;for(let p=0;p<f.length;p++)e.indexBuffer.data[p+l]+=o;o+=t[c].buffers[u].data.length/h,l+=f.length}}return e}}class Gd extends gr{constructor(t=!1){super(),this._buffer=new Ht(null,t,!1),this._indexBuffer=new Ht(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ht.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ht.FLOAT).addAttribute("aColor",this._buffer,4,!0,ht.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ht.FLOAT).addIndex(this._indexBuffer)}}const $d=Math.PI*2,Vd=180/Math.PI,zd=Math.PI/180;var _l=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(_l||{});class Ut{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Ut(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}Ut.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Zr=[new Ut,new Ut,new Ut,new Ut];class Et{constructor(t=0,e=0,r=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(s),this.type=_l.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Et(0,0,0,0)}clone(){return new Et(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const B=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=B)return!1;const U=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>U}const r=this.left,s=this.right,n=this.top,a=this.bottom;if(s<=r||a<=n)return!1;const o=Zr[0].set(t.left,t.top),h=Zr[1].set(t.left,t.bottom),l=Zr[2].set(t.right,t.top),u=Zr[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(c===0||(e.apply(o,o),e.apply(h,h),e.apply(l,l),e.apply(u,u),Math.max(o.x,h.x,l.x,u.x)<=r||Math.min(o.x,h.x,l.x,u.x)>=s||Math.max(o.y,h.y,l.y,u.y)<=n||Math.min(o.y,h.y,l.y,u.y)>=a))return!1;const f=c*(h.y-o.y),p=c*(o.x-h.x),g=f*r+p*n,y=f*s+p*n,d=f*r+p*a,m=f*s+p*a;if(Math.max(g,y,d,m)<=f*o.x+p*o.y||Math.min(g,y,d,m)>=f*u.x+p*u.y)return!1;const _=c*(o.y-l.y),x=c*(l.x-o.x),E=_*r+x*n,v=_*s+x*n,A=_*r+x*a,b=_*s+x*a;return!(Math.max(E,v,A,b)<=_*o.x+x*o.y||Math.min(E,v,A,b)>=_*u.x+x*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=s,this.height=n-s,this}}Et.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Bt{constructor(t=1,e=0,r=0,s=1,n=0,a=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,s,n,a){return this.a=t,this.b=e,this.c=r,this.d=s,this.tx=n,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Ut;const r=t.x,s=t.y;return e.x=this.a*r+this.c*s+this.tx,e.y=this.b*r+this.d*s+this.ty,e}applyInverse(t,e){e=e||new Ut;const r=1/(this.a*this.d+this.c*-this.b),s=t.x,n=t.y;return e.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),s=this.a,n=this.c,a=this.tx;return this.a=s*e-this.b*r,this.b=s*r+this.b*e,this.c=n*e-this.d*r,this.d=n*r+this.d*e,this.tx=a*e-this.ty*r,this.ty=a*r+this.ty*e,this}append(t){const e=this.a,r=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*r+t.ty*n+this.ty,this}setTransform(t,e,r,s,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(r*this.a+s*this.c),this.ty=e-(r*this.b+s*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,s=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=s*t.a+this.d*t.c,this.d=s*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,s=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-s,n),h=Math.atan2(r,e),l=Math.abs(o+h);return l<1e-5||Math.abs($d-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(s*s+n*n),t.position.x=this.tx+(a.x*e+a.y*s),t.position.y=this.ty+(a.x*r+a.y*n),t}invert(){const t=this.a,e=this.b,r=this.c,s=this.d,n=this.tx,a=t*s-e*r;return this.a=s/a,this.b=-e/a,this.c=-r/a,this.d=t/a,this.tx=(r*this.ty-s*n)/a,this.ty=-(t*this.ty-e*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Bt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Bt}static get TEMP_MATRIX(){return new Bt}}Bt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Pe=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ne=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Oe=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Be=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],vn=[],vl=[],Jr=Math.sign;function Hd(){for(let i=0;i<16;i++){const t=[];vn.push(t);for(let e=0;e<16;e++){const r=Jr(Pe[i]*Pe[e]+Oe[i]*Ne[e]),s=Jr(Ne[i]*Pe[e]+Be[i]*Ne[e]),n=Jr(Pe[i]*Oe[e]+Oe[i]*Be[e]),a=Jr(Ne[i]*Oe[e]+Be[i]*Be[e]);for(let o=0;o<16;o++)if(Pe[o]===r&&Ne[o]===s&&Oe[o]===n&&Be[o]===a){t.push(o);break}}}for(let i=0;i<16;i++){const t=new Bt;t.set(Pe[i],Ne[i],Oe[i],Be[i],0,0),vl.push(t)}}Hd();const Rt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Pe[i],uY:i=>Ne[i],vX:i=>Oe[i],vY:i=>Be[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>vn[i][t],sub:(i,t)=>vn[i][Rt.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?Rt.S:Rt.N:Math.abs(t)*2<=Math.abs(i)?i>0?Rt.E:Rt.W:t>0?i>0?Rt.SE:Rt.SW:i>0?Rt.NE:Rt.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const s=vl[Rt.inv(t)];s.tx=e,s.ty=r,i.append(s)}};class Ae{constructor(t,e,r=0,s=0){this._x=r,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Ae(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}Ae.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const bn=class{constructor(){this.worldTransform=new Bt,this.localTransform=new Bt,this.position=new Ae(this.onChange,this,0,0),this.scale=new Ae(this.onChange,this,1,1),this.pivot=new Ae(this.onChange,this,0,0),this.skew=new Ae(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};bn.IDENTITY=new bn;let zn=bn;zn.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var qd=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Xd=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Fo(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function sn(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function bl(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return sn(2*t);case"bvec3":return sn(3*t);case"bvec4":return sn(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const pr=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],jd={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Wd={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Yd(i,t){const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in i.uniforms){const s=t[r];if(!s){i.uniforms[r]?.group===!0&&(i.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const n=i.uniforms[r];let a=!1;for(let o=0;o<pr.length;o++)if(pr[o].test(s,n)){e.push(pr[o].code(r,n)),a=!0;break}if(!a){const o=(s.size===1&&!s.isArray?jd:Wd)[s.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${o};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const xl={};let Qr=xl;function Kd(){if(Qr===xl||Qr?.isContextLost()){const i=ft.ADAPTER.createCanvas();let t;ft.PREFER_ENV>=ze.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Qr=t}return Qr}let ti;function Zd(){if(!ti){ti=qt.MEDIUM;const i=Kd();if(i&&i.getShaderPrecisionFormat){const t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(ti=t.precision?qt.HIGH:qt.MEDIUM)}}return ti}function Po(i,t){const e=i.getShaderSource(t).split(`
`).map((l,u)=>`${u}: ${l}`),r=i.getShaderInfoLog(t),s=r.split(`
`),n={},a=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{e[l-1]=`%c${e[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=e.join(`
`);o[0]=h,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function Jd(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||Po(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||Po(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const Qd={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function wl(i){return Qd[i]}let ei=null;const No={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Tl(i,t){if(!ei){const e=Object.keys(No);ei={};for(let r=0;r<e.length;++r){const s=e[r];ei[i[s]]=No[s]}}return ei[t]}function Oo(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===qt.HIGH&&e!==qt.HIGH&&(r=qt.MEDIUM),`precision ${r} float;
${i}`}else if(e!==qt.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let Tr;function tf(){if(typeof Tr=="boolean")return Tr;try{Tr=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Tr=!1}return Tr}let ef=0;const ri={},xn=class lr{constructor(t,e,r="pixi-shader",s={}){this.extra={},this.id=ef++,this.vertexSrc=t||lr.defaultVertexSrc,this.fragmentSrc=e||lr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),ri[r]?(ri[r]++,r+=`-${ri[r]}`):ri[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Oo(this.vertexSrc,lr.defaultVertexPrecision,qt.HIGH),this.fragmentSrc=Oo(this.fragmentSrc,lr.defaultFragmentPrecision,Zd())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Xd}static get defaultFragmentSrc(){return qd}static from(t,e,r){const s=t+e;let n=Io[s];return n||(Io[s]=n=new lr(t,e,r)),n}};xn.defaultVertexPrecision=qt.HIGH,xn.defaultFragmentPrecision=ur.apple.device?qt.HIGH:qt.MEDIUM;let Ue=xn,rf=0;class he{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=rf++,this.static=!!e,this.ubo=!!r,t instanceof Ht?(this.buffer=t,this.buffer.type=oe.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ht(new Float32Array(1)),this.buffer.type=oe.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new he(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new he(t,e,r)}static uboFrom(t,e){return new he(t,e??!0,!0)}}class Ui{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof he?this.uniformGroup=e:this.uniformGroup=new he(e):this.uniformGroup=new he({}),this.disposeRunner=new Qt("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const s=e.uniforms[r];if(s.group===!0&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const s=Ue.from(t,e);return new Ui(s,r)}}class sf{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=n;this.defaultGroupCache[t]=he.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${t}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ue(this.vertexSrc,s)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Bt,default:this.defaultGroupCache[t]};return new Ui(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class nf{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function af(){return!ur.apple.device}function of(i){let t=!0;const e=ft.ADAPTER.getNavigator();if(ur.tablet||ur.phone){if(ur.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(ur.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}class El{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var hf=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,lf=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Ir=class Jt extends El{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Gd,this.vertexSize=6,this.state=vr.for2d(),this.size=Jt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??of(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??af(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return xt("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return lf}static get defaultFragmentTemplate(){return hf}setShaderGenerator({vertex:t=Jt.defaultVertexSrc,fragment:e=Jt.defaultFragmentTemplate}={}){this.shaderGenerator=new sf(t,e)}contextChange(){const t=this.renderer.gl;ft.PREFER_ENV===ze.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Jt.defaultMaxTextures),this.maxTextures=Fd(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=Jt,r=this.size/4,s=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new Nd);for(;e.length<s;)e.push(new nf);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=Jt._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count;let o=++wt._globalBatch,h=0,l=r[0],u=0;s.copyBoundTextures(n,e);for(let c=0;c<this._bufferSize;++c){const f=t[c];t[c]=null,f._batchEnabled!==o&&(l.count>=e&&(s.boundArray(l,n,o,e),this.buildDrawCalls(l,u,c),u=c,l=r[++h],++o),f._batchEnabled=o,f.touched=a,l.elements[l.count++]=f)}l.count>0&&(s.boundArray(l,n,o,e),this.buildDrawCalls(l,u,this._bufferSize),++h,++o);for(let c=0;c<n.length;c++)n[c]=null;wt._globalBatch=o}buildDrawCalls(t,e,r){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:a,vertexSize:o}=this,h=Jt._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,f=h[l];f.start=this._iIndex,f.texArray=t;for(let p=e;p<r;++p){const g=s[p],y=g._texture.baseTexture,d=Sd[y.alphaMode?1:0][g.blendMode];s[p]=null,e<p&&f.blend!==d&&(f.size=c-f.start,e=p,f=h[++l],f.texArray=t,f.start=c),this.packInterleavedGeometry(g,n,a,u,c),u+=g.vertexData.length/2*o,c+=g.indices.length,f.blend=d}e<r&&(f.size=c-f.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;Jt.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,s=Jt._drawCallPool;let n=null;for(let a=0;a<t;a++){const{texArray:o,type:h,size:l,start:u,blend:c}=s[a];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,r.set(this.state),e.drawElements(h,l,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Jt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=Si(Math.ceil(t/8)),r=Mo(e),s=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new Rd(s*this.vertexSize*4)),n}getIndexBuffer(t){const e=Si(Math.ceil(t/12)),r=Mo(e),s=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let n=this._iBuffers[r];return n||(this._iBuffers[r]=n=new Uint16Array(s)),n}packInterleavedGeometry(t,e,r,s,n){const{uint32View:a,float32View:o}=e,h=s/this.vertexSize,l=t.uvs,u=t.indices,c=t.vertexData,f=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),g=$e.shared.setValue(t._tintRGB).toPremultiplied(p,t._texture.baseTexture.alphaMode>0);for(let y=0;y<c.length;y+=2)o[s++]=c[y],o[s++]=c[y+1],o[s++]=l[y],o[s++]=l[y+1],a[s++]=g,o[s++]=f;for(let y=0;y<u.length;y++)r[n++]=h+u[y]}};Ir.defaultBatchSize=4096,Ir.extension={name:"batch",type:lt.RendererPlugin},Ir._drawCallPool=[],Ir._textureArrayPool=[];let ke=Ir;_t.add(ke);var uf=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,cf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const wn=class Rr extends Ui{constructor(t,e,r){const s=Ue.from(t||Rr.defaultVertexSrc,e||Rr.defaultFragmentSrc);super(s,r),this.padding=0,this.resolution=Rr.defaultResolution,this.multisample=Rr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new vr}apply(t,e,r,s,n){t.applyFilter(this,e,r,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return cf}static get defaultFragmentSrc(){return uf}};wn.defaultResolution=1,wn.defaultMultisample=Pt.NONE;let jt=wn;class Ii{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new $e(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:s}=t,n=r??e;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Ii.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Ii.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"background"};_t.add(Ii);class Al{constructor(t){this.renderer=t,this.emptyRenderer=new El(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=r[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,r,s){const{elements:n,ids:a,count:o}=t;let h=0;for(let l=0;l<o;l++){const u=n[l],c=u._batchLocation;if(c>=0&&c<s&&e[c]===u){a[l]=c;continue}for(;h<s;){const f=e[h];if(f&&f._batchEnabled===r&&f._batchLocation===h){h++;continue}a[l]=h,u._batchLocation=h,e[h]=u;break}}}destroy(){this.renderer=null}}Al.extension={type:lt.RendererSystem,name:"batch"};_t.add(Al);let Bo=0;class Ri{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Bo++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Bo++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(ft.PREFER_ENV>=ze.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Ri.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Ri.extension={type:lt.RendererSystem,name:"context"};_t.add(Ri);class Tn{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Qt("disposeFramebuffer"),this.multisample=Pt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new wt(null,{scaleMode:pe.NEAREST,resolution:1,mipmap:Ge.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new wt(null,{scaleMode:pe.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Ge.OFF,format:X.DEPTH_COMPONENT,type:ht.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const s=this.colorTextures[r],n=s.resolution;s.setSize(t/n,e/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Sl extends wt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],s=arguments[2],n=arguments[3];t={width:e,height:r,scaleMode:s,resolution:n}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=Pt.NONE),super(null,t),this.mipmap=Ge.OFF,this.valid=!0,this._clear=new $e([0,0,0,0]),this.framebuffer=new Tn(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class me extends Vr{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,s=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(r,s),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=Id(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,s){const n=t.gl,a=e.realWidth,o=e.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===He.UNPACK),!this.noSubImage&&e.target===n.TEXTURE_2D&&r.width===a&&r.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.format,r.type,s):(r.width=a,r.height=o,n.texImage2D(e.target,0,r.internalFormat,e.format,r.type,s)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class Ml extends me{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;me.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??ft.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>e(s,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===He.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let s=!0;const n=e._glTextures;for(const a in n){const o=n[a];if(o!==r&&o.dirtyId!==e.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Hn{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const s=e.width,n=e.height;if(r){const a=t.width/2/s,o=t.height/2/n,h=t.x/s+a,l=t.y/n+o;r=Rt.add(r,Rt.NW),this.x0=h+a*Rt.uX(r),this.y0=l+o*Rt.uY(r),r=Rt.add(r,2),this.x1=h+a*Rt.uX(r),this.y1=l+o*Rt.uY(r),r=Rt.add(r,2),this.x2=h+a*Rt.uX(r),this.y2=l+o*Rt.uY(r),r=Rt.add(r,2),this.x3=h+a*Rt.uX(r),this.y3=l+o*Rt.uY(r)}else this.x0=t.x/s,this.y0=t.y/n,this.x1=(t.x+t.width)/s,this.y1=t.y/n,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/n,this.x3=t.x/s,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Hn.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const ko=new Hn;function ii(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class gt extends Bi{constructor(t,e,r,s,n,a,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Et(0,0,1,1)),t instanceof gt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=ko,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Ut(a.x,a.y):new Ut(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&ie[e.url]&&gt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,gt.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new gt(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===ko&&(this._uvs=new Hn),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=ft.STRICT_TEXTURE_CACHE){const s=typeof t=="string";let n=null;if(s)n=t;else if(t instanceof wt){if(!t.cacheId){const o=e?.pixiIdPrefix||"pixiid";t.cacheId=`${o}-${$r()}`,wt.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${$r()}`}n=t._pixiId}let a=ie[n];if(s&&r&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(t instanceof wt)?(e.resolution||(e.resolution=Ro(t)),a=new gt(new wt(t,e)),a.baseTexture.cacheId=n,wt.addToCache(a.baseTexture,n),gt.addToCache(a,n)):!a&&t instanceof wt&&(a=new gt(t),gt.addToCache(a,n)),a}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),s=gt.from(t,Object.assign({resourceOptions:r},e),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(t,e,r,s){return new gt(wt.fromBuffer(t,e,r,s))}static fromLoader(t,e,r,s){const n=new wt(t,Object.assign({scaleMode:wt.defaultOptions.scaleMode,resolution:Ro(e)},s)),{resource:a}=n;a instanceof Ml&&(a.url=e);const o=new gt(n);return r||(r=e),wt.addToCache(o.baseTexture,r),gt.addToCache(o,r),r!==e&&(wt.addToCache(o.baseTexture,e),gt.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once("loaded",()=>h(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ie[e]&&ie[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),ie[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=ie[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete ie[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)ie[t.textureCacheIds[e]]===t&&delete ie[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:s,height:n}=t,a=e+s>this.baseTexture.width,o=r+n>this.baseTexture.height;if(a||o){const h=a&&o?"and":"or",l=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,u=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return gt._EMPTY||(gt._EMPTY=new gt(new wt),ii(gt._EMPTY),ii(gt._EMPTY.baseTexture)),gt._EMPTY}static get WHITE(){if(!gt._WHITE){const t=ft.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),gt._WHITE=new gt(wt.from(t)),ii(gt._WHITE),ii(gt._WHITE.baseTexture)}return gt._WHITE}}class Gi extends gt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const s=this.baseTexture.resolution,n=Math.round(t*s)/s,a=Math.round(e*s)/s;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Gi(new Sl(t))}}class Il{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=Pt.NONE){const s=new Sl(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Gi(s)}getOptimalTexture(t,e,r=1,s=Pt.NONE){let n;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Si(t),e=Si(e),n=((t&65535)<<16|e&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(t,e,s)),a.filterPoolKey=n,a.setResolution(r),a}getFilterTexture(t,e,r){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||Pt.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Il.SCREEN_KEY=-1;class df extends gr{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class ff extends gr{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ht(this.vertices),this.uvBuffer=new Ht(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+e.width/t.width,this.uvs[3]=s,this.uvs[4]=r+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=r,this.uvs[7]=s+e.height/t.height,r=e.x,s=e.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+e.width,this.vertices[3]=s,this.vertices[4]=r+e.width,this.vertices[5]=s+e.height,this.vertices[6]=r,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class pf{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Pt.NONE,this.sourceFrame=new Et,this.destinationFrame=new Et,this.bindingSourceFrame=new Et,this.bindingDestinationFrame=new Et,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const si=[new Ut,new Ut,new Ut,new Ut],nn=new Bt;class Rl{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Il,this.statePool=[],this.quad=new df,this.quadUv=new ff,this.tempRect=new Et,this.activeState={},this.globalUniforms=new he({outputFrame:new Et,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new pf,a=r.renderTexture;let o,h;if(a.current){const d=a.current;o=d.resolution,h=d.multisample}else o=r.resolution,h=r.multisample;let l=e[0].resolution||o,u=e[0].multisample??h,c=e[0].padding,f=e[0].autoFit,p=e[0].legacy??!0;for(let d=1;d<e.length;d++){const m=e[d];l=Math.min(l,m.resolution||o),u=Math.min(u,m.multisample??h),c=this.useMaxPadding?Math.max(c,m.padding):c+m.padding,f=f&&m.autoFit,p=p||(m.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(n),n.resolution=l,n.multisample=u,n.legacy=p,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(c);const g=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(nn.copyFrom(r.projection.transform).invert(),g),f?(n.sourceFrame.fit(g),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(g)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,l,u),n.filters=e,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const y=this.tempRect;y.x=0,y.y=0,y.width=n.sourceFrame.width,y.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,y),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const n=s.inputSize,a=s.inputPixel,o=s.inputClamp;if(n[0]=e.destinationFrame.width,n[1]=e.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*e.resolution),a[1]=Math.round(n[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*n[2]-.5*a[2],o[3]=e.sourceFrame.height*n[3]-.5*a[3],e.legacy){const l=s.filterArea;l[0]=e.destinationFrame.width,l[1]=e.destinationFrame.height,l[2]=e.sourceFrame.x,l[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,h.renderTexture,ne.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let l=e.renderTexture,u=this.getOptimalFilterTexture(l.width,l.height,e.resolution);u.filterFrame=l.filterFrame;let c=0;for(c=0;c<r.length-1;++c){c===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(l.width,l.height,e.resolution),u.filterFrame=l.filterFrame),r[c].apply(this,l,u,ne.CLEAR,e);const f=l;l=u,u=f}r[c].apply(this,l,h.renderTexture,ne.BLEND,e),c>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=ne.CLEAR){const{renderTexture:r,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,r.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(e===ne.CLEAR||e===ne.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,s){const n=this.renderer;n.state.set(t.state),this.bindAndClear(r,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Ai.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Ai.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=e._texture,a=t.set(s.width,0,0,s.height,r.x,r.y),o=e.worldTransform.copyTo(Bt.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,s=Pt.NONE){return this.texturePool.getOptimalTexture(t,e,r,s)}getFilterTexture(t,e,r){if(typeof t=="number"){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||Pt.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=si[0],s=si[1],n=si[2],a=si[3];r.set(e.left,e.top),s.set(e.left,e.bottom),n.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(r,r),t.apply(s,s),t.apply(n,n),t.apply(a,a);const o=Math.min(r.x,s.x,n.x,a.x),h=Math.min(r.y,s.y,n.y,a.y),l=Math.max(r.x,s.x,n.x,a.x),u=Math.max(r.y,s.y,n.y,a.y);e.x=o,e.y=h,e.width=l-o,e.height=u-h}roundFrame(t,e,r,s,n){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?nn.copyFrom(n):nn.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,t),t.ceil(e),this.transformAABB(n.invert(),t)}}}Rl.extension={type:lt.RendererSystem,name:"filter"};_t.add(Rl);class mf{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Pt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const gf=new Et;class Cl{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Tn(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Et,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;ft.PREFER_ENV===ze.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=s=>e.drawBuffersWEBGL(s):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:s}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=r),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>r,o=e.height>>r,h=a/e.width;this.setViewport(e.x*h,e.y*h,a,o)}else{const a=t.width>>r,o=t.height>>r;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,s){const n=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==t||n.y!==e)&&(n.x=t,n.y=e,n.width=r,n.height=s,this.gl.viewport(t,e,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,s,n=fn.COLOR|fn.DEPTH){const{gl:a}=this;a.clearColor(t,e,r,s),a.clear(n)}initFramebuffer(t){const{gl:e}=this,r=new mf(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let a;this.renderer.context.webGLVersion===1?a=e.DEPTH_STENCIL:t.depth&&t.stencil?a=e.DEPTH24_STENCIL8:t.depth?a=e.DEPTH_COMPONENT24:a=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,a,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,a,t.width,t.height)}const s=t.colorTextures;let n=s.length;e.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=s[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,s=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let a=n.length;r.drawBuffers||(a=Math.min(a,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],u=l.parentTextureArray||l;this.renderer.texture.bind(u,0),h===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h,l.target,u._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+h))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||r.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH_STENCIL):t.depth&&t.stencil?(h=r.DEPTH_STENCIL_ATTACHMENT,l=r.DEPTH24_STENCIL8):t.depth?(h=r.DEPTH_ATTACHMENT,l=r.DEPTH_COMPONENT24):(h=r.STENCIL_ATTACHMENT,l=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,l,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,l,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,h,r.RENDERBUFFER,s.stencil)}else s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=Pt.NONE;if(t<=1||e===null)return r;for(let s=0;s<e.length;s++)if(e[s]<=t){r=e[s];break}return r===1&&(r=Pt.NONE),r}blit(t,e,r){const{current:s,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!s)return;const h=s.glFramebuffers[o];if(!h)return;if(!t){if(!h.msaaBuffer)return;const u=s.colorTextures[0];if(!u)return;h.blitFramebuffer||(h.blitFramebuffer=new Tn(s.width,s.height),h.blitFramebuffer.addColorTexture(0,u)),t=h.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==s.width||t.height!==s.height)&&(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||(e=gf,e.width=s.width,e.height=s.height),r||(r=e);const l=e.width===r.width&&e.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,s=t.height,n=this.gl,a=e.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a);let o,h;this.renderer.context.webGLVersion===1?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):t.depth?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(o=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),e.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,e.multisample,h,r,s):n.renderbufferStorage(n.RENDERBUFFER,h,r,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,o,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Et}destroy(){this.renderer=null}}Cl.extension={type:lt.RendererSystem,name:"framebuffer"};_t.add(Cl);const an={5126:4,5123:2,5121:1};class Ll{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;ft.PREFER_ENV===ze.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=s=>r.bindVertexArrayOES(s),t.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),t.drawElementsInstanced=(s,n,a,o,h)=>r.drawElementsInstancedANGLE(s,n,a,o,h),t.drawArraysInstanced=(s,n,a,o)=>r.drawArraysInstancedANGLE(s,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const a=s[e.program.id]||this.initGeometryVao(t,e,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const s=t.buffers[r];e.update(s)}}checkCompatibility(t,e){const r=t.attributes,s=e.attributeData;for(const n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,e){const r=t.attributes,s=e.attributeData,n=["g",t.id];for(const a in r)s[a]&&n.push(a,s[a].location);return n.join("-")}initGeometryVao(t,e,r=!0){const s=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[n]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const h=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let u=l[h];if(u)return l[o.id]=u,u;const c=t.buffers,f=t.attributes,p={},g={};for(const y in c)p[y]=0,g[y]=0;for(const y in f)!f[y].size&&o.attributeData[y]?f[y].size=o.attributeData[y].size:f[y].size||console.warn(`PIXI Geometry attribute '${y}' size cannot be determined (likely the bound shader does not have the attribute)`),p[f[y].buffer]+=f[y].size*an[f[y].type];for(const y in f){const d=f[y],m=d.size;d.stride===void 0&&(p[d.buffer]===m*an[d.type]?d.stride=0:d.stride=p[d.buffer]),d.start===void 0&&(d.start=g[d.buffer],g[d.buffer]+=m*an[d.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(let y=0;y<c.length;y++){const d=c[y];a.bind(d),r&&d._glBuffers[n].refCount++}return this.activateVao(t,o),l[o.id]=u,l[h]=u,s.bindVertexArray(null),a.unbind(oe.ARRAY_BUFFER),u}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,a=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!r){if(a)for(let o=0;o<n.length;o++){const h=n[o]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&a.dispose(n[o],e))}if(!e){for(const o in r)if(o[0]==="g"){const h=r[o];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in o){const u=o[l],c=a[u.buffer],f=c._glBuffers[s];if(e.attributeData[l]){h!==f&&(n.bind(c),h=f);const p=e.attributeData[l].location;if(r.enableVertexAttribArray(p),r.vertexAttribPointer(p,u.size,u.type||r.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)r.vertexAttribDivisor(p,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,s){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,e||a.indexBuffer.data.length,h,(r||0)*o,s||1):n.drawElements(t,e||a.indexBuffer.data.length,h,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(t,r,e||a.getSize(),s||1):n.drawArrays(t,r,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Ll.extension={type:lt.RendererSystem,name:"geometry"};_t.add(Ll);const Do=new Bt;class yf{constructor(t,e){this._texture=t,this.mapCoord=new Bt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let s=0;s<t.length;s+=2){const n=t[s],a=t[s+1];e[s]=n*r.a+a*r.c+r.tx,e[s+1]=n*r.b+a*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=e.orig,n=e.trim;n&&(Do.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Do));const a=e.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(e._frame.x+h+l)/a.width,o[1]=(e._frame.y+h+l)/a.height,o[2]=(e._frame.x+e._frame.width-h+l)/a.width,o[3]=(e._frame.y+e._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}var _f=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,vf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class bf extends jt{constructor(t,e,r){let s=null;typeof t!="string"&&e===void 0&&r===void 0&&(s=t,t=void 0,e=void 0,r=void 0),super(t||vf,e||_f,r),this.maskSprite=s,this.maskMatrix=new Bt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,s){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new yf(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,r,s))}}class xf{constructor(t=null){this.type=Ot.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=jt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Ot.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Fl{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const n=this.maskDataPool.pop()||new xf;n.pooled=!0,n.maskObject=e,r=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==Ot.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Ot.SCISSOR:this.renderer.scissor.push(r);break;case Ot.STENCIL:this.renderer.stencil.push(r);break;case Ot.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Ot.COLOR:this.pushColorMask(r);break}r.type===Ot.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Ot.SCISSOR:this.renderer.scissor.pop(e);break;case Ot.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Ot.SPRITE:this.popSpriteMask(e);break;case Ot.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===Ot.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=Ot.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Ot.SCISSOR:t.type=Ot.STENCIL:t.type=Ot.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new bf])),s[0].resolution=t.resolution,s[0].multisample=t.multisample,s[0].maskSprite=e;const n=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,s),r.filterArea=n,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}Fl.extension={type:lt.RendererSystem,name:"mask"};_t.add(Fl);class Pl{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==r&&(s===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Uo=new Bt,Go=[],Nl=class bi extends Pl{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:s}=this,n=s.renderTexture,a=r.getBounds(!0,Go.pop()??new Et);this.roundFrameToPixels(a,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),e&&a.fit(e),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:s,d:n}=t;return(Math.abs(r)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||bi.isMatrixRotated(e.worldTransform)||bi.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,s,n){bi.isMatrixRotated(n)||(n=n?Uo.copyFrom(n):Uo.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Go.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Nl.extension={type:lt.RendererSystem,name:"scissor"};let wf=Nl;_t.add(wf);class Ol extends Pl{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(t._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(r._colorMask=s,e.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Ol.extension={type:lt.RendererSystem,name:"stencil"};_t.add(Ol);class Bl{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return xt("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return xt("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return xt("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Bl.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"_plugin"};_t.add(Bl);class kl{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Bt,this.transform=null}update(t,e,r,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,e,r,s){const n=this.projectionMatrix,a=s?-1:1;n.identity(),n.a=1/e.width*2,n.d=a*(1/e.height*2),n.tx=-1-e.x*n.a,n.ty=-a-e.y*n.d}setTransform(t){}destroy(){this.renderer=null}}kl.extension={type:lt.RendererSystem,name:"projection"};_t.add(kl);const Tf=new zn,$o=new Et;class Dl{constructor(t){this.renderer=t,this._tempMatrix=new Bt}generateTexture(t,e){const{region:r,...s}=e||{},n=r?.copyTo($o)||t.getLocalBounds($o,!0),a=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a),s.width=n.width,s.height=n.height,s.resolution=a,s.multisample??(s.multisample=this.renderer.multisample);const o=Gi.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const h=t.transform;return t.transform=Tf,this.renderer.render(t,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,o}destroy(){}}Dl.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"textureGenerator"};_t.add(Dl);const Ce=new Et,Er=new Et;class Ul{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Et,this.destinationFrame=new Et,this.viewportFrame=new Et}contextChange(){const t=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const s=this.renderer;this.current=t;let n,a,o;t?(n=t.baseTexture,o=n.resolution,e||(Ce.width=t.frame.width,Ce.height=t.frame.height,e=Ce),r||(Er.x=t.frame.x,Er.y=t.frame.y,Er.width=e.width,Er.height=e.height,r=Er),a=n.framebuffer):(o=s.resolution,e||(Ce.width=s._view.screen.width,Ce.height=s._view.screen.height,e=Ce),r||(r=Ce,r.width=e.width,r.height=e.height));const h=this.viewportFrame;h.x=r.x*o,h.y=r.y*o,h.width=r.width*o,h.height=r.height*o,t||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(r,e,o,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=$e.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==a.width||n.height!==a.height;if(o){let{x:h,y:l,width:u,height:c}=this.viewportFrame;h=Math.round(h),l=Math.round(l),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,u,c)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Ul.extension={type:lt.RendererSystem,name:"renderTexture"};_t.add(Ul);class Ef{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Af(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const n=t.getActiveAttrib(i,s);if(n.name.startsWith("gl_"))continue;const a=Tl(t,n.type),o={type:a,name:n.name,size:wl(a),location:t.getAttribLocation(i,n.name)};e[n.name]=o}return e}function Sf(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const n=t.getActiveUniform(i,s),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=Tl(t,n.type);e[a]={name:a,index:s,type:h,size:n.size,isArray:o,value:bl(h,n.size)}}return e}function Mf(i,t){const e=Fo(i,i.VERTEX_SHADER,t.vertexSrc),r=Fo(i,i.FRAGMENT_SHADER,t.fragmentSrc),s=i.createProgram();i.attachShader(s,e),i.attachShader(s,r);const n=t.extra?.transformFeedbackVaryings;if(n&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||Jd(i,s,e,r),t.attributeData=Af(s,i),t.uniformData=Sf(s,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const o=Object.keys(t.attributeData);o.sort((h,l)=>h>l?1:-1);for(let h=0;h<o.length;h++)t.attributeData[o[h]].location=h,i.bindAttribLocation(s,h,o[h]);i.linkProgram(s)}i.deleteShader(e),i.deleteShader(r);const a={};for(const o in t.uniformData){const h=t.uniformData[o];a[o]={location:i.getUniformLocation(s,o),value:bl(h.type,h.size)}}return new Ef(s,a)}function If(i,t,e,r,s){e.buffer.update(s)}const Rf={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Gl={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function Cf(i){const t=i.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let e=0,r=0,s=0;for(let n=0;n<t.length;n++){const a=t[n];if(e=Gl[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,r%e!==0&&r<16){const o=r%e%16;r+=o,s+=o}r+e>16?(s=Math.ceil(s/16)*16,a.offset=s,s+=e,r=e):(a.offset=s,r+=e,s+=e)}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function Lf(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,s)=>r.index-s.index),e}function Ff(i,t){if(!i.autoManage)return{size:0,syncFunc:If};const e=Lf(i.uniforms,t),{uboElements:r,size:s}=Cf(e),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const o=r[a],h=i.uniforms[o.data.name],l=o.data.name;let u=!1;for(let c=0;c<pr.length;c++){const f=pr[c];if(f.codeUbo&&f.test(o.data,h)){n.push(`offset = ${o.offset/4};`,pr[c].codeUbo(o.data.name,h)),u=!0;break}}if(!u)if(o.data.size>1){const c=wl(o.data.type),f=Math.max(Gl[o.data.type]/16,1),p=c/f,g=(4-p%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*f}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${g};
                }

                `)}else{const c=Rf[o.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};
                ${c};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let Pf=0;const ni={textureCount:0,uboCount:0};class $l{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Pf++}systemCheck(){if(!tf())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),e||(ni.textureCount=0,ni.uboCount=0,this.syncUniformGroup(t.uniformGroup,ni)),s}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=Yd(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const s=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),s(r.uniformData,t.uniforms,this.renderer,ni,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=Ff(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(o.size/4);t.buffer.update(h)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const s=t.uniforms,n=[`${r}-`];for(const a in s)n.push(a),e[a]&&n.push(e[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,s=Mf(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}$l.extension={type:lt.RendererSystem,name:"shader"};_t.add($l);class Ci{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.3 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Ci.defaultOptions={hello:!1},Ci.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"startup"};_t.add(Ci);function Nf(i,t=[]){return t[st.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.ADD]=[i.ONE,i.ONE],t[st.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.NONE]=[0,0],t[st.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[st.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[st.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[st.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[st.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[st.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[st.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[st.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[st.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[st.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[st.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const Of=0,Bf=1,kf=2,Df=3,Uf=4,Gf=5,Vl=class En{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=st.NONE,this._blendEq=!1,this.map=[],this.map[Of]=this.setBlend,this.map[Bf]=this.setOffset,this.map[kf]=this.setCullFace,this.map[Df]=this.setDepthTest,this.map[Uf]=this.setFrontFace,this.map[Gf]=this.setDepthMask,this.checks=[],this.defaultState=new vr,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=Nf(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(En.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(En.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};Vl.extension={type:lt.RendererSystem,name:"state"};let $f=Vl;_t.add($f);class Vf extends Bi{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(s=>t.systems[s]),r=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of r)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Qt(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(s=>{const n=r.find(a=>this._systemsHash[a]===s);s[t.name](e[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Cr=class xi{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=xi.defaultMaxIdle,this.checkCountMax=xi.defaultCheckCountMax,this.mode=xi.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Un.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let s=0;s<e.length;s++){const n=e[s];n.resource&&this.count-n.touched>this.maxIdle&&(t.destroyTexture(n,!0),e[s]=null,r=!0)}if(r){let s=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[s++]=e[n]);e.length=s}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let s=t.children.length-1;s>=0;s--)this.unload(t.children[s])}destroy(){this.renderer=null}};Cr.defaultMode=Un.AUTO,Cr.defaultMaxIdle=3600,Cr.defaultCheckCountMax=600,Cr.extension={type:lt.RendererSystem,name:"textureGC"};let De=Cr;_t.add(De);class on{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ht.UNSIGNED_BYTE,this.internalFormat=X.RGBA,this.samplerType=0}}function zf(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:W.FLOAT,[i.RGBA]:W.FLOAT,[i.ALPHA]:W.FLOAT,[i.LUMINANCE]:W.FLOAT,[i.LUMINANCE_ALPHA]:W.FLOAT,[i.R8]:W.FLOAT,[i.R8_SNORM]:W.FLOAT,[i.RG8]:W.FLOAT,[i.RG8_SNORM]:W.FLOAT,[i.RGB8]:W.FLOAT,[i.RGB8_SNORM]:W.FLOAT,[i.RGB565]:W.FLOAT,[i.RGBA4]:W.FLOAT,[i.RGB5_A1]:W.FLOAT,[i.RGBA8]:W.FLOAT,[i.RGBA8_SNORM]:W.FLOAT,[i.RGB10_A2]:W.FLOAT,[i.RGB10_A2UI]:W.FLOAT,[i.SRGB8]:W.FLOAT,[i.SRGB8_ALPHA8]:W.FLOAT,[i.R16F]:W.FLOAT,[i.RG16F]:W.FLOAT,[i.RGB16F]:W.FLOAT,[i.RGBA16F]:W.FLOAT,[i.R32F]:W.FLOAT,[i.RG32F]:W.FLOAT,[i.RGB32F]:W.FLOAT,[i.RGBA32F]:W.FLOAT,[i.R11F_G11F_B10F]:W.FLOAT,[i.RGB9_E5]:W.FLOAT,[i.R8I]:W.INT,[i.R8UI]:W.UINT,[i.R16I]:W.INT,[i.R16UI]:W.UINT,[i.R32I]:W.INT,[i.R32UI]:W.UINT,[i.RG8I]:W.INT,[i.RG8UI]:W.UINT,[i.RG16I]:W.INT,[i.RG16UI]:W.UINT,[i.RG32I]:W.INT,[i.RG32UI]:W.UINT,[i.RGB8I]:W.INT,[i.RGB8UI]:W.UINT,[i.RGB16I]:W.INT,[i.RGB16UI]:W.UINT,[i.RGB32I]:W.INT,[i.RGB32UI]:W.UINT,[i.RGBA8I]:W.INT,[i.RGBA8UI]:W.UINT,[i.RGBA16I]:W.INT,[i.RGBA16UI]:W.UINT,[i.RGBA32I]:W.INT,[i.RGBA32UI]:W.UINT,[i.DEPTH_COMPONENT16]:W.FLOAT,[i.DEPTH_COMPONENT24]:W.FLOAT,[i.DEPTH_COMPONENT32F]:W.FLOAT,[i.DEPTH_STENCIL]:W.FLOAT,[i.DEPTH24_STENCIL8]:W.FLOAT,[i.DEPTH32F_STENCIL8]:W.FLOAT}:t={[i.RGB]:W.FLOAT,[i.RGBA]:W.FLOAT,[i.ALPHA]:W.FLOAT,[i.LUMINANCE]:W.FLOAT,[i.LUMINANCE_ALPHA]:W.FLOAT,[i.DEPTH_STENCIL]:W.FLOAT},t}function Hf(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[ht.UNSIGNED_BYTE]:{[X.RGBA]:i.RGBA8,[X.RGB]:i.RGB8,[X.RG]:i.RG8,[X.RED]:i.R8,[X.RGBA_INTEGER]:i.RGBA8UI,[X.RGB_INTEGER]:i.RGB8UI,[X.RG_INTEGER]:i.RG8UI,[X.RED_INTEGER]:i.R8UI,[X.ALPHA]:i.ALPHA,[X.LUMINANCE]:i.LUMINANCE,[X.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ht.BYTE]:{[X.RGBA]:i.RGBA8_SNORM,[X.RGB]:i.RGB8_SNORM,[X.RG]:i.RG8_SNORM,[X.RED]:i.R8_SNORM,[X.RGBA_INTEGER]:i.RGBA8I,[X.RGB_INTEGER]:i.RGB8I,[X.RG_INTEGER]:i.RG8I,[X.RED_INTEGER]:i.R8I},[ht.UNSIGNED_SHORT]:{[X.RGBA_INTEGER]:i.RGBA16UI,[X.RGB_INTEGER]:i.RGB16UI,[X.RG_INTEGER]:i.RG16UI,[X.RED_INTEGER]:i.R16UI,[X.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[ht.SHORT]:{[X.RGBA_INTEGER]:i.RGBA16I,[X.RGB_INTEGER]:i.RGB16I,[X.RG_INTEGER]:i.RG16I,[X.RED_INTEGER]:i.R16I},[ht.UNSIGNED_INT]:{[X.RGBA_INTEGER]:i.RGBA32UI,[X.RGB_INTEGER]:i.RGB32UI,[X.RG_INTEGER]:i.RG32UI,[X.RED_INTEGER]:i.R32UI,[X.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[ht.INT]:{[X.RGBA_INTEGER]:i.RGBA32I,[X.RGB_INTEGER]:i.RGB32I,[X.RG_INTEGER]:i.RG32I,[X.RED_INTEGER]:i.R32I},[ht.FLOAT]:{[X.RGBA]:i.RGBA32F,[X.RGB]:i.RGB32F,[X.RG]:i.RG32F,[X.RED]:i.R32F,[X.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[ht.HALF_FLOAT]:{[X.RGBA]:i.RGBA16F,[X.RGB]:i.RGB16F,[X.RG]:i.RG16F,[X.RED]:i.R16F},[ht.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:i.RGB565},[ht.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:i.RGBA4},[ht.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:i.RGB5_A1},[ht.UNSIGNED_INT_2_10_10_10_REV]:{[X.RGBA]:i.RGB10_A2,[X.RGBA_INTEGER]:i.RGB10_A2UI},[ht.UNSIGNED_INT_10F_11F_11F_REV]:{[X.RGB]:i.R11F_G11F_B10F},[ht.UNSIGNED_INT_5_9_9_9_REV]:{[X.RGB]:i.RGB9_E5},[ht.UNSIGNED_INT_24_8]:{[X.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[ht.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[X.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[ht.UNSIGNED_BYTE]:{[X.RGBA]:i.RGBA,[X.RGB]:i.RGB,[X.ALPHA]:i.ALPHA,[X.LUMINANCE]:i.LUMINANCE,[X.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ht.UNSIGNED_SHORT_5_6_5]:{[X.RGB]:i.RGB},[ht.UNSIGNED_SHORT_4_4_4_4]:{[X.RGBA]:i.RGBA},[ht.UNSIGNED_SHORT_5_5_5_1]:{[X.RGBA]:i.RGBA}},t}class zl{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new wt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Hf(t),this.samplerTypes=zf(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let s=0;s<e;s++)this.boundTextures[s]=null;this.emptyTextures={};const r=new on(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new on(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(r)for(let n=t-1;n>=0;--n){const a=e[n];a&&a._glTextures[s].samplerType!==W.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new on(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??W.FLOAT,this.webGLVersion===2&&t.type===ht.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==W.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,n=t.realHeight,a=r.gl;(e.width!==s||e.height!==n||e.dirtyId<0)&&(e.width=s,e.height=n,a.texImage2D(t.target,0,e.internalFormat,s,n,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const s=this.managedTextures.indexOf(t);s!==-1&&vi(this.managedTextures,s,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Ge.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Dn.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==Ge.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===pe.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===pe.LINEAR){const n=Math.min(t.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===pe.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===pe.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}zl.extension={type:lt.RendererSystem,name:"texture"};_t.add(zl);class Hl{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:s}=this;e&&s.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:s}=this,n=e.createTransformFeedback();t._glTransformFeedbacks[s]=n,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];o&&(r.buffer.update(o),o._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&n.dispose(o,e))}r&&(e||s.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Hl.extension={type:lt.RendererSystem,name:"transformFeedback"};_t.add(Hl);class Li{constructor(t){this.renderer=t}init(t){this.screen=new Et(0,0,t.width,t.height),this.element=t.view||ft.ADAPTER.createCanvas(),this.resolution=t.resolution||ft.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Li.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Li.extension={type:[lt.RendererSystem,lt.CanvasRendererSystem],name:"_view"};_t.add(Li);ft.PREFER_ENV=ze.WEBGL2;ft.STRICT_TEXTURE_CACHE=!1;ft.RENDER_OPTIONS={...Ri.defaultOptions,...Ii.defaultOptions,...Li.defaultOptions,...Ci.defaultOptions};Object.defineProperties(ft,{WRAP_MODE:{get(){return wt.defaultOptions.wrapMode},set(i){xt("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),wt.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return wt.defaultOptions.scaleMode},set(i){xt("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),wt.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return wt.defaultOptions.mipmap},set(i){xt("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),wt.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return wt.defaultOptions.anisotropicLevel},set(i){xt("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),wt.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return xt("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),jt.defaultResolution},set(i){jt.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return xt("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),jt.defaultMultisample},set(i){jt.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return ke.defaultMaxTextures},set(i){xt("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),ke.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return ke.defaultBatchSize},set(i){xt("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),ke.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return ke.canUploadSameBuffer},set(i){xt("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),ke.canUploadSameBuffer=i}},GC_MODE:{get(){return De.defaultMode},set(i){xt("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),De.defaultMode=i}},GC_MAX_IDLE:{get(){return De.defaultMaxIdle},set(i){xt("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),De.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return De.defaultCheckCountMax},set(i){xt("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),De.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return Ue.defaultVertexPrecision},set(i){xt("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Ue.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return Ue.defaultFragmentPrecision},set(i){xt("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Ue.defaultFragmentPrecision=i}}});var Fi=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(Fi||{});class hn{constructor(t,e=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const ql=class zt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new hn(null,null,1/0),this.deltaMS=1/zt.targetFPMS,this.elapsedMS=1/zt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=Fi.NORMAL){return this._addListener(new hn(t,e,r))}addOnce(t,e,r=Fi.NORMAL){return this._addListener(new hn(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*zt.targetFPMS;const r=this._head;let s=r.next;for(;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,zt.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!zt._shared){const t=zt._shared=new zt;t.autoStart=!0,t._protected=!0}return zt._shared}static get system(){if(!zt._system){const t=zt._system=new zt;t.autoStart=!0,t._protected=!0}return zt._system}};ql.targetFPMS=.06;let Se=ql;Object.defineProperties(ft,{TARGET_FPMS:{get(){return Se.targetFPMS},set(i){xt("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Se.targetFPMS=i}}});class Xl{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Fi.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Se.shared:new Se,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Xl.extension=lt.Application;_t.add(Xl);const jl=[];_t.handleByList(lt.Renderer,jl);function qf(i){for(const t of jl)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var Xf=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const jf=Xf;class Wl{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=Pt.HIGH?this.multisample=Pt.HIGH:e>=Pt.MEDIUM?this.multisample=Pt.MEDIUM:e>=Pt.LOW?this.multisample=Pt.LOW:this.multisample=Pt.NONE}destroy(){}}Wl.extension={type:lt.RendererSystem,name:"_multisample"};_t.add(Wl);class Wf{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Yl{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const n=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,n.buffer)}}bindBufferRange(t,e,r){const{gl:s,CONTEXT_UID:n}=this;r=r||0;const a=t._glBuffers[n]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,a.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,s=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),r&&(e||s.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new Wf(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Yl.extension={type:lt.RendererSystem,name:"buffer"};_t.add(Yl);class Kl{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let s,n,a,o;if(e&&(s=e.renderTexture,n=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(s||(this.lastObjectRendered=t),!o){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),s&&(e.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Kl.extension={type:lt.RendererSystem,name:"objectRenderer"};_t.add(Kl);const wi=class An extends Vf{constructor(t){super(),this.type=el.WEBGL,t=Object.assign({},ft.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new he({projectionMatrix:new Bt},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:An.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(xt("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=An.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t?.forceCanvas?!1:md()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return xt("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return xt("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return xt("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return xt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){xt("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return xt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){xt("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return xt("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};wi.extension={type:lt.Renderer,priority:1},wi.__plugins={},wi.__systems={};let qn=wi;_t.handleByMap(lt.RendererPlugin,qn.__plugins);_t.handleByMap(lt.RendererSystem,qn.__systems);_t.add(qn);class Zl extends Vr{constructor(t,e){const{width:r,height:s}=e||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const a=new wt;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Vr?this.addResourceAt(t[r],r):this.addResourceAt(ml(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}}class Yf extends Zl{constructor(t,e){const{width:r,height:s}=e||{};let n,a;Array.isArray(t)?(n=t,a=t.length):a=t,super(a,{width:r,height:s}),n&&this.initFromArray(n,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=fr.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:s,itemDirtyIds:n,items:a}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,e.format,r.type,null);for(let h=0;h<s;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,e.format,r.type,l.resource.source))}return!0}}class Kf extends me{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Jl=class Lr extends Zl{constructor(t,e){const{width:r,height:s,autoLoad:n,linkBaseTexture:a}=e||{};if(t&&t.length!==Lr.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:s});for(let o=0;o<Lr.SIDES;o++)this.items[o].target=fr.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=a!==!1,t&&this.initFromArray(t,e),n!==!1&&this.load()}bind(t){super.bind(t),t.target=fr.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=fr.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const s=this.itemDirtyIds;for(let n=0;n<Lr.SIDES;n++){const a=this.items[n];(s[n]<a.dirtyId||r.dirtyId<e.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(t,a,r),s[n]=a.dirtyId):s[n]<-1&&(t.gl.texImage2D(a.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Lr.SIDES}};Jl.SIDES=6;let Zf=Jl;class cr extends me{constructor(t,e){e=e||{};let r,s,n;typeof t=="string"?(r=cr.EMPTY,s=t,n=!0):(r=t,s=null,n=!1),super(r),this.url=s,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??n,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await ft.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===He.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return cr._EMPTY=cr._EMPTY??ft.ADAPTER.createCanvas(0,0),cr._EMPTY}}const Sn=class Ti extends me{constructor(t,e){e=e||{},super(ft.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},Ti.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;me.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,n=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/r*e,n=this._overrideHeight||this._overrideWidth/e*r),s=Math.round(s),n=Math.round(n);const a=this.source;a.width=s,a.height=n,a._pixiId=`canvas_${$r()}`,a.getContext("2d").drawImage(t,0,0,e,r,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(t){const e=Ti.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&Ti.SVG_XML.test(t)}};Sn.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Sn.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Jf=Sn;class Qf extends me{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const Mn=class In extends me{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const s=t[0].src||t[0];me.crossOrigin(r,s,e.crossorigin);for(let n=0;n<t.length;++n){const a=document.createElement("source");let{src:o,mime:h}=t[n];if(o=o||t[n],o.startsWith("data:"))h=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const l=o.split("?").shift().toLowerCase(),u=l.slice(l.lastIndexOf(".")+1);h=h||In.MIME_TYPES[u]||`video/${u}`}a.src=o,h&&(a.type=h),r.appendChild(a)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=Se.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Se.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Se.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Se.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||In.TYPES.includes(e)}};Mn.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Mn.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let tp=Mn;yn.push(cr,Ml,Kf,tp,Qf,Jf,gl,Zf,Yf);class Rn{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Et.EMPTY:(t=t||new Et(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:s,c:n,d:a,tx:o,ty:h}=t,l=r*e.x+n*e.y+o,u=s*e.x+a*e.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,r=this.minY,s=this.maxX,n=this.maxY,a=t[0],o=t[1];e=a<e?a:e,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[2],o=t[3],e=a<e?a:e,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[4],o=t[5],e=a<e?a:e,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,a=t[6],o=t[7],e=a<e?a:e,r=o<r?o:r,s=a>s?a:s,n=o>n?o:n,this.minX=e,this.minY=r,this.maxX=s,this.maxY=n}addFrame(t,e,r,s,n){this.addFrameMatrix(t.worldTransform,e,r,s,n)}addFrameMatrix(t,e,r,s,n){const a=t.a,o=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let f=this.minX,p=this.minY,g=this.maxX,y=this.maxY,d=a*e+h*r+u,m=o*e+l*r+c;f=d<f?d:f,p=m<p?m:p,g=d>g?d:g,y=m>y?m:y,d=a*s+h*r+u,m=o*s+l*r+c,f=d<f?d:f,p=m<p?m:p,g=d>g?d:g,y=m>y?m:y,d=a*e+h*n+u,m=o*e+l*n+c,f=d<f?d:f,p=m<p?m:p,g=d>g?d:g,y=m>y?m:y,d=a*s+h*n+u,m=o*s+l*n+c,f=d<f?d:f,p=m<p?m:p,g=d>g?d:g,y=m>y?m:y,this.minX=f,this.minY=p,this.maxX=g,this.maxY=y}addVertexData(t,e,r){let s=this.minX,n=this.minY,a=this.maxX,o=this.maxY;for(let h=e;h<r;h+=2){const l=t[h],u=t[h+1];s=l<s?l:s,n=u<n?u:n,a=l>a?l:a,o=u>o?u:o}this.minX=s,this.minY=n,this.maxX=a,this.maxY=o}addVertices(t,e,r,s){this.addVerticesMatrix(t.worldTransform,e,r,s)}addVerticesMatrix(t,e,r,s,n=0,a=n){const o=t.a,h=t.b,l=t.c,u=t.d,c=t.tx,f=t.ty;let p=this.minX,g=this.minY,y=this.maxX,d=this.maxY;for(let m=r;m<s;m+=2){const _=e[m],x=e[m+1],E=o*_+l*x+c,v=u*x+h*_+f;p=Math.min(p,E-n),y=Math.max(y,E+n),g=Math.min(g,v-a),d=Math.max(d,v+a)}this.minX=p,this.minY=g,this.maxX=y,this.maxY=d}addBounds(t){const e=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,n=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<o?r:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,n=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,u=this.maxY;this.minX=r<o?r:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>u?a:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,s,n,a){t-=n,e-=a,r+=n,s+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class yr extends Bi{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new zn,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Rn,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const s=e[r];Object.defineProperty(yr.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Et),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Et),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Rn);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=r?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-n,a}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,s){return e&&(t=e.toGlobal(t,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,s=1,n=0,a=0,o=0,h=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=a,this.skew.y=o,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new ep),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Vd}set angle(t){this.transform.rotation=t*zd}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class ep extends yr{constructor(){super(...arguments),this.sortDirty=null}}yr.prototype.displayObjectUpdateTransform=yr.prototype.updateTransform;const rp=new Bt;function ip(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const Ql=class Cn extends yr{constructor(){super(),this.children=[],this.sortableChildren=Cn.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),s=this.getChildIndex(e);this.children[r]=e,this.children[s]=t,this.onChildrenChange(r<s?r:s)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);vi(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,vi(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,vi(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,s=e,n=s-r;let a;if(n>0&&n<=s){a=this.children.splice(r,n);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<a.length;++o)a[o].emit("removed",this),this.emit("childRemoved",a[o],this,o);return a}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const s=this.children[e];s._lastSortedIndex=e,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(ip),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let s=0,n=this.children.length;s<n;++s){const a=this.children[s];a.visible&&a.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,s;this.cullArea?(r=this.cullArea,s=this.worldTransform):this._render!==Cn.prototype._render&&(r=this.getBounds(!0));const n=t.projection.transform;if(n&&(s?(s=rp.copyFrom(s),s.prepend(n)):s=n),r&&e.intersects(r,s))this._render(t);else if(this.cullArea)return;for(let a=0,o=this.children.length;a<o;++a){const h=this.children[a],l=h.cullable;h.cullable=l||!this.cullArea,h.render(t),h.cullable=l}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<e.length;n++)e[n].enabled&&this._enabledFilters.push(e[n])}const s=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Ot.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let n=0,a=this.children.length;n<a;++n)this.children[n].render(t)}s&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let s=0;s<r.length;++s)r[s].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};Ql.defaultSortableChildren=!1;let Ve=Ql;Ve.prototype.containerUpdateTransform=Ve.prototype.updateTransform;Object.defineProperties(ft,{SORTABLE_CHILDREN:{get(){return Ve.defaultSortableChildren},set(i){xt("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ve.defaultSortableChildren=i}}});const tu=class Ln{constructor(t){this.stage=new Ve,t=Object.assign({forceCanvas:!1},t),this.renderer=qf(t),Ln._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,e){const r=Ln._plugins.slice(0);r.reverse(),r.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};tu._plugins=[];let eu=tu;_t.handleByList(lt.Application,eu._plugins);class ru{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;e=s,r=n}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ru.extension=lt.Application;_t.add(ru);const sp={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},np=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function ap(i){const t=sp[i],e=t.length;let r=np,s="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let o=0;o<i;o++){let h=n.replace("%index%",o.toString());a=o,o>=e&&(a=i-o-1),h=h.replace("%value%",t[a].toString()),s+=h,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}const op=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function hp(i,t){const e=Math.ceil(i/2);let r=op,s="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<i;a++){let o=n.replace("%index%",a.toString());o=o.replace("%sampleIndex%",`${a-(e-1)}.0`),s+=o,s+=`
`}return r=r.replace("%blur%",s),r=r.replace("%size%",i.toString()),r}class Vo extends jt{constructor(t,e=8,r=4,s=jt.defaultResolution,n=5){const a=hp(n,t),o=ap(n);super(a,o),this.horizontal=t,this.resolution=s,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,s){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,r,s);else{const n=t.getFilterTexture(),a=t.renderer;let o=e,h=n;this.state.blend=!1,t.applyFilter(this,o,h,ne.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(o,ne.BLIT),this.uniforms.uSampler=h;const u=h;h=o,o=u,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,r,s),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class xe extends jt{constructor(t=8,e=4,r=jt.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Vo(!0,t,e,r,s),this.blurYFilter=new Vo(!1,t,e,r,s),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,s){const n=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(n&&a){const o=t.getFilterTexture();this.blurXFilter.apply(t,e,o,ne.CLEAR),this.blurYFilter.apply(t,o,r,s),t.returnFilterTexture(o)}else a?this.blurYFilter.apply(t,e,r,s):this.blurXFilter.apply(t,e,r,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var lp=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,up=`uniform float radius;
uniform float strength;
uniform vec2 center;
uniform sampler2D uSampler;
varying vec2 vTextureCoord;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec2 dimensions;

void main()
{
    vec2 coord = vTextureCoord * filterArea.xy;
    coord -= center * dimensions.xy;
    float distance = length(coord);
    if (distance < radius) {
        float percent = distance / radius;
        if (strength > 0.0) {
            coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);
        } else {
            coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);
        }
    }
    coord += center * dimensions.xy;
    coord /= filterArea.xy;
    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);
    vec4 color = texture2D(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    gl_FragColor = color;
}
`;const iu=class extends jt{constructor(i){super(lp,up),this.uniforms.dimensions=new Float32Array(2),Object.assign(this,iu.defaults,i)}apply(i,t,e,r){const{width:s,height:n}=t.filterFrame;this.uniforms.dimensions[0]=s,this.uniforms.dimensions[1]=n,i.applyFilter(this,t,e,r)}get radius(){return this.uniforms.radius}set radius(i){this.uniforms.radius=i}get strength(){return this.uniforms.strength}set strength(i){this.uniforms.strength=i}get center(){return this.uniforms.center}set center(i){this.uniforms.center=i}};let Fr=iu;Fr.defaults={center:[.5,.5],radius:100,strength:1};var cp=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Br extends jt{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(jf,cp,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,s,n]=$e.shared.setValue(t).toArray(),a=[r,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),s=Math.sin(t),n=Math.sqrt,a=1/3,o=n(a),h=r+(1-r)*a,l=a*(1-r)-o*s,u=a*(1-r)+o*s,c=a*(1-r)+o*s,f=r+a*(1-r),p=a*(1-r)-o*s,g=a*(1-r)-o*s,y=a*(1-r)+o*s,d=r+a*(1-r),m=[h,l,u,0,0,c,f,p,0,0,g,y,d,0,0,0,0,0,1,0];this._loadMatrix(m,e)}contrast(t,e){const r=(t||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,e)}saturate(t=0,e){const r=t*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,s,n){t=t||.2,e=e||.15,r=r||16770432,s=s||3375104;const a=$e.shared,[o,h,l]=a.setValue(r).toArray(),[u,c,f]=a.setValue(s).toArray(),p=[.3,.59,.11,0,0,o,h,l,t,0,u,c,f,e,0,o-u,h-c,l-f,0,0];this._loadMatrix(p,n)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Br.prototype.grayscale=Br.prototype.greyscale;const Ar=new Ut,dp=new Uint16Array([0,1,2,0,2,3]);class dr extends Ve{constructor(t){super(),this._anchor=new Ae(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new $e(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=st.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||gt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=dp,this.pluginName="batch",this.isSprite=!0,this._roundPixels=ft.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Kr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Kr(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,s=e.b,n=e.c,a=e.d,o=e.tx,h=e.ty,l=this.vertexData,u=t.trim,c=t.orig,f=this._anchor;let p=0,g=0,y=0,d=0;if(u?(g=u.x-f._x*c.width,p=g+u.width,d=u.y-f._y*c.height,y=d+u.height):(g=-f._x*c.width,p=g+c.width,d=-f._y*c.height,y=d+c.height),l[0]=r*g+n*d+o,l[1]=a*d+s*g+h,l[2]=r*p+n*d+o,l[3]=a*d+s*p+h,l[4]=r*p+n*y+o,l[5]=a*y+s*p+h,l[6]=r*g+n*y+o,l[7]=a*y+s*g+h,this._roundPixels){const m=ft.RESOLUTION;for(let _=0;_<l.length;++_)l[_]=Math.round(l[_]*m)/m}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,s=this._anchor,n=this.transform.worldTransform,a=n.a,o=n.b,h=n.c,l=n.d,u=n.tx,c=n.ty,f=-s._x*r.width,p=f+r.width,g=-s._y*r.height,y=g+r.height;if(e[0]=a*f+h*g+u,e[1]=l*g+o*f+c,e[2]=a*p+h*g+u,e[3]=l*g+o*p+c,e[4]=a*p+h*y+u,e[5]=l*y+o*p+c,e[6]=a*f+h*y+u,e[7]=l*y+o*f+c,this._roundPixels){const d=ft.RESOLUTION;for(let m=0;m<e.length;++m)e[m]=Math.round(e[m]*d)/d}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Rn),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Et),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Ar);const e=this._texture.orig.width,r=this._texture.orig.height,s=-e*this.anchor.x;let n=0;return Ar.x>=s&&Ar.x<s+e&&(n=-r*this.anchor.y,Ar.y>=n&&Ar.y<n+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){const e=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof gt?t:gt.from(t,e);return new dr(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Kr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Kr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||gt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}var fp=Object.defineProperty,pp=(i,t,e)=>t in i?fp(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,R=(i,t,e)=>pp(i,typeof t!="symbol"?t+"":t,e);class mp{}class su extends mp{constructor(t){super(),R(this,"observer"),R(this,"flowSpeed",4),R(this,"currerntRenderScale",.75),this.canvas=t,this.observer=new ResizeObserver(()=>{const e=Math.max(1,t.clientWidth*window.devicePixelRatio*this.currerntRenderScale),r=Math.max(1,t.clientHeight*window.devicePixelRatio*this.currerntRenderScale);this.onResize(e,r)}),this.observer.observe(t)}setRenderScale(t){this.currerntRenderScale=t,this.onResize(this.canvas.clientWidth*window.devicePixelRatio*this.currerntRenderScale,this.canvas.clientHeight*window.devicePixelRatio*this.currerntRenderScale)}onResize(t,e){this.canvas.width=t,this.canvas.height=e}setFlowSpeed(t){this.flowSpeed=t}dispose(){this.observer.disconnect(),this.canvas.remove()}getElement(){return this.canvas}}const vt=1e-6,zo=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),nu=class Ft extends Float32Array{constructor(...t){switch(t.length){case 16:super(t);break;case 2:super(t[0],t[1],16);break;case 1:const e=t[0];typeof e=="number"?super([e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]):super(e,0,16);break;default:super(zo);break}}get str(){return Ft.str(this)}copy(t){return this.set(t),this}identity(){return this.set(zo),this}multiply(t){return Ft.multiply(this,this,t)}mul(t){return this}transpose(){return Ft.transpose(this,this)}invert(){return Ft.invert(this,this)}translate(t){return Ft.translate(this,this,t)}rotate(t,e){return Ft.rotate(this,this,t,e)}scale(t){return Ft.scale(this,this,t)}rotateX(t){return Ft.rotateX(this,this,t)}rotateY(t){return Ft.rotateY(this,this,t)}rotateZ(t){return Ft.rotateZ(this,this,t)}perspectiveNO(t,e,r,s){return Ft.perspectiveNO(this,t,e,r,s)}perspectiveZO(t,e,r,s){return Ft.perspectiveZO(this,t,e,r,s)}orthoNO(t,e,r,s,n,a){return Ft.orthoNO(this,t,e,r,s,n,a)}orthoZO(t,e,r,s,n,a){return Ft.orthoZO(this,t,e,r,s,n,a)}static create(){return new Ft}static clone(t){return new Ft(t)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static fromValues(...t){return new Ft(...t)}static set(t,...e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static transpose(t,e){if(t===e){const r=e[1],s=e[2],n=e[3],a=e[6],o=e[7],h=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=h}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}static invert(t,e){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],f=e[9],p=e[10],g=e[11],y=e[12],d=e[13],m=e[14],_=e[15],x=r*h-s*o,E=r*l-n*o,v=r*u-a*o,A=s*l-n*h,b=s*u-a*h,B=n*u-a*l,U=c*d-f*y,D=c*m-p*y,k=c*_-g*y,P=f*m-p*d,j=f*_-g*d,H=p*_-g*m;let z=x*H-E*j+v*P+A*k-b*D+B*U;return z?(z=1/z,t[0]=(h*H-l*j+u*P)*z,t[1]=(n*j-s*H-a*P)*z,t[2]=(d*B-m*b+_*A)*z,t[3]=(p*b-f*B-g*A)*z,t[4]=(l*k-o*H-u*D)*z,t[5]=(r*H-n*k+a*D)*z,t[6]=(m*v-y*B-_*E)*z,t[7]=(c*B-p*v+g*E)*z,t[8]=(o*j-h*k+u*U)*z,t[9]=(s*k-r*j-a*U)*z,t[10]=(y*b-d*v+_*x)*z,t[11]=(f*v-c*b-g*x)*z,t[12]=(h*D-o*P-l*U)*z,t[13]=(r*P-s*D+n*U)*z,t[14]=(d*E-y*A-m*x)*z,t[15]=(c*A-f*E+p*x)*z,t):null}static adjoint(t,e){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],f=e[9],p=e[10],g=e[11],y=e[12],d=e[13],m=e[14],_=e[15],x=r*h-s*o,E=r*l-n*o,v=r*u-a*o,A=s*l-n*h,b=s*u-a*h,B=n*u-a*l,U=c*d-f*y,D=c*m-p*y,k=c*_-g*y,P=f*m-p*d,j=f*_-g*d,H=p*_-g*m;return t[0]=h*H-l*j+u*P,t[1]=n*j-s*H-a*P,t[2]=d*B-m*b+_*A,t[3]=p*b-f*B-g*A,t[4]=l*k-o*H-u*D,t[5]=r*H-n*k+a*D,t[6]=m*v-y*B-_*E,t[7]=c*B-p*v+g*E,t[8]=o*j-h*k+u*U,t[9]=s*k-r*j-a*U,t[10]=y*b-d*v+_*x,t[11]=f*v-c*b-g*x,t[12]=h*D-o*P-l*U,t[13]=r*P-s*D+n*U,t[14]=d*E-y*A-m*x,t[15]=c*A-f*E+p*x,t}static determinant(t){const e=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],f=t[10],p=t[11],g=t[12],y=t[13],d=t[14],m=t[15],_=e*o-r*a,x=e*h-s*a,E=r*h-s*o,v=u*y-c*g,A=u*d-f*g,b=c*d-f*y,B=e*b-r*A+s*v,U=a*b-o*A+h*v,D=u*E-c*x+f*_,k=g*E-y*x+d*_;return l*B-n*U+m*D-p*k}static multiply(t,e,r){const s=e[0],n=e[1],a=e[2],o=e[3],h=e[4],l=e[5],u=e[6],c=e[7],f=e[8],p=e[9],g=e[10],y=e[11],d=e[12],m=e[13],_=e[14],x=e[15];let E=r[0],v=r[1],A=r[2],b=r[3];return t[0]=E*s+v*h+A*f+b*d,t[1]=E*n+v*l+A*p+b*m,t[2]=E*a+v*u+A*g+b*_,t[3]=E*o+v*c+A*y+b*x,E=r[4],v=r[5],A=r[6],b=r[7],t[4]=E*s+v*h+A*f+b*d,t[5]=E*n+v*l+A*p+b*m,t[6]=E*a+v*u+A*g+b*_,t[7]=E*o+v*c+A*y+b*x,E=r[8],v=r[9],A=r[10],b=r[11],t[8]=E*s+v*h+A*f+b*d,t[9]=E*n+v*l+A*p+b*m,t[10]=E*a+v*u+A*g+b*_,t[11]=E*o+v*c+A*y+b*x,E=r[12],v=r[13],A=r[14],b=r[15],t[12]=E*s+v*h+A*f+b*d,t[13]=E*n+v*l+A*p+b*m,t[14]=E*a+v*u+A*g+b*_,t[15]=E*o+v*c+A*y+b*x,t}static mul(t,e,r){return t}static translate(t,e,r){const s=r[0],n=r[1],a=r[2];if(e===t)t[12]=e[0]*s+e[4]*n+e[8]*a+e[12],t[13]=e[1]*s+e[5]*n+e[9]*a+e[13],t[14]=e[2]*s+e[6]*n+e[10]*a+e[14],t[15]=e[3]*s+e[7]*n+e[11]*a+e[15];else{const o=e[0],h=e[1],l=e[2],u=e[3],c=e[4],f=e[5],p=e[6],g=e[7],y=e[8],d=e[9],m=e[10],_=e[11];t[0]=o,t[1]=h,t[2]=l,t[3]=u,t[4]=c,t[5]=f,t[6]=p,t[7]=g,t[8]=y,t[9]=d,t[10]=m,t[11]=_,t[12]=o*s+c*n+y*a+e[12],t[13]=h*s+f*n+d*a+e[13],t[14]=l*s+p*n+m*a+e[14],t[15]=u*s+g*n+_*a+e[15]}return t}static scale(t,e,r){const s=r[0],n=r[1],a=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static rotate(t,e,r,s){let n=s[0],a=s[1],o=s[2],h=Math.sqrt(n*n+a*a+o*o);if(h<vt)return null;h=1/h,n*=h,a*=h,o*=h;const l=Math.sin(r),u=Math.cos(r),c=1-u,f=e[0],p=e[1],g=e[2],y=e[3],d=e[4],m=e[5],_=e[6],x=e[7],E=e[8],v=e[9],A=e[10],b=e[11],B=n*n*c+u,U=a*n*c+o*l,D=o*n*c-a*l,k=n*a*c-o*l,P=a*a*c+u,j=o*a*c+n*l,H=n*o*c+a*l,z=a*o*c-n*l,T=o*o*c+u;return t[0]=f*B+d*U+E*D,t[1]=p*B+m*U+v*D,t[2]=g*B+_*U+A*D,t[3]=y*B+x*U+b*D,t[4]=f*k+d*P+E*j,t[5]=p*k+m*P+v*j,t[6]=g*k+_*P+A*j,t[7]=y*k+x*P+b*j,t[8]=f*H+d*z+E*T,t[9]=p*H+m*z+v*T,t[10]=g*H+_*z+A*T,t[11]=y*H+x*z+b*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t}static rotateX(t,e,r){let s=Math.sin(r),n=Math.cos(r),a=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=e[9],f=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+u*s,t[5]=o*n+c*s,t[6]=h*n+f*s,t[7]=l*n+p*s,t[8]=u*n-a*s,t[9]=c*n-o*s,t[10]=f*n-h*s,t[11]=p*n-l*s,t}static rotateY(t,e,r){let s=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],h=e[2],l=e[3],u=e[8],c=e[9],f=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-u*s,t[1]=o*n-c*s,t[2]=h*n-f*s,t[3]=l*n-p*s,t[8]=a*s+u*n,t[9]=o*s+c*n,t[10]=h*s+f*n,t[11]=l*s+p*n,t}static rotateZ(t,e,r){let s=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],h=e[2],l=e[3],u=e[4],c=e[5],f=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+u*s,t[1]=o*n+c*s,t[2]=h*n+f*s,t[3]=l*n+p*s,t[4]=u*n-a*s,t[5]=c*n-o*s,t[6]=f*n-h*s,t[7]=p*n-l*s,t}static fromTranslation(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}static fromScaling(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromRotation(t,e,r){let s=r[0],n=r[1],a=r[2],o=Math.sqrt(s*s+n*n+a*a);if(o<vt)return null;o=1/o,s*=o,n*=o,a*=o;const h=Math.sin(e),l=Math.cos(e),u=1-l;return t[0]=s*s*u+l,t[1]=n*s*u+a*h,t[2]=a*s*u-n*h,t[3]=0,t[4]=s*n*u-a*h,t[5]=n*n*u+l,t[6]=a*n*u+s*h,t[7]=0,t[8]=s*a*u+n*h,t[9]=n*a*u-s*h,t[10]=a*a*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromXRotation(t,e){let r=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromYRotation(t,e){let r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromZRotation(t,e){const r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static fromRotationTranslation(t,e,r){const s=e[0],n=e[1],a=e[2],o=e[3],h=s+s,l=n+n,u=a+a,c=s*h,f=s*l,p=s*u,g=n*l,y=n*u,d=a*u,m=o*h,_=o*l,x=o*u;return t[0]=1-(g+d),t[1]=f+x,t[2]=p-_,t[3]=0,t[4]=f-x,t[5]=1-(c+d),t[6]=y+m,t[7]=0,t[8]=p+_,t[9]=y-m,t[10]=1-(c+g),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}static fromQuat2(t,e){const r=-e[0],s=-e[1],n=-e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7];let c=r*r+s*s+n*n+a*a;return c>0?(Kt[0]=(o*a+u*r+h*n-l*s)*2/c,Kt[1]=(h*a+u*s+l*r-o*n)*2/c,Kt[2]=(l*a+u*n+o*s-h*r)*2/c):(Kt[0]=(o*a+u*r+h*n-l*s)*2,Kt[1]=(h*a+u*s+l*r-o*n)*2,Kt[2]=(l*a+u*n+o*s-h*r)*2),Ft.fromRotationTranslation(t,e,Kt),t}static normalFromMat4(t,e){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],f=e[9],p=e[10],g=e[11],y=e[12],d=e[13],m=e[14],_=e[15],x=r*h-s*o,E=r*l-n*o,v=r*u-a*o,A=s*l-n*h,b=s*u-a*h,B=n*u-a*l,U=c*d-f*y,D=c*m-p*y,k=c*_-g*y,P=f*m-p*d,j=f*_-g*d,H=p*_-g*m;let z=x*H-E*j+v*P+A*k-b*D+B*U;return z?(z=1/z,t[0]=(h*H-l*j+u*P)*z,t[1]=(l*k-o*H-u*D)*z,t[2]=(o*j-h*k+u*U)*z,t[3]=0,t[4]=(n*j-s*H-a*P)*z,t[5]=(r*H-n*k+a*D)*z,t[6]=(s*k-r*j-a*U)*z,t[7]=0,t[8]=(d*B-m*b+_*A)*z,t[9]=(m*v-y*B-_*E)*z,t[10]=(y*b-d*v+_*x)*z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):null}static normalFromMat4Fast(t,e){const r=e[0],s=e[1],n=e[2],a=e[4],o=e[5],h=e[6],l=e[8],u=e[9],c=e[10];return t[0]=o*c-c*u,t[1]=h*l-l*c,t[2]=a*u-u*l,t[3]=0,t[4]=u*n-c*s,t[5]=c*r-l*n,t[6]=l*s-u*r,t[7]=0,t[8]=s*h-n*o,t[9]=n*a-r*h,t[10]=r*o-s*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static getTranslation(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}static getScaling(t,e){const r=e[0],s=e[1],n=e[2],a=e[4],o=e[5],h=e[6],l=e[8],u=e[9],c=e[10];return t[0]=Math.sqrt(r*r+s*s+n*n),t[1]=Math.sqrt(a*a+o*o+h*h),t[2]=Math.sqrt(l*l+u*u+c*c),t}static getRotation(t,e){Ft.getScaling(Kt,e);const r=1/Kt[0],s=1/Kt[1],n=1/Kt[2],a=e[0]*r,o=e[1]*s,h=e[2]*n,l=e[4]*r,u=e[5]*s,c=e[6]*n,f=e[8]*r,p=e[9]*s,g=e[10]*n,y=a+u+g;let d=0;return y>0?(d=Math.sqrt(y+1)*2,t[3]=.25*d,t[0]=(c-p)/d,t[1]=(f-h)/d,t[2]=(o-l)/d):a>u&&a>g?(d=Math.sqrt(1+a-u-g)*2,t[3]=(c-p)/d,t[0]=.25*d,t[1]=(o+l)/d,t[2]=(f+h)/d):u>g?(d=Math.sqrt(1+u-a-g)*2,t[3]=(f-h)/d,t[0]=(o+l)/d,t[1]=.25*d,t[2]=(c+p)/d):(d=Math.sqrt(1+g-a-u)*2,t[3]=(o-l)/d,t[0]=(f+h)/d,t[1]=(c+p)/d,t[2]=.25*d),t}static decompose(t,e,r,s){e[0]=s[12],e[1]=s[13],e[2]=s[14];const n=s[0],a=s[1],o=s[2],h=s[4],l=s[5],u=s[6],c=s[8],f=s[9],p=s[10];r[0]=Math.sqrt(n*n+a*a+o*o),r[1]=Math.sqrt(h*h+l*l+u*u),r[2]=Math.sqrt(c*c+f*f+p*p);const g=1/r[0],y=1/r[1],d=1/r[2],m=n*g,_=a*y,x=o*d,E=h*g,v=l*y,A=u*d,b=c*g,B=f*y,U=p*d,D=m+v+U;let k=0;return D>0?(k=Math.sqrt(D+1)*2,t[3]=.25*k,t[0]=(A-B)/k,t[1]=(b-x)/k,t[2]=(_-E)/k):m>v&&m>U?(k=Math.sqrt(1+m-v-U)*2,t[3]=(A-B)/k,t[0]=.25*k,t[1]=(_+E)/k,t[2]=(b+x)/k):v>U?(k=Math.sqrt(1+v-m-U)*2,t[3]=(b-x)/k,t[0]=(_+E)/k,t[1]=.25*k,t[2]=(A+B)/k):(k=Math.sqrt(1+U-m-v)*2,t[3]=(_-E)/k,t[0]=(b+x)/k,t[1]=(A+B)/k,t[2]=.25*k),t}static fromRotationTranslationScale(t,e,r,s){const n=e[0],a=e[1],o=e[2],h=e[3],l=n+n,u=a+a,c=o+o,f=n*l,p=n*u,g=n*c,y=a*u,d=a*c,m=o*c,_=h*l,x=h*u,E=h*c,v=s[0],A=s[1],b=s[2];return t[0]=(1-(y+m))*v,t[1]=(p+E)*v,t[2]=(g-x)*v,t[3]=0,t[4]=(p-E)*A,t[5]=(1-(f+m))*A,t[6]=(d+_)*A,t[7]=0,t[8]=(g+x)*b,t[9]=(d-_)*b,t[10]=(1-(f+y))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}static fromRotationTranslationScaleOrigin(t,e,r,s,n){const a=e[0],o=e[1],h=e[2],l=e[3],u=a+a,c=o+o,f=h+h,p=a*u,g=a*c,y=a*f,d=o*c,m=o*f,_=h*f,x=l*u,E=l*c,v=l*f,A=s[0],b=s[1],B=s[2],U=n[0],D=n[1],k=n[2],P=(1-(d+_))*A,j=(g+v)*A,H=(y-E)*A,z=(g-v)*b,T=(1-(p+_))*b,S=(m+x)*b,w=(y+E)*B,L=(m-x)*B,M=(1-(p+d))*B;return t[0]=P,t[1]=j,t[2]=H,t[3]=0,t[4]=z,t[5]=T,t[6]=S,t[7]=0,t[8]=w,t[9]=L,t[10]=M,t[11]=0,t[12]=r[0]+U-(P*U+z*D+w*k),t[13]=r[1]+D-(j*U+T*D+L*k),t[14]=r[2]+k-(H*U+S*D+M*k),t[15]=1,t}static fromQuat(t,e){const r=e[0],s=e[1],n=e[2],a=e[3],o=r+r,h=s+s,l=n+n,u=r*o,c=s*o,f=s*h,p=n*o,g=n*h,y=n*l,d=a*o,m=a*h,_=a*l;return t[0]=1-f-y,t[1]=c+_,t[2]=p-m,t[3]=0,t[4]=c-_,t[5]=1-u-y,t[6]=g+d,t[7]=0,t[8]=p+m,t[9]=g-d,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static frustumNO(t,e,r,s,n,a,o=1/0){const h=1/(r-e),l=1/(n-s);if(t[0]=a*2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*l,t[6]=0,t[7]=0,t[8]=(r+e)*h,t[9]=(n+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const u=1/(a-o);t[10]=(o+a)*u,t[14]=2*o*a*u}else t[10]=-1,t[14]=-2*a;return t}static frustum(t,e,r,s,n,a,o=1/0){return t}static frustumZO(t,e,r,s,n,a,o=1/0){const h=1/(r-e),l=1/(n-s);if(t[0]=a*2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*l,t[6]=0,t[7]=0,t[8]=(r+e)*h,t[9]=(n+s)*l,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const u=1/(a-o);t[10]=o*u,t[14]=o*a*u}else t[10]=-1,t[14]=-a;return t}static perspectiveNO(t,e,r,s,n=1/0){const a=1/Math.tan(e/2);if(t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const o=1/(s-n);t[10]=(n+s)*o,t[14]=2*n*s*o}else t[10]=-1,t[14]=-2*s;return t}static perspective(t,e,r,s,n=1/0){return t}static perspectiveZO(t,e,r,s,n=1/0){const a=1/Math.tan(e/2);if(t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){const o=1/(s-n);t[10]=n*o,t[14]=n*s*o}else t[10]=-1,t[14]=-s;return t}static perspectiveFromFieldOfView(t,e,r,s){const n=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+h),u=2/(n+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-h)*l*.5),t[9]=(n-a)*u*.5,t[10]=s/(r-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*r/(r-s),t[15]=0,t}static orthoNO(t,e,r,s,n,a,o){const h=1/(e-r),l=1/(s-n),u=1/(a-o);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*h,t[13]=(n+s)*l,t[14]=(o+a)*u,t[15]=1,t}static ortho(t,e,r,s,n,a,o){return t}static orthoZO(t,e,r,s,n,a,o){const h=1/(e-r),l=1/(s-n),u=1/(a-o);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+r)*h,t[13]=(n+s)*l,t[14]=a*u,t[15]=1,t}static lookAt(t,e,r,s){const n=e[0],a=e[1],o=e[2],h=s[0],l=s[1],u=s[2],c=r[0],f=r[1],p=r[2];if(Math.abs(n-c)<vt&&Math.abs(a-f)<vt&&Math.abs(o-p)<vt)return Ft.identity(t);let g=n-c,y=a-f,d=o-p,m=1/Math.sqrt(g*g+y*y+d*d);g*=m,y*=m,d*=m;let _=l*d-u*y,x=u*g-h*d,E=h*y-l*g;m=Math.sqrt(_*_+x*x+E*E),m?(m=1/m,_*=m,x*=m,E*=m):(_=0,x=0,E=0);let v=y*E-d*x,A=d*_-g*E,b=g*x-y*_;return m=Math.sqrt(v*v+A*A+b*b),m?(m=1/m,v*=m,A*=m,b*=m):(v=0,A=0,b=0),t[0]=_,t[1]=v,t[2]=g,t[3]=0,t[4]=x,t[5]=A,t[6]=y,t[7]=0,t[8]=E,t[9]=b,t[10]=d,t[11]=0,t[12]=-(_*n+x*a+E*o),t[13]=-(v*n+A*a+b*o),t[14]=-(g*n+y*a+d*o),t[15]=1,t}static targetTo(t,e,r,s){const n=e[0],a=e[1],o=e[2],h=s[0],l=s[1],u=s[2];let c=n-r[0],f=a-r[1],p=o-r[2],g=c*c+f*f+p*p;g>0&&(g=1/Math.sqrt(g),c*=g,f*=g,p*=g);let y=l*p-u*f,d=u*c-h*p,m=h*f-l*c;return g=y*y+d*d+m*m,g>0&&(g=1/Math.sqrt(g),y*=g,d*=g,m*=g),t[0]=y,t[1]=d,t[2]=m,t[3]=0,t[4]=f*m-p*d,t[5]=p*y-c*m,t[6]=c*d-f*y,t[7]=0,t[8]=c,t[9]=f,t[10]=p,t[11]=0,t[12]=n,t[13]=a,t[14]=o,t[15]=1,t}static frob(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8]+t[9]*t[9]+t[10]*t[10]+t[11]*t[11]+t[12]*t[12]+t[13]*t[13]+t[14]*t[14]+t[15]*t[15])}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}static sub(t,e,r){return t}static multiplyScalar(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}static multiplyScalarAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t[4]=e[4]+r[4]*s,t[5]=e[5]+r[5]*s,t[6]=e[6]+r[6]*s,t[7]=e[7]+r[7]*s,t[8]=e[8]+r[8]*s,t[9]=e[9]+r[9]*s,t[10]=e[10]+r[10]*s,t[11]=e[11]+r[11]*s,t[12]=e[12]+r[12]*s,t[13]=e[13]+r[13]*s,t[14]=e[14]+r[14]*s,t[15]=e[15]+r[15]*s,t}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}static equals(t,e){const r=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],u=t[7],c=t[8],f=t[9],p=t[10],g=t[11],y=t[12],d=t[13],m=t[14],_=t[15],x=e[0],E=e[1],v=e[2],A=e[3],b=e[4],B=e[5],U=e[6],D=e[7],k=e[8],P=e[9],j=e[10],H=e[11],z=e[12],T=e[13],S=e[14],w=e[15];return Math.abs(r-x)<=vt*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-E)<=vt*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-v)<=vt*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-A)<=vt*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(o-b)<=vt*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(h-B)<=vt*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(l-U)<=vt*Math.max(1,Math.abs(l),Math.abs(U))&&Math.abs(u-D)<=vt*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(c-k)<=vt*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(f-P)<=vt*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(p-j)<=vt*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(g-H)<=vt*Math.max(1,Math.abs(g),Math.abs(H))&&Math.abs(y-z)<=vt*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(d-T)<=vt*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(m-S)<=vt*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(_-w)<=vt*Math.max(1,Math.abs(_),Math.abs(w))}static str(t){return`Mat4(${t.join(", ")})`}};R(nu,"BYTE_LENGTH",16*Float32Array.BYTES_PER_ELEMENT);let ct=nu;const Kt=new Float32Array(3);ct.prototype.mul=ct.prototype.multiply;ct.sub=ct.subtract;ct.mul=ct.multiply;ct.frustum=ct.frustumNO;ct.perspective=ct.perspectiveNO;ct.ortho=ct.orthoNO;const au=class se extends Float32Array{constructor(...t){switch(t.length){case 3:super(t);break;case 2:super(t[0],t[1],3);break;case 1:{const e=t[0];typeof e=="number"?super([e,e,e]):super(e,0,3);break}default:super(3);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get magnitude(){const t=this[0],e=this[1],r=this[2];return Math.sqrt(t*t+e*e+r*r)}get mag(){return this.magnitude}get squaredMagnitude(){const t=this[0],e=this[1],r=this[2];return t*t+e*e+r*r}get sqrMag(){return this.squaredMagnitude}get str(){return se.str(this)}copy(t){return this.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this[2]+=t[2]*e,this}distance(t){return se.distance(this,t)}dist(t){return 0}squaredDistance(t){return se.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}normalize(){return se.normalize(this,this)}static create(){return new se}static clone(t){return new se(t)}static magnitude(t){let e=t[0],r=t[1],s=t[2];return Math.sqrt(e*e+r*r+s*s)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static fromValues(t,e,r){return new se(t,e,r)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}static set(t,e,r,s){return t[0]=e,t[1]=r,t[2]=s,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}static sub(t,e,r){return[0,0,0]}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}static mul(t,e,r){return[0,0,0]}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}static div(t,e,r){return[0,0,0]}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}static scaleAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t}static distance(t,e){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+s*s+n*n)}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2];return r*r+s*s+n*n}static sqrDist(t,e){return 0}static squaredLength(t){const e=t[0],r=t[1],s=t[2];return e*e+r*r+s*s}static sqrLen(t,e){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}static normalize(t,e){const r=e[0],s=e[1],n=e[2];let a=r*r+s*s+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}static cross(t,e,r){const s=e[0],n=e[1],a=e[2],o=r[0],h=r[1],l=r[2];return t[0]=n*l-a*h,t[1]=a*o-s*l,t[2]=s*h-n*o,t}static lerp(t,e,r,s){const n=e[0],a=e[1],o=e[2];return t[0]=n+s*(r[0]-n),t[1]=a+s*(r[1]-a),t[2]=o+s*(r[2]-o),t}static slerp(t,e,r,s){const n=Math.acos(Math.min(Math.max(se.dot(e,r),-1),1)),a=Math.sin(n),o=Math.sin((1-s)*n)/a,h=Math.sin(s*n)/a;return t[0]=o*e[0]+h*r[0],t[1]=o*e[1]+h*r[1],t[2]=o*e[2]+h*r[2],t}static hermite(t,e,r,s,n,a){const o=a*a,h=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return t[0]=e[0]*h+r[0]*l+s[0]*u+n[0]*c,t[1]=e[1]*h+r[1]*l+s[1]*u+n[1]*c,t[2]=e[2]*h+r[2]*l+s[2]*u+n[2]*c,t}static bezier(t,e,r,s,n,a){const o=1-a,h=o*o,l=a*a,u=h*o,c=3*a*h,f=3*l*o,p=l*a;return t[0]=e[0]*u+r[0]*c+s[0]*f+n[0]*p,t[1]=e[1]*u+r[1]*c+s[1]*f+n[1]*p,t[2]=e[2]*u+r[2]*c+s[2]*f+n[2]*p,t}static transformMat4(t,e,r){const s=e[0],n=e[1],a=e[2],o=r[3]*s+r[7]*n+r[11]*a+r[15]||1;return t[0]=(r[0]*s+r[4]*n+r[8]*a+r[12])/o,t[1]=(r[1]*s+r[5]*n+r[9]*a+r[13])/o,t[2]=(r[2]*s+r[6]*n+r[10]*a+r[14])/o,t}static transformMat3(t,e,r){let s=e[0],n=e[1],a=e[2];return t[0]=s*r[0]+n*r[3]+a*r[6],t[1]=s*r[1]+n*r[4]+a*r[7],t[2]=s*r[2]+n*r[5]+a*r[8],t}static transformQuat(t,e,r){const s=r[0],n=r[1],a=r[2],o=r[3]*2,h=e[0],l=e[1],u=e[2],c=n*u-a*l,f=a*h-s*u,p=s*l-n*h,g=(n*p-a*f)*2,y=(a*c-s*p)*2,d=(s*f-n*c)*2;return t[0]=h+c*o+g,t[1]=l+f*o+y,t[2]=u+p*o+d,t}static rotateX(t,e,r,s){const n=r[1],a=r[2],o=e[1]-n,h=e[2]-a;return t[0]=e[0],t[1]=o*Math.cos(s)-h*Math.sin(s)+n,t[2]=o*Math.sin(s)+h*Math.cos(s)+a,t}static rotateY(t,e,r,s){const n=r[0],a=r[2],o=e[0]-n,h=e[2]-a;return t[0]=h*Math.sin(s)+o*Math.cos(s)+n,t[1]=e[1],t[2]=h*Math.cos(s)-o*Math.sin(s)+a,t}static rotateZ(t,e,r,s){const n=r[0],a=r[1],o=e[0]-n,h=e[1]-a;return t[0]=o*Math.cos(s)-h*Math.sin(s)+n,t[1]=o*Math.sin(s)+h*Math.cos(s)+a,t[2]=r[2],t}static angle(t,e){const r=t[0],s=t[1],n=t[2],a=e[0],o=e[1],h=e[2],l=Math.sqrt((r*r+s*s+n*n)*(a*a+o*o+h*h)),u=l&&se.dot(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))}static zero(t){return t[0]=0,t[1]=0,t[2]=0,t}static str(t){return`Vec3(${t.join(", ")})`}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}static equals(t,e){const r=t[0],s=t[1],n=t[2],a=e[0],o=e[1],h=e[2];return Math.abs(r-a)<=vt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-o)<=vt*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(n-h)<=vt*Math.max(1,Math.abs(n),Math.abs(h))}};R(au,"BYTE_LENGTH",3*Float32Array.BYTES_PER_ELEMENT);let bt=au;bt.prototype.sub=bt.prototype.subtract;bt.prototype.mul=bt.prototype.multiply;bt.prototype.div=bt.prototype.divide;bt.prototype.dist=bt.prototype.distance;bt.prototype.sqrDist=bt.prototype.squaredDistance;bt.sub=bt.subtract;bt.mul=bt.multiply;bt.div=bt.divide;bt.dist=bt.distance;bt.sqrDist=bt.squaredDistance;bt.sqrLen=bt.squaredLength;bt.mag=bt.magnitude;bt.length=bt.magnitude;bt.len=bt.magnitude;const ou=class Te extends Float32Array{constructor(...t){switch(t.length){case 4:super(t);break;case 2:super(t[0],t[1],4);break;case 1:{const e=t[0];typeof e=="number"?super([e,e,e,e]):super(e,0,4);break}default:super(4);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}get a(){return this[3]}set a(t){this[3]=t}get magnitude(){const t=this[0],e=this[1],r=this[2],s=this[3];return Math.sqrt(t*t+e*e+r*r+s*s)}get mag(){return this.magnitude}get str(){return Te.str(this)}copy(t){return super.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],this[3]+=t[3],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this[2]*=t[2],this[3]*=t[3],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this[2]/=t[2],this[3]/=t[3],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this[2]+=t[2]*e,this[3]+=t[3]*e,this}distance(t){return Te.distance(this,t)}dist(t){return 0}squaredDistance(t){return Te.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this[2]*=-1,this[3]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this[2]=1/this[2],this[3]=1/this[3],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this[2]=Math.abs(this[2]),this[3]=Math.abs(this[3]),this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}normalize(){return Te.normalize(this,this)}static create(){return new Te}static clone(t){return new Te(t)}static fromValues(t,e,r,s){return new Te(t,e,r,s)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}static set(t,e,r,s,n){return t[0]=e,t[1]=r,t[2]=s,t[3]=n,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}static sub(t,e,r){return t}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}static mul(t,e,r){return t}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}static div(t,e,r){return t}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}static round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}static scaleAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t}static distance(t,e){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,s,n,a)}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],s=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return r*r+s*s+n*n+a*a}static sqrDist(t,e){return 0}static magnitude(t){const e=t[0],r=t[1],s=t[2],n=t[3];return Math.sqrt(e*e+r*r+s*s+n*n)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static squaredLength(t){const e=t[0],r=t[1],s=t[2],n=t[3];return e*e+r*r+s*s+n*n}static sqrLen(t){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t[3]=Math.abs(e[3]),t}static normalize(t,e){const r=e[0],s=e[1],n=e[2],a=e[3];let o=r*r+s*s+n*n+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=s*o,t[2]=n*o,t[3]=a*o,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}static cross(t,e,r,s){const n=r[0]*s[1]-r[1]*s[0],a=r[0]*s[2]-r[2]*s[0],o=r[0]*s[3]-r[3]*s[0],h=r[1]*s[2]-r[2]*s[1],l=r[1]*s[3]-r[3]*s[1],u=r[2]*s[3]-r[3]*s[2],c=e[0],f=e[1],p=e[2],g=e[3];return t[0]=f*u-p*l+g*h,t[1]=-(c*u)+p*o-g*a,t[2]=c*l-f*o+g*n,t[3]=-(c*h)+f*a-p*n,t}static lerp(t,e,r,s){const n=e[0],a=e[1],o=e[2],h=e[3];return t[0]=n+s*(r[0]-n),t[1]=a+s*(r[1]-a),t[2]=o+s*(r[2]-o),t[3]=h+s*(r[3]-h),t}static transformMat4(t,e,r){const s=e[0],n=e[1],a=e[2],o=e[3];return t[0]=r[0]*s+r[4]*n+r[8]*a+r[12]*o,t[1]=r[1]*s+r[5]*n+r[9]*a+r[13]*o,t[2]=r[2]*s+r[6]*n+r[10]*a+r[14]*o,t[3]=r[3]*s+r[7]*n+r[11]*a+r[15]*o,t}static transformQuat(t,e,r){const s=e[0],n=e[1],a=e[2],o=r[0],h=r[1],l=r[2],u=r[3],c=u*s+h*a-l*n,f=u*n+l*s-o*a,p=u*a+o*n-h*s,g=-o*s-h*n-l*a;return t[0]=c*u+g*-o+f*-l-p*-h,t[1]=f*u+g*-h+p*-o-c*-l,t[2]=p*u+g*-l+c*-h-f*-o,t[3]=e[3],t}static zero(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}static str(t){return`Vec4(${t.join(", ")})`}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}static equals(t,e){const r=t[0],s=t[1],n=t[2],a=t[3],o=e[0],h=e[1],l=e[2],u=e[3];return Math.abs(r-o)<=vt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-h)<=vt*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-l)<=vt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-u)<=vt*Math.max(1,Math.abs(a),Math.abs(u))}};R(ou,"BYTE_LENGTH",4*Float32Array.BYTES_PER_ELEMENT);let at=ou;at.prototype.sub=at.prototype.subtract;at.prototype.mul=at.prototype.multiply;at.prototype.div=at.prototype.divide;at.prototype.dist=at.prototype.distance;at.prototype.sqrDist=at.prototype.squaredDistance;at.sub=at.subtract;at.mul=at.multiply;at.div=at.divide;at.dist=at.distance;at.sqrDist=at.squaredDistance;at.sqrLen=at.squaredLength;at.mag=at.magnitude;at.length=at.magnitude;at.len=at.magnitude;const hu=class Ee extends Float32Array{constructor(...t){switch(t.length){case 2:{const e=t[0];typeof e=="number"?super([e,t[1]]):super(e,t[1],2);break}case 1:{const e=t[0];typeof e=="number"?super([e,e]):super(e,0,2);break}default:super(2);break}}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get magnitude(){return Math.hypot(this[0],this[1])}get mag(){return this.magnitude}get squaredMagnitude(){const t=this[0],e=this[1];return t*t+e*e}get sqrMag(){return this.squaredMagnitude}get str(){return Ee.str(this)}copy(t){return this.set(t),this}add(t){return this[0]+=t[0],this[1]+=t[1],this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this}sub(t){return this}multiply(t){return this[0]*=t[0],this[1]*=t[1],this}mul(t){return this}divide(t){return this[0]/=t[0],this[1]/=t[1],this}div(t){return this}scale(t){return this[0]*=t,this[1]*=t,this}scaleAndAdd(t,e){return this[0]+=t[0]*e,this[1]+=t[1]*e,this}distance(t){return Ee.distance(this,t)}dist(t){return 0}squaredDistance(t){return Ee.squaredDistance(this,t)}sqrDist(t){return 0}negate(){return this[0]*=-1,this[1]*=-1,this}invert(){return this[0]=1/this[0],this[1]=1/this[1],this}abs(){return this[0]=Math.abs(this[0]),this[1]=Math.abs(this[1]),this}dot(t){return this[0]*t[0]+this[1]*t[1]}normalize(){return Ee.normalize(this,this)}static create(){return new Ee}static clone(t){return new Ee(t)}static fromValues(t,e){return new Ee(t,e)}static copy(t,e){return t[0]=e[0],t[1]=e[1],t}static set(t,e,r){return t[0]=e,t[1]=r,t}static add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}static subtract(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}static sub(t,e,r){return[0,0]}static multiply(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}static mul(t,e,r){return[0,0]}static divide(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}static div(t,e,r){return[0,0]}static ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}static floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}static min(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}static max(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}static round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}static scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}static scaleAndAdd(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t}static distance(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}static dist(t,e){return 0}static squaredDistance(t,e){const r=e[0]-t[0],s=e[1]-t[1];return r*r+s*s}static sqrDist(t,e){return 0}static magnitude(t){let e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}static mag(t){return 0}static length(t){return 0}static len(t){return 0}static squaredLength(t){const e=t[0],r=t[1];return e*e+r*r}static sqrLen(t,e){return 0}static negate(t,e){return t[0]=-e[0],t[1]=-e[1],t}static inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}static abs(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t}static normalize(t,e){const r=e[0],s=e[1];let n=r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}static dot(t,e){return t[0]*e[0]+t[1]*e[1]}static cross(t,e,r){const s=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=s,t}static lerp(t,e,r,s){const n=e[0],a=e[1];return t[0]=n+s*(r[0]-n),t[1]=a+s*(r[1]-a),t}static transformMat2(t,e,r){const s=e[0],n=e[1];return t[0]=r[0]*s+r[2]*n,t[1]=r[1]*s+r[3]*n,t}static transformMat2d(t,e,r){const s=e[0],n=e[1];return t[0]=r[0]*s+r[2]*n+r[4],t[1]=r[1]*s+r[3]*n+r[5],t}static transformMat3(t,e,r){const s=e[0],n=e[1];return t[0]=r[0]*s+r[3]*n+r[6],t[1]=r[1]*s+r[4]*n+r[7],t}static transformMat4(t,e,r){const s=e[0],n=e[1];return t[0]=r[0]*s+r[4]*n+r[12],t[1]=r[1]*s+r[5]*n+r[13],t}static rotate(t,e,r,s){const n=e[0]-r[0],a=e[1]-r[1],o=Math.sin(s),h=Math.cos(s);return t[0]=n*h-a*o+r[0],t[1]=n*o+a*h+r[1],t}static angle(t,e){const r=t[0],s=t[1],n=e[0],a=e[1],o=Math.sqrt(r*r+s*s)*Math.sqrt(n*n+a*a),h=o&&(r*n+s*a)/o;return Math.acos(Math.min(Math.max(h,-1),1))}static zero(t){return t[0]=0,t[1]=0,t}static exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]}static equals(t,e){const r=t[0],s=t[1],n=e[0],a=e[1];return Math.abs(r-n)<=vt*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(s-a)<=vt*Math.max(1,Math.abs(s),Math.abs(a))}static str(t){return`Vec2(${t.join(", ")})`}};R(hu,"BYTE_LENGTH",2*Float32Array.BYTES_PER_ELEMENT);let pt=hu;pt.prototype.sub=pt.prototype.subtract;pt.prototype.mul=pt.prototype.multiply;pt.prototype.div=pt.prototype.divide;pt.prototype.dist=pt.prototype.distance;pt.prototype.sqrDist=pt.prototype.squaredDistance;pt.sub=pt.subtract;pt.mul=pt.multiply;pt.div=pt.divide;pt.dist=pt.distance;pt.sqrDist=pt.squaredDistance;pt.sqrLen=pt.squaredLength;pt.mag=pt.magnitude;pt.length=pt.magnitude;pt.len=pt.magnitude;function gp(i){return new Promise((t,e)=>{const r=document.createElement("img");r.onload=()=>t(r),r.onerror=e,r.src=i,r.crossOrigin="anonymous",r.loading="eager"})}function yp(i){return new Promise((t,e)=>{const r=document.createElement("video");let s=!1,n=!1,a=!1;r.addEventListener("playing",()=>{s=!0,o()},!0),r.addEventListener("timeupdate",()=>{n=!0,o()},!0),r.addEventListener("error",h=>{a=!0,e(h)},!0);function o(){s&&n&&!a&&t(r)}r.src=i,r.playsInline=!0,r.crossOrigin="anonymous",r.autoplay=!0,r.loop=!0,r.muted=!0,r.play()})}function lu(i,t=!1){return t?yp(i):gp(i)}function uu(i){return new Promise((t,e)=>{(i instanceof HTMLImageElement?i.complete:i.readyState>=3)?t(i):(i.onload=()=>t(i),i.onerror=e)})}function _p(i,t,e){const r=i.data,s=i.width,n=i.height;let a,o,h,l,u,c,f,p,g,y,d,m,_;const x=s-1,E=n-1,v=t+1,A=t+v,b=t+1,B=t+b,U=1/(A*B),D=[],k=[],P=[],j=[],H=[],z=[];for(;e-- >0;){for(_=m=0,c=0;c<n;c++){for(a=r[_]*v,o=r[_+1]*v,h=r[_+2]*v,l=r[_+3]*v,f=1;f<=t;f++)p=_+((f>x?x:f)<<2),a+=r[p++],o+=r[p++],h+=r[p++],l+=r[p];for(u=0;u<s;u++)D[m]=a,k[m]=o,P[m]=h,j[m]=l,c===0&&(H[u]=Math.min(u+v,x)<<2,z[u]=Math.max(u-t,0)<<2),g=_+H[u],y=_+z[u],a+=r[g++]-r[y++],o+=r[g++]-r[y++],h+=r[g++]-r[y++],l+=r[g]-r[y],m++;_+=s<<2}for(u=0;u<s;u++){for(d=u,a=D[d]*b,o=k[d]*b,h=P[d]*b,l=j[d]*b,f=1;f<=t;f++)d+=f>E?0:s,a+=D[d],o+=k[d],h+=P[d],l+=j[d];for(m=u<<2,c=0;c<n;c++)r[m]=a*U+.5|0,r[m+1]=o*U+.5|0,r[m+2]=h*U+.5|0,r[m+3]=l*U+.5|0,u===0&&(H[c]=Math.min(c+b,E)*s,z[c]=Math.max(c-t,0)*s),g=u+H[c],y=u+z[c],a+=D[g]-D[y],o+=k[g]-k[y],h+=P[g]-P[y],l+=j[g]-j[y],m+=s<<2}}}function vp(i,t){const e=i.data;for(let r=0;r<e.length;r+=4){const s=e[r],n=e[r+1],a=e[r+2],o=e[r+3],h=s*.3+n*.59+a*.11;e[r]=h*(1-t)+s*t,e[r+1]=h*(1-t)+n*t,e[r+2]=h*(1-t)+a*t,e[r+3]=o}}function bp(i,t){const e=i.data;for(let r=0;r<e.length;r+=4){const s=e[r],n=e[r+1],a=e[r+2],o=e[r+3];e[r]=s*t,e[r+1]=n*t,e[r+2]=a*t,e[r+3]=o}}function Ho(i,t){const e=i.data;for(let r=0;r<e.length;r+=4){const s=e[r],n=e[r+1],a=e[r+2],o=e[r+3];e[r]=(s-128)*t+128,e[r+1]=(n-128)*t+128,e[r+2]=(a-128)*t+128,e[r+3]=o}}const V=(i,t,e,r,s=0,n=0,a=1,o=1)=>Object.freeze({cx:i,cy:t,x:e,y:r,ur:s,vr:n,up:a,vp:o}),Pr=(i,t,e)=>Object.freeze({width:i,height:t,conf:e}),qo=[Pr(5,5,[V(0,0,-1,-1,0,0,1,1),V(1,0,-.5,-1,0,0,1,1),V(2,0,0,-1,0,0,1,1),V(3,0,.5,-1,0,0,1,1),V(4,0,1,-1,0,0,1,1),V(0,1,-1,-.5,0,0,1,1),V(1,1,-.5,-.5,0,0,1,1),V(2,1,-.0052029684413368305,-.6131420587090777,0,0,1,1),V(3,1,.5884227308309977,-.3990805107556692,0,0,1,1),V(4,1,1,-.5,0,0,1,1),V(0,2,-1,0,0,0,1,1),V(1,2,-.4210024670505933,-.11895058380429502,0,0,1,1),V(2,2,-.1019613423315412,-.023812118047224606,0,-47,.629,.849),V(3,2,.40275125660925437,-.06345314544600389,0,0,1,1),V(4,2,1,0,0,0,1,1),V(0,3,-1,.5,0,0,1,1),V(1,3,.06801958477287173,.5205913248960121,-31,-45,1,1),V(2,3,.21446469120128908,.29331610114301043,6,-56,.566,1.321),V(3,3,.5,.5,0,0,1,1),V(4,3,1,.5,0,0,1,1),V(0,4,-1,1,0,0,1,1),V(1,4,-.31378372841550195,1,0,0,1,1),V(2,4,.26153633255328046,1,0,0,1,1),V(3,4,.5,1,0,0,1,1),V(4,4,1,1,0,0,1,1)]),Pr(4,4,[V(0,0,-1,-1,0,0,1,1),V(1,0,-.33333333333333337,-1,0,0,1,1),V(2,0,.33333333333333326,-1,0,0,1,1),V(3,0,1,-1,0,0,1,1),V(0,1,-1,-.04495399932657351,0,0,1,1),V(1,1,-.24056117520129328,-.22465999020104,0,0,1,1),V(2,1,.334758885767489,-.00531297192779423,0,0,1,1),V(3,1,.9989920470678106,-.3382976020775408,8,0,.566,1.792),V(0,2,-1,.33333333333333326,0,0,1,1),V(1,2,-.3425497314639411,-27501607956947893e-21,0,0,1,1),V(2,2,.3321437945812673,.1981776353859399,0,0,1,1),V(3,2,1,.0766118180296832,0,0,1,1),V(0,3,-1,1,0,0,1,1),V(1,3,-.33333333333333337,1,0,0,1,1),V(2,3,.33333333333333326,1,0,0,1,1),V(3,3,1,1,0,0,1,1)]),Pr(4,4,[V(0,0,-1,-1,0,0,1,2.075),V(1,0,-.33333333333333337,-1,0,0,1,1),V(2,0,.33333333333333326,-1,0,0,1,1),V(3,0,1,-1,0,0,1,1),V(0,1,-1,-.4545779491139603,0,0,1,1),V(1,1,-.33333333333333337,-.33333333333333337,0,0,1,1),V(2,1,.0889403142626457,-.6025711180694033,-32,45,1,1),V(3,1,1,-.33333333333333337,0,0,1,1),V(0,2,-1,-.07402408608567845,1,0,1,.094),V(1,2,-.2719422694359541,.09775369930903222,25,-18,1.321,0),V(2,2,.19877414408395877,.4307383294587789,48,-40,.755,.975),V(3,2,1,.33333333333333326,-37,0,1,1),V(0,3,-1,1,0,0,1,1),V(1,3,-.33333333333333337,1,0,0,1,1),V(2,3,.5125850864305672,1,-20,-18,0,1.604),V(3,3,1,1,0,0,1,1)]),Pr(5,5,[V(0,0,-1,-1,0,0,1,1),V(1,0,-.4501953125,-1,0,55,1,2.075),V(2,0,.1953125,-1,0,0,1,1),V(3,0,.4580078125,-1,0,-25,1,1),V(4,0,1,-1,0,0,1,1),V(0,1,-1,-.2514475377525607,-16,0,2.327,.943),V(1,1,-.55859375,-.6609325945787148,47,0,2.358,.377),V(2,1,.232421875,-.5244375756366635,-66,-25,1.855,1.164),V(3,1,.685546875,-.3753706470552125,0,0,1,1),V(4,1,1,-.6699125300354287,0,0,1,1),V(0,2,-1,.035910396862284255,0,0,1,1),V(1,2,-.4921875,.005378616309457018,90,23,1,1.981),V(2,2,.021484375,-.1365043639066228,0,42,1,1),V(3,2,.4765625,.05925822904974043,-30,0,1.95,.44),V(4,2,1,.251428847823418,0,0,1,1),V(0,3,-1,.6968336464764276,-68,0,1,.786),V(1,3,-.6904296875,.5890744209958608,-68,0,1,1),V(2,3,.1845703125,.3879238667654693,61,0,1,1),V(3,3,.60546875,.4633553246018661,-47,-59,.849,1.73),V(4,3,1,.6214021886400309,-33,0,.377,1.604),V(0,4,-1,1,0,0,1,1),V(1,4,-.5,1,0,-73,1,1),V(2,4,-.3271484375,1,0,-24,.314,2.704),V(3,4,.5,1,0,0,1,1),V(4,4,1,1,0,0,1,1)])],Zt=(i,t)=>Math.random()*(t-i)+i;function xp(i,t,e){return Math.min(Math.max(i,t),e)}function wp(i,t,e){const r=xp((e-i)/(t-i),0,1);return r*r*(3-2*r)}function Tp(i,t,e,r=2,s=.5,n=.1){let a=[],o=s;for(let u=0;u<e;u++){a[u]=[];for(let c=0;c<t;c++)a[u][c]=i[u*t+c]}const h=[[1,2,1],[2,4,2],[1,2,1]],l=16;for(let u=0;u<r;u++){const c=[];for(let f=0;f<e;f++){c[f]=[];for(let p=0;p<t;p++){if(p===0||p===t-1||f===0||f===e-1){c[f][p]=a[f][p];continue}let g=0,y=0,d=0,m=0,_=0,x=0;for(let S=-1;S<=1;S++)for(let w=-1;w<=1;w++){const L=h[S+1][w+1],M=a[f+S][p+w];g+=M.x*L,y+=M.y*L,d+=M.ur*L,m+=M.vr*L,_+=M.up*L,x+=M.vp*L}const E=g/l,v=y/l,A=d/l,b=m/l,B=_/l,U=x/l,D=a[f][p],k=D.x*(1-o)+E*o,P=D.y*(1-o)+v*o,j=D.ur*(1-o)+A*o,H=D.vr*(1-o)+b*o,z=D.up*(1-o)+B*o,T=D.vp*(1-o)+U*o;c[f][p]=V(p,f,k,P,j,H,z,T)}}a=c,o=Math.min(1,Math.max(o+n,0))}for(let u=0;u<e;u++)for(let c=0;c<t;c++)i[u*t+c]=a[u][c]}function ai(i,t){return Ep(Math.sin(i*12.9898+t*78.233)*43758.5453)}function Ep(i){return i-Math.floor(i)}function Ap(i,t){const e=Math.floor(i),r=Math.floor(t),s=e+1,n=r+1,a=i-e,o=t-r,h=a*a*(3-2*a),l=o*o*(3-2*o),u=ai(e,r),c=ai(s,r),f=ai(e,n),p=ai(s,n),g=u*(1-h)+c*h,y=f*(1-h)+p*h;return g*(1-l)+y*l}function Sp(i,t,e,r=.001){const s=i(t+r,e),n=i(t-r,e),a=i(t,e+r),o=i(t,e-r),h=(s-n)/(2*r),l=(a-o)/(2*r),u=Math.sqrt(h*h+l*l)||1;return[h/u,l/u]}function Mp(i,t,e=Zt(.4,.6),r=Zt(.3,.6),s=.8,n=Math.floor(Zt(3,5)),a=Zt(.2,.3),o=Zt(-.1,-.05)){const h=i,l=t,u=[],c=2/(h-1),f=2/(l-1);for(let p=0;p<l;p++)for(let g=0;g<h;g++){const y=g/(h-1)*2-1,d=p/(l-1)*2-1,m=g===0||g===h-1||p===0||p===l-1,_=m?0:Zt(-e*c,e*c),x=m?0:Zt(-e*f,e*f);let E=y+_,v=d+x;const A=m?0:Zt(-60,60),b=m?0:Zt(-60,60),B=m?1:Zt(.8,1.2),U=m?1:Zt(.8,1.2);if(!m){const D=(y+1)/2,k=(d+1)/2,[P,j]=Sp(Ap,D,k,.001);let H=P*r,z=j*r;const T=Math.min(D,1-D,k,1-k),S=wp(0,1,T);H*=S,z*=S,E=E*(1-s)+(E+H)*s,v=v*(1-s)+(v+z)*s}u.push(V(g,p,E,v,A,b,B,U))}return Tp(u,h,l,n,a,o),Pr(h,l,u)}const Ip=`precision highp float;\r
\r
varying vec3 v_color;\r
varying vec2 v_uv;\r
uniform sampler2D u_texture;\r
uniform float u_time;\r
uniform float u_volume;\r
uniform float u_alpha;\r
\r
/* Gradient noise from Jorge Jimenez's presentation: */\r
/* http://www.iryoku.com/next-generation-post-processing-in-call-of-duty-advanced-warfare */\r
float gradientNoise(in vec2 uv) {\r
    return fract(52.9829189 * fract(dot(uv, vec2(0.06711056, 0.00583715))));\r
}\r
\r
vec2 rot(vec2 v, float a) {\r
    float s = sin(a);\r
    float c = cos(a);\r
    mat2 m = mat2(c, s, -s, c);\r
    return m * v;\r
}\r
\r
void main() {\r
    float dither = (1.0 / 255.0) * gradientNoise(gl_FragCoord.xy) - (0.5 / 255.0);\r
    vec2 centeredUV = v_uv - vec2(0.2);\r
    vec2 rotatedUV = rot(centeredUV, (u_time + u_volume) * 2.0);\r
    vec2 finalUV = rotatedUV * max(0.001, 1.0 - u_volume * 2.0) + vec2(0.5);\r
    vec4 result = texture2D(u_texture, finalUV);\r
    result *= vec4(v_color, u_alpha);\r
    result *= vec4(max(0.5, 1.0 - u_volume / 2.0));\r
    result += vec4(dither);\r
    gl_FragColor = result;\r
}`,Rp=`precision highp float;\r
\r
attribute vec2 a_pos;\r
attribute vec3 a_color;\r
attribute vec2 a_uv;\r
varying vec3 v_color;\r
varying vec2 v_uv;\r
\r
uniform float u_aspect;\r
\r
void main() {\r
    v_color = a_color;\r
    v_uv = a_uv;\r
    vec2 pos = a_pos;\r
    if (u_aspect > 1.0) {\r
        pos.y *= u_aspect;\r
    } else {\r
        pos.x /= u_aspect;\r
    }\r
    gl_Position = vec4(pos, 0.0, 1.0);\r
}\r
`;class Cp{constructor(t,e,r,s="unknown"){R(this,"gl"),R(this,"program"),R(this,"vertexShader"),R(this,"fragmentShader"),R(this,"attrs"),R(this,"notFoundUniforms",new Set),this.label=s,this.gl=t,this.vertexShader=this.createShader(t.VERTEX_SHADER,e),this.fragmentShader=this.createShader(t.FRAGMENT_SHADER,r),this.program=this.createProgram();const n=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),a={};for(let o=0;o<n;o++){const h=t.getActiveAttrib(this.program,o);if(!h)continue;const l=t.getAttribLocation(this.program,h.name);l!==-1&&(a[h.name]=l)}this.attrs=a}createShader(t,e){const r=this.gl,s=r.createShader(t);if(!s)throw new Error("Failed to create shader");if(r.shaderSource(s,e),r.compileShader(s),!r.getShaderParameter(s,r.COMPILE_STATUS))throw new Error(`Failed to compile shader for type ${t} "${this.label}": ${r.getShaderInfoLog(s)}`);return s}createProgram(){const t=this.gl,e=t.createProgram();if(!e)throw new Error("Failed to create program");if(t.attachShader(e,this.vertexShader),t.attachShader(e,this.fragmentShader),t.linkProgram(e),t.validateProgram(e),!t.getProgramParameter(e,t.LINK_STATUS)){const r=t.getProgramInfoLog(e);throw t.deleteProgram(e),new Error(`Failed to link program "${this.label}": ${r}`)}return e}use(){this.gl.useProgram(this.program)}warnUniformNotFound(t){this.notFoundUniforms.has(t)||(this.notFoundUniforms.add(t),console.warn(`Failed to get uniform location for program "${this.label}": ${t}`))}setUniform1f(t,e){const r=this.gl,s=r.getUniformLocation(this.program,t);s?r.uniform1f(s,e):this.warnUniformNotFound(t)}setUniform2f(t,e,r){const s=this.gl,n=s.getUniformLocation(this.program,t);n?s.uniform2f(n,e,r):this.warnUniformNotFound(t)}setUniform1i(t,e){const r=this.gl,s=r.getUniformLocation(this.program,t);s?r.uniform1i(s,e):this.warnUniformNotFound(t)}dispose(){const t=this.gl;t.deleteShader(this.vertexShader),t.deleteShader(this.fragmentShader),t.deleteProgram(this.program)}}class Lp{constructor(t,e,r,s){R(this,"vertexWidth",0),R(this,"vertexHeight",0),R(this,"vertexBuffer"),R(this,"indexBuffer"),R(this,"vertexData"),R(this,"indexData"),R(this,"vertexIndexLength",0),R(this,"wireFrame",!1),this.gl=t,this.attrPos=e,this.attrColor=r,this.attrUV=s;const n=t.createBuffer();if(!n)throw new Error("Failed to create vertex buffer");this.vertexBuffer=n;const a=t.createBuffer();if(!a)throw new Error("Failed to create index buffer");this.indexBuffer=a,this.bind(),this.vertexData=new Float32Array(0),this.indexData=new Uint16Array(0),this.resize(2,2),this.update()}setWireFrame(t){this.wireFrame=t,this.resize(this.vertexWidth,this.vertexHeight)}setVertexPos(t,e,r,s){const n=(t+e*this.vertexWidth)*7;if(n>=this.vertexData.length-1){console.warn("Vertex position out of range",n,this.vertexData.length);return}this.vertexData[n]=r,this.vertexData[n+1]=s}setVertexColor(t,e,r,s,n){const a=(t+e*this.vertexWidth)*7+2;if(a>=this.vertexData.length-1){console.warn("Vertex position out of range",a,this.vertexData.length);return}this.vertexData[a]=r,this.vertexData[a+1]=s,this.vertexData[a+2]=n}setVertexUV(t,e,r,s){const n=(t+e*this.vertexWidth)*7+2+3;if(n>=this.vertexData.length-1){console.warn("Vertex position out of range",n,this.vertexData.length);return}this.vertexData[n]=r,this.vertexData[n+1]=s}getVertexIndexLength(){return this.vertexIndexLength}draw(){const t=this.gl;this.wireFrame?t.drawElements(t.LINES,this.vertexIndexLength,t.UNSIGNED_SHORT,0):t.drawElements(t.TRIANGLES,this.vertexIndexLength,t.UNSIGNED_SHORT,0)}resize(t,e){this.vertexWidth=t,this.vertexHeight=e,this.vertexIndexLength=t*e*6,this.wireFrame&&(this.vertexIndexLength=t*e*10);const r=new Float32Array(t*e*7),s=new Uint16Array(this.vertexIndexLength);this.vertexData=r,this.indexData=s;for(let a=0;a<e;a++)for(let o=0;o<t;o++){const h=o/(t-1)*2-1,l=a/(e-1)*2-1;this.setVertexPos(o,a,h||0,l||0),this.setVertexColor(o,a,1,1,1),this.setVertexUV(o,a,o/(t-1),a/(e-1))}for(let a=0;a<e-1;a++)for(let o=0;o<t-1;o++)if(this.wireFrame){const h=(a*t+o)*10;s[h]=a*t+o,s[h+1]=a*t+o+1,s[h+2]=a*t+o+1,s[h+3]=(a+1)*t+o,s[h+4]=(a+1)*t+o,s[h+5]=(a+1)*t+o+1,s[h+6]=(a+1)*t+o+1,s[h+7]=a*t+o+1,s[h+8]=a*t+o,s[h+9]=(a+1)*t+o}else{const h=(a*t+o)*6;s[h]=a*t+o,s[h+1]=a*t+o+1,s[h+2]=(a+1)*t+o,s[h+3]=a*t+o+1,s[h+4]=(a+1)*t+o+1,s[h+5]=(a+1)*t+o}const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indexData,n.STATIC_DRAW)}bind(){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.attrPos!==void 0&&(t.vertexAttribPointer(this.attrPos,2,t.FLOAT,!1,28,0),t.enableVertexAttribArray(this.attrPos)),this.attrColor!==void 0&&(t.vertexAttribPointer(this.attrColor,3,t.FLOAT,!1,28,8),t.enableVertexAttribArray(this.attrColor)),this.attrUV!==void 0&&(t.vertexAttribPointer(this.attrUV,2,t.FLOAT,!1,28,20),t.enableVertexAttribArray(this.attrUV))}update(){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexData,t.DYNAMIC_DRAW)}dispose(){this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer)}}class Fp{constructor(){R(this,"color",bt.fromValues(1,1,1)),R(this,"location",pt.fromValues(0,0)),R(this,"uTangent",pt.fromValues(0,0)),R(this,"vTangent",pt.fromValues(0,0)),R(this,"_uRot",0),R(this,"_vRot",0),R(this,"_uScale",1),R(this,"_vScale",1),Object.seal(this)}get uRot(){return this._uRot}get vRot(){return this._vRot}set uRot(t){this._uRot=t,this.updateUTangent()}set vRot(t){this._vRot=t,this.updateVTangent()}get uScale(){return this._uScale}get vScale(){return this._vScale}set uScale(t){this._uScale=t,this.updateUTangent()}set vScale(t){this._vScale=t,this.updateVTangent()}updateUTangent(){this.uTangent[0]=Math.cos(this._uRot)*this._uScale,this.uTangent[1]=Math.sin(this._uRot)*this._uScale}updateVTangent(){this.vTangent[0]=-Math.sin(this._vRot)*this._vScale,this.vTangent[1]=Math.cos(this._vRot)*this._vScale}}const mr=ct.fromValues(2,-2,1,1,-3,3,-2,-1,0,0,1,0,1,0,0,0),kr=ct.clone(mr).transpose(),we=at.create(),oi=at.create(),Qe=at.create(),tr=ct.create(),er=ct.create();function Pp(i,t,e,r,s=pt.create()){we[0]=i**3,we[1]=i**2,we[2]=i,we[3]=1,oi.copy(we),Qe[0]=t**3,Qe[1]=t**2,Qe[2]=t,Qe[3]=1,tr.copy(e).transpose(),ct.mul(tr,tr,mr),ct.mul(tr,kr,tr),at.transformMat4(we,we,tr);const n=Qe.dot(we);er.copy(r).transpose(),ct.mul(er,er,mr),ct.mul(er,kr,er),at.transformMat4(oi,oi,er);const a=Qe.dot(oi);return s.x=n,s.y=a,s}function Xo(i,t,e,r,s,n=ct.create()){const a=l=>l.location[s],o=l=>l.uTangent[s],h=l=>l.vTangent[s];return n[0]=a(i),n[1]=a(t),n[2]=h(i),n[3]=h(t),n[4]=a(e),n[5]=a(r),n[6]=h(e),n[7]=h(r),n[8]=o(i),n[9]=o(t),n[10]=0,n[11]=0,n[12]=o(e),n[13]=o(r),n[14]=0,n[15]=0,n}function ln(i,t,e,r,s,n=ct.create()){const a=o=>o.color[s];return n.fill(0),n[0]=a(i),n[1]=a(t),n[4]=a(e),n[5]=a(r),n}const de=at.create(),hi=at.create(),li=at.create(),Le=at.create(),rr=ct.create(),ir=ct.create(),sr=ct.create(),ui=bt.create();function Np(i,t,e,r,s){return de[0]=i**3,de[1]=i**2,de[2]=i,de[3]=1,hi.copy(de),li.copy(de),Le[0]=t**3,Le[1]=t**2,Le[2]=t,Le[3]=1,rr.copy(e).transpose(),ct.mul(rr,rr,mr),ct.mul(rr,kr,rr),at.transformMat4(de,de,rr),ui.r=Le.dot(de),ir.copy(r).transpose(),ct.mul(ir,ir,mr),ct.mul(ir,kr,ir),at.transformMat4(hi,hi,ir),ui.g=Le.dot(hi),sr.copy(s).transpose(),ct.mul(sr,sr,mr),ct.mul(sr,kr,sr),at.transformMat4(li,li,sr),ui.b=Le.dot(li),ui}class Op{constructor(t,e){R(this,"_width",0),R(this,"_height",0),R(this,"_data",[]),this.resize(t,e),Object.seal(this)}resize(t,e){this._width=t,this._height=e,this._data=new Array(t*e).fill(0)}set(t,e,r){this._data[t+e*this._width]=r}get(t,e){return this._data[t+e*this._width]}get width(){return this._width}get height(){return this._height}}class Bp extends Lp{constructor(t,e,r,s){super(t,e,r,s),R(this,"_subDivisions",10),R(this,"_controlPoints",new Op(3,3)),R(this,"uMX",ct.create()),R(this,"uMY",ct.create()),R(this,"uMR",ct.create()),R(this,"uMG",ct.create()),R(this,"uMB",ct.create()),R(this,"tmpV2",pt.create()),this.resizeControlPoints(3,3),Object.seal(this)}setWireFrame(t){super.setWireFrame(t),this.updateMesh()}resetSubdivition(t){this._subDivisions=t,super.resize((this._controlPoints.width-1)*t,(this._controlPoints.height-1)*t)}resizeControlPoints(t,e){if(!(t>=2&&e>=2))throw new Error("Control points must be larger than 3x3 or equal");this._controlPoints.resize(t,e);for(let r=0;r<e;r++)for(let s=0;s<t;s++){const n=new Fp;n.location.x=s/(t-1)*2-1,n.location.y=r/(e-1)*2-1,n.uTangent.x=2/(t-1),n.vTangent.y=2/(e-1),this._controlPoints.set(s,r,n)}this.resetSubdivition(this._subDivisions)}getControlPoint(t,e){return this._controlPoints.get(t,e)}updateMesh(){const t=this._subDivisions-1,e=t*(this._controlPoints.height-1),r=t*(this._controlPoints.width-1);for(let s=0;s<this._controlPoints.width-1;s++)for(let n=0;n<this._controlPoints.height-1;n++){const a=this._controlPoints.get(s,n),o=this._controlPoints.get(s,n+1),h=this._controlPoints.get(s+1,n),l=this._controlPoints.get(s+1,n+1),u=Xo(a,o,h,l,"x",this.uMX),c=Xo(a,o,h,l,"y",this.uMY),f=ln(a,o,h,l,"r",this.uMR),p=ln(a,o,h,l,"g",this.uMG),g=ln(a,o,h,l,"b",this.uMB),y=s/(this._controlPoints.width-1),d=n/(this._controlPoints.height-1);for(let m=0;m<this._subDivisions;m++)for(let _=0;_<this._subDivisions;_++){const x=n*this._subDivisions+m,E=s*this._subDivisions+_,[v,A]=Pp(m/t,_/t,u,c,this.tmpV2);this.setVertexPos(x,E,v,A),this.setVertexUV(x,E,y+_/r,1-d-m/e);const[b,B,U]=Np(m/t,_/t,f,p,g);this.setVertexColor(x,E,b,B,U)}}this.update()}}class jo{constructor(t,e){R(this,"tex"),this.gl=t;const r=t.createTexture();if(!r)throw new Error("Failed to create texture");this.tex=r,t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex)}dispose(){this.gl.deleteTexture(this.tex)}}function kp(i,t){if("OffscreenCanvas"in window)return new OffscreenCanvas(i,t);const e=document.createElement("canvas");return e.width=i,e.height=t,e}class Dp extends su{constructor(t){super(t),R(this,"gl"),R(this,"lastFrameTime",0),R(this,"frameTime",0),R(this,"currentImageData"),R(this,"lastTickTime",0),R(this,"volume",0),R(this,"tickHandle",0),R(this,"maxFPS",60),R(this,"paused",!1),R(this,"staticMode",!1),R(this,"mainProgram"),R(this,"manualControl",!1),R(this,"reduceImageSizeCanvas",kp(32,32)),R(this,"targetSize",pt.fromValues(0,0)),R(this,"currentSize",pt.fromValues(0,0)),R(this,"isNoCover",!0),R(this,"meshStates",[]),R(this,"_disposed",!1),R(this,"onTickBinded",this.onTick.bind(this)),R(this,"supportTextureFloat",!0);const e=t.getContext("webgl");if(!e)throw new Error("WebGL not supported");e.getExtension("EXT_color_buffer_float")||console.warn("EXT_color_buffer_float not supported"),e.getExtension("EXT_float_blend")||(console.warn("EXT_float_blend not supported"),this.supportTextureFloat=!1),e.getExtension("OES_texture_float_linear")||console.warn("OES_texture_float_linear not supported"),e.getExtension("OES_texture_float")||(this.supportTextureFloat=!1,console.warn("OES_texture_float not supported")),this.gl=e,e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.depthFunc(e.ALWAYS),this.mainProgram=new Cp(e,Rp,Ip,"main-program-mg"),this.requestTick()}setManualControl(t){this.manualControl=t}setWireFrame(t){for(const e of this.meshStates)e.mesh.setWireFrame(t)}getControlPoint(t,e){var r,s;return(s=(r=this.meshStates[this.meshStates.length-1])==null?void 0:r.mesh)==null?void 0:s.getControlPoint(t,e)}resizeControlPoints(t,e){var r,s;return(s=(r=this.meshStates[this.meshStates.length-1])==null?void 0:r.mesh)==null?void 0:s.resizeControlPoints(t,e)}resetSubdivition(t){var e,r;return(r=(e=this.meshStates[this.meshStates.length-1])==null?void 0:e.mesh)==null?void 0:r.resetSubdivition(t)}onTick(t){if(this.tickHandle=0,this.paused||this._disposed)return;Number.isNaN(this.lastFrameTime)&&(this.lastFrameTime=t);const e=t-this.lastTickTime,r=t-this.lastFrameTime;if(this.lastFrameTime=t,e<1e3/this.maxFPS){this.requestTick();return}this.frameTime+=r*this.flowSpeed,this.onRedraw(this.frameTime,r)&&this.staticMode?this.staticMode&&(this.lastFrameTime=Number.NaN):this.requestTick(),this.lastTickTime=t}checkIfResize(){const[t,e]=[this.targetSize.x,this.targetSize.y],[r,s]=[this.currentSize.x,this.currentSize.y];if(t!==r||e!==s){super.onResize(t,e);const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,t,e),this.currentSize.x=t,this.currentSize.y=e}}onRedraw(t,e){const r=this.meshStates[this.meshStates.length-1];let s=!1;if(r)if(r.mesh.bind(),this.manualControl&&r.mesh.updateMesh(),this.isNoCover){for(const o of this.meshStates)o.alpha=Math.max(0,o.alpha-e/500);const a=this.meshStates.filter(o=>o.alpha===0);this.meshStates=this.meshStates.filter(o=>o.alpha>0);for(const o of a)o.mesh.dispose(),o.texture.dispose();this.meshStates.length===0&&(s=!0)}else{if(r.alpha=Math.min(1,r.alpha+e/500),r.alpha>=1){const a=this.meshStates.splice(0,this.meshStates.length-1);for(const o of a)o.mesh.dispose(),o.texture.dispose()}this.meshStates.length===1&&r.alpha>=1&&(s=!0)}const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,null),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.clear(n.COLOR_BUFFER_BIT),this.checkIfResize(),this.mainProgram.use(),n.activeTexture(n.TEXTURE0),this.mainProgram.setUniform1f("u_time",t/1e4),this.mainProgram.setUniform1f("u_aspect",this.manualControl?1:this.canvas.width/this.canvas.height),this.mainProgram.setUniform1i("u_texture",0),this.mainProgram.setUniform1f("u_volume",this.volume);for(const a of this.meshStates)this.mainProgram.setUniform1f("u_alpha",a.alpha),a.texture.bind(),a.mesh.bind(),a.mesh.draw();return n.flush(),s}requestTick(){this._disposed||this.tickHandle===0&&(this.tickHandle=requestAnimationFrame(this.onTickBinded))}onResize(t,e){this.targetSize.x=Math.ceil(t),this.targetSize.y=Math.ceil(e),this.requestTick()}setStaticMode(t){this.staticMode=t,this.lastFrameTime=performance.now(),this.requestTick()}setFPS(t){this.maxFPS=t}pause(){this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this.paused=!0}resume(){this.paused=!1,this.requestTick()}async setAlbum(t,e){if(t===void 0||typeof t=="string"&&t.trim().length===0){this.isNoCover=!0;return}let r=null,s=5;for(;!r&&s>0;)try{typeof t=="string"?r=await lu(t,e):r=await uu(t)}catch(u){console.warn(`failed on loading album resource, retrying (${s})`,{albumSource:t,error:u}),s--}if(!r){console.error("Failed to load album resource",t),this.isNoCover=!0;return}this.isNoCover=!1;const n=this.reduceImageSizeCanvas,a=n.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("Failed to create canvas context");a.clearRect(0,0,n.width,n.height);const o=r instanceof HTMLVideoElement?r.videoWidth:r.naturalWidth,h=r instanceof HTMLVideoElement?r.videoHeight:r.naturalHeight;if(o*h===0)throw new Error("Invalid image size");a.drawImage(r,0,0,o,h,0,0,n.width,n.height);const l=a.getImageData(0,0,n.width,n.height);if(Ho(l,.4),vp(l,3),Ho(l,1.7),bp(l,.75),_p(l,2,4),this.manualControl&&this.meshStates.length>0)this.meshStates[0].texture.dispose(),this.meshStates[0].texture=new jo(this.gl,l);else{const u=new Bp(this.gl,this.mainProgram.attrs.a_pos,this.mainProgram.attrs.a_color,this.mainProgram.attrs.a_uv);u.resetSubdivition(15);const c=Math.random()>.8?Mp(6,6):qo[Math.floor(Math.random()*qo.length)];u.resizeControlPoints(c.width,c.height);const f=2/(c.width-1),p=2/(c.height-1);for(const d of c.conf){const m=u.getControlPoint(d.cx,d.cy);m.location.x=d.x,m.location.y=d.y,m.uRot=d.ur*Math.PI/180,m.vRot=d.vr*Math.PI/180,m.uScale=f*d.up,m.vScale=p*d.vp}u.updateMesh(),this.currentImageData=l;const g=new jo(this.gl,l),y={mesh:u,texture:g,alpha:0};this.meshStates.push(y)}this.requestTick()}setLowFreqVolume(t){this.volume=t/10}setHasLyric(t){}dispose(){super.dispose(),this.tickHandle&&(cancelAnimationFrame(this.tickHandle),this.tickHandle=0),this._disposed=!0,this.mainProgram.dispose();for(const t of this.meshStates)t.mesh.dispose(),t.texture.dispose()}}class Up extends Ve{constructor(){super(...arguments),R(this,"time",0)}}class Gp extends su{constructor(t){super(t),R(this,"app"),R(this,"curContainer"),R(this,"staticMode",!1),R(this,"lastContainer",new Set),R(this,"onTick",e=>{for(const r of this.lastContainer)r.alpha=Math.max(0,r.alpha-e/60),r.alpha<=0&&(this.app.stage.removeChild(r),this.lastContainer.delete(r),r.destroy(!0));if(this.curContainer){this.curContainer.alpha=Math.min(1,this.curContainer.alpha+e/60);const[r,s,n,a]=this.curContainer.children,o=Math.max(this.app.screen.width,this.app.screen.height);r.position.set(this.app.screen.width/2,this.app.screen.height/2),s.position.set(this.app.screen.width/2.5,this.app.screen.height/2.5),n.position.set(this.app.screen.width/2,this.app.screen.height/2),a.position.set(this.app.screen.width/2,this.app.screen.height/2),r.width=o*Math.sqrt(2),r.height=r.width,s.width=o*.8,s.height=s.width,n.width=o*.5,n.height=n.width,a.width=o*.25,a.height=a.width,this.curContainer.time+=e*this.flowSpeed,r.rotation+=e/1e3*this.flowSpeed,s.rotation-=e/500*this.flowSpeed,n.rotation+=e/1e3*this.flowSpeed,a.rotation-=e/750*this.flowSpeed,n.x=this.app.screen.width/2+this.app.screen.width/4*Math.cos(this.curContainer.time/1e3*.75),n.y=this.app.screen.height/2+this.app.screen.width/4*Math.cos(this.curContainer.time/1e3*.75),a.x=this.app.screen.width/2+this.app.screen.width/4*.1+Math.cos(this.curContainer.time*.006*.75),a.y=this.app.screen.height/2+this.app.screen.width/4*.1+Math.cos(this.curContainer.time*.006*.75),this.curContainer.alpha>=1&&this.lastContainer.size===0&&this.staticMode&&this.app.ticker.stop()}}),this.canvas=t,this.app=new eu({view:t,resizeTo:this.canvas,powerPreference:"low-power",backgroundAlpha:1}),this.rebuildFilters(),this.app.ticker.maxFPS=30,this.app.ticker.add(this.onTick),this.app.ticker.start()}onResize(t,e){super.onResize(t,e),this.app.resize(),this.rebuildFilters()}setRenderScale(t){super.setRenderScale(t),this.rebuildFilters()}rebuildFilters(){const t=Math.min(this.canvas.width,this.canvas.height),e=Math.max(this.canvas.width,this.canvas.height),r=new Br;r.saturate(1.2,!1);const s=new Br;s.brightness(.6,!1);const n=new Br;n.contrast(.3,!0);for(const a of this.app.stage.filters??[])a.destroy();this.app.stage.filters=[],this.app.stage.filters.push(new xe(5,1)),this.app.stage.filters.push(new xe(10,1)),this.app.stage.filters.push(new xe(20,2)),this.app.stage.filters.push(new xe(40,2)),this.app.stage.filters.push(new xe(80,2)),t>768&&this.app.stage.filters.push(new xe(160,4)),t>768*2&&this.app.stage.filters.push(new xe(320,4)),this.app.stage.filters.push(r,s,n),this.app.stage.filters.push(new xe(5,1)),Math.random()>.5?(this.app.stage.filters.push(new Fr({radius:(e+t)/2,strength:1,center:[.25,1]})),this.app.stage.filters.push(new Fr({radius:(e+t)/2,strength:1,center:[.75,0]}))):(this.app.stage.filters.push(new Fr({radius:(e+t)/2,strength:1,center:[.75,1]})),this.app.stage.filters.push(new Fr({radius:(e+t)/2,strength:1,center:[.25,0]})))}setStaticMode(t=!1){this.staticMode=t,this.app.ticker.start()}setFPS(t){this.app.ticker.maxFPS=t}pause(){this.app.ticker.stop(),this.app.render()}resume(){this.app.ticker.start()}setLowFreqVolume(t){}setHasLyric(t){}async setAlbum(t,e){var r,s;if(!t||typeof t=="string"&&t.trim().length===0)return;let n=null,a=5,o=null;for(;!((s=(r=o?.baseTexture)==null?void 0:r.resource)!=null&&s.valid)&&a>0;)try{typeof t=="string"?n=await lu(t,e):n=await uu(t),o=gt.from(n,{resourceOptions:{autoLoad:!1}}),await o.baseTexture.resource.load()}catch(p){console.warn(`failed on loading album image, retrying (${a})`,t,p),o=null,a--}if(!o)return;const h=new Up,l=new dr(o),u=new dr(o),c=new dr(o),f=new dr(o);l.anchor.set(.5,.5),u.anchor.set(.5,.5),c.anchor.set(.5,.5),f.anchor.set(.5,.5),l.rotation=Math.random()*Math.PI*2,u.rotation=Math.random()*Math.PI*2,c.rotation=Math.random()*Math.PI*2,f.rotation=Math.random()*Math.PI*2,h.addChild(l,u,c,f),this.curContainer&&this.lastContainer.add(this.curContainer),this.curContainer=h,this.app.stage.addChild(h),this.curContainer.alpha=0,this.app.ticker.start()}dispose(){super.dispose(),this.app.ticker.remove(this.onTick),this.app.destroy(!0)}getElement(){return this.canvas}}class Pi{constructor(t,e){R(this,"element"),R(this,"renderer"),this.renderer=t,this.element=e,e.style.pointerEvents="none",e.style.zIndex="-1",e.style.contain="strict"}static new(t){const e=document.createElement("canvas");return new Pi(new t(e),e)}setRenderScale(t){this.renderer.setRenderScale(t)}setFlowSpeed(t){this.renderer.setFlowSpeed(t)}setStaticMode(t){this.renderer.setStaticMode(t)}setFPS(t){this.renderer.setFPS(t)}pause(){this.renderer.pause()}resume(){this.renderer.resume()}setLowFreqVolume(t){this.renderer.setLowFreqVolume(t)}setHasLyric(t){this.renderer.setHasLyric(t)}setAlbum(t,e){return this.renderer.setAlbum(t,e)}getElement(){return this.element}dispose(){this.renderer.dispose(),this.element.remove()}}const $p="_lyricLine_1vq69_6",Vp="_lyricBgLine_1vq69_42",zp="_active_1vq69_51",Hp="_hasDuetLine_1vq69_63",qp="_lyricDuetLine_1vq69_64",Xp="_lyricMainLine_1vq69_83",jp="_emphasizeWrapper_1vq69_93",Wp="_emphasize_1vq69_93",Yp="_lyricSubLine_1vq69_116",Kp="_disableSpring_1vq69_123",Zp="_interludeDots_1vq69_128",Jp="_enabled_1vq69_140",Qp="_tmpDisableTransition_1vq69_166",Tt={lyricLine:$p,lyricBgLine:Vp,active:zp,hasDuetLine:Hp,lyricDuetLine:qp,lyricMainLine:Xp,emphasizeWrapper:jp,emphasize:Wp,lyricSubLine:Yp,disableSpring:Kp,interludeDots:Zp,enabled:Jp,tmpDisableTransition:Qp},cu=-1,$i=0,Dr=1,Ni=2,Xn=3,jn=4,Wn=5,Yn=6,du=7,fu=8,Wo=typeof self=="object"?self:globalThis,tm=(i,t)=>{const e=(s,n)=>(i.set(n,s),s),r=s=>{if(i.has(s))return i.get(s);const[n,a]=t[s];switch(n){case $i:case cu:return e(a,s);case Dr:{const o=e([],s);for(const h of a)o.push(r(h));return o}case Ni:{const o=e({},s);for(const[h,l]of a)o[r(h)]=r(l);return o}case Xn:return e(new Date(a),s);case jn:{const{source:o,flags:h}=a;return e(new RegExp(o,h),s)}case Wn:{const o=e(new Map,s);for(const[h,l]of a)o.set(r(h),r(l));return o}case Yn:{const o=e(new Set,s);for(const h of a)o.add(r(h));return o}case du:{const{name:o,message:h}=a;return e(new Wo[o](h),s)}case fu:return e(BigInt(a),s);case"BigInt":return e(Object(BigInt(a)),s);case"ArrayBuffer":return e(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:o}=new Uint8Array(a);return e(new DataView(o),a)}}return e(new Wo[n](a),s)};return r},Yo=i=>tm(new Map,i)(0),nr="",{toString:em}={},{keys:rm}=Object,Sr=i=>{const t=typeof i;if(t!=="object"||!i)return[$i,t];const e=em.call(i).slice(8,-1);switch(e){case"Array":return[Dr,nr];case"Object":return[Ni,nr];case"Date":return[Xn,nr];case"RegExp":return[jn,nr];case"Map":return[Wn,nr];case"Set":return[Yn,nr];case"DataView":return[Dr,e]}return e.includes("Array")?[Dr,e]:e.includes("Error")?[du,e]:[Ni,e]},ci=([i,t])=>i===$i&&(t==="function"||t==="symbol"),im=(i,t,e,r)=>{const s=(a,o)=>{const h=r.push(a)-1;return e.set(o,h),h},n=a=>{if(e.has(a))return e.get(a);let[o,h]=Sr(a);switch(o){case $i:{let u=a;switch(h){case"bigint":o=fu,u=a.toString();break;case"function":case"symbol":if(i)throw new TypeError("unable to serialize "+h);u=null;break;case"undefined":return s([cu],a)}return s([o,u],a)}case Dr:{if(h){let f=a;return h==="DataView"?f=new Uint8Array(a.buffer):h==="ArrayBuffer"&&(f=new Uint8Array(a)),s([h,[...f]],a)}const u=[],c=s([o,u],a);for(const f of a)u.push(n(f));return c}case Ni:{if(h)switch(h){case"BigInt":return s([h,a.toString()],a);case"Boolean":case"Number":case"String":return s([h,a.valueOf()],a)}if(t&&"toJSON"in a)return n(a.toJSON());const u=[],c=s([o,u],a);for(const f of rm(a))(i||!ci(Sr(a[f])))&&u.push([n(f),n(a[f])]);return c}case Xn:return s([o,a.toISOString()],a);case jn:{const{source:u,flags:c}=a;return s([o,{source:u,flags:c}],a)}case Wn:{const u=[],c=s([o,u],a);for(const[f,p]of a)(i||!(ci(Sr(f))||ci(Sr(p))))&&u.push([n(f),n(p)]);return c}case Yn:{const u=[],c=s([o,u],a);for(const f of a)(i||!ci(Sr(f)))&&u.push(n(f));return c}}const{message:l}=a;return s([o,{name:h,message:l}],a)};return n},Ko=(i,{json:t,lossy:e}={})=>{const r=[];return im(!(t||e),!!t,new Map,r)(i),r},Zo=typeof structuredClone=="function"?(i,t)=>t&&("json"in t||"lossy"in t)?Yo(Ko(i,t)):structuredClone(i):(i,t)=>Yo(Ko(i,t)),sm=(i,t)=>i.size===t.size&&[...i].every(e=>t.has(e)),nm=i=>/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u.test(i);function am(i){return t=>(i(t+.001)-i(t-.001))/(2*.001)}function Jo(i){return am(i)}class Oi{constructor(t=0){R(this,"currentPosition",0),R(this,"targetPosition",0),R(this,"currentTime",0),R(this,"params",{}),R(this,"currentSolver"),R(this,"getV"),R(this,"getV2"),R(this,"queueParams"),R(this,"queuePosition"),this.targetPosition=t,this.currentPosition=this.targetPosition,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}resetSolver(){const t=this.getV(this.currentTime);this.currentTime=0,this.currentSolver=om(this.currentPosition,t,this.targetPosition,0,this.params),this.getV=Jo(this.currentSolver),this.getV2=Jo(this.getV)}arrived(){return Math.abs(this.targetPosition-this.currentPosition)<.01&&this.getV(this.currentTime)<.01&&this.getV2(this.currentTime)<.01&&this.queueParams===void 0&&this.queuePosition===void 0}setPosition(t){this.targetPosition=t,this.currentPosition=t,this.currentSolver=()=>this.targetPosition,this.getV=()=>0,this.getV2=()=>0}update(t=0){this.currentTime+=t,this.currentPosition=this.currentSolver(this.currentTime),this.queueParams&&(this.queueParams.time-=t,this.queueParams.time<=0&&this.updateParams({...this.queueParams})),this.queuePosition&&(this.queuePosition.time-=t,this.queuePosition.time<=0&&this.setTargetPosition(this.queuePosition.position)),this.arrived()&&this.setPosition(this.targetPosition)}updateParams(t,e=0){e>0?this.queueParams={...this.queuePosition??{},...t,time:e}:(this.queuePosition=void 0,this.params={...this.params,...t},this.resetSolver())}setTargetPosition(t,e=0){e>0?this.queuePosition={...this.queuePosition??{},position:t,time:e}:(this.queuePosition=void 0,this.targetPosition=t,this.resetSolver())}getCurrentPosition(){return this.currentPosition}}function om(i,t,e,r=0,s){const n=s?.soft??!1,a=s?.stiffness??100,o=s?.damping??10,h=s?.mass??1,l=e-i;if(n||1<=o/(2*Math.sqrt(a*h))){const g=-Math.sqrt(a/h),y=-g*l-t;return d=>(d-=r,d<0?i:e-(l+d*y)*Math.E**(d*g))}const u=Math.sqrt(4*h*a-o**2),c=(o*l-2*h*t)/u,f=.5*u/h,p=-(.5*o)/h;return g=>(g-=r,g<0?i:e-(Math.cos(g*f)*l+Math.sin(g*f)*c)*Math.E**(g*p))}const Fn=[],Qo=[];let Pn=!1;function hm(){let i=Qo.shift();for(;i;){try{i.resolve(i.task())}catch(t){i.reject(t)}i=Qo.shift()}for(i=Fn.shift();i;){try{i.resolve(i.task())}catch(t){i.reject(t)}i=Fn.shift()}Pn=!1}function lm(){Pn||(Pn=!0,requestAnimationFrame(hm))}function um(i){const t={task:i,resolve:()=>{},reject:()=>{}},e=new Promise((r,s)=>{t.resolve=r,t.reject=s});return Fn.push(t),lm(),e}class cm{constructor(t){R(this,"element",document.createElement("div")),R(this,"left",0),R(this,"top",0),R(this,"delay",0),R(this,"lineSize",[0,0]),R(this,"lineTransforms",{posX:new Oi(0),posY:new Oi(0)}),R(this,"lastStyle",""),this.lyricPlayer=t,this.element.setAttribute("class",Tt.lyricLine),this.rebuildStyle()}async measureSize(){return await um(()=>[this.element.clientWidth,this.element.clientHeight])}show(){this.rebuildStyle()}hide(){this.rebuildStyle()}rebuildStyle(){let t=`transform:translate(${this.lineTransforms.posX.getCurrentPosition().toFixed(2)}px,${this.lineTransforms.posY.getCurrentPosition().toFixed(2)}px);`;!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(t+=`transition-delay:${this.delay}ms;`),t!==this.lastStyle&&(this.lastStyle=t,this.element.setAttribute("style",t))}getElement(){return this.element}setTransform(t=this.left,e=this.top,r=!1,s=0){this.left=t,this.top=e,this.delay=s*1e3|0,r||!this.lyricPlayer.getEnableSpring()?(r&&this.element.classList.add(Tt.tmpDisableTransition),this.lineTransforms.posX.setPosition(t),this.lineTransforms.posY.setPosition(e),this.lyricPlayer.getEnableSpring()?this.rebuildStyle():this.show(),r&&requestAnimationFrame(()=>{this.element.classList.remove(Tt.tmpDisableTransition)})):(this.lineTransforms.posX.setTargetPosition(t,s),this.lineTransforms.posY.setTargetPosition(e,s))}update(t=0){this.lyricPlayer.getEnableSpring()&&(this.lineTransforms.posX.update(t),this.lineTransforms.posY.update(t),this.isInSight?this.show():this.hide())}get isInSight(){const t=this.lineTransforms.posX.getCurrentPosition(),e=this.lineTransforms.posY.getCurrentPosition(),r=t+this.lineSize[0],s=e+this.lineSize[1],n=this.lyricPlayer.size[0],a=this.lyricPlayer.size[1];return!(t>n||e>a||r<0||s<0)}dispose(){this.element.remove()}}function dm(i){const t=2.5949095;return i<.5?(2*i)**2*((t+1)*2*i-t)/2:((2*i-2)**2*((t+1)*(i*2-2)+t)+2)/2}function fm(i){return i===1?1:1-2**(-10*i)}const Fe=(i,t,e)=>Math.max(i,Math.min(t,e));class pm{constructor(){R(this,"element",document.createElement("div")),R(this,"dot0",document.createElement("span")),R(this,"dot1",document.createElement("span")),R(this,"dot2",document.createElement("span")),R(this,"left",0),R(this,"top",0),R(this,"playing",!0),R(this,"lastStyle",""),R(this,"currentInterlude"),R(this,"currentTime",0),R(this,"targetBreatheDuration",1500),this.element.className=Tt.interludeDots,this.element.appendChild(this.dot0),this.element.appendChild(this.dot1),this.element.appendChild(this.dot2)}getElement(){return this.element}setTransform(t=this.left,e=this.top){this.left=t,this.top=e,this.update()}setInterlude(t){this.currentInterlude=t,this.currentTime=t?.[0]??0,t?this.element.classList.add(Tt.enabled):this.element.classList.remove(Tt.enabled)}pause(){this.playing=!1,this.element.classList.remove(Tt.playing)}resume(){this.playing=!0,this.element.classList.add(Tt.playing)}update(t=0){if(!this.playing)return;this.currentTime+=t;let e="";if(e+=`transform:translate(${this.left.toFixed(2)}px, ${this.top.toFixed(2)}px)`,this.currentInterlude){const r=this.currentInterlude[1]-this.currentInterlude[0],s=this.currentTime-this.currentInterlude[0];if(s<=r){const n=r/Math.ceil(r/this.targetBreatheDuration);let a=1,o=1;a*=Math.sin(1.5*Math.PI-s/n*2)/20+1,s<2e3&&(a*=fm(s/2e3)),s<500?o=0:s<1e3&&(o*=(s-500)/500),r-s<750&&(a*=1-dm((750-(r-s))/750/2)),r-s<375&&(o*=Fe(0,(r-s)/375,1));const h=Math.max(0,r-750);a=Math.max(0,a)*.7,e+=` scale(${a})`;const l=Fe(.25,s*3/h*.75,1),u=Fe(.25,(s-h/3)*3/h*.75,1),c=Fe(.25,(s-h/3*2)*3/h*.75,1);this.dot0.style.opacity=`${Fe(0,Math.max(0,o*l),1)}`,this.dot1.style.opacity=`${Fe(0,Math.max(0,o*u),1)}`,this.dot2.style.opacity=`${Fe(0,Math.max(0,o*c),1)}`}else e+=" scale(0)",this.dot0.style.opacity="0",this.dot1.style.opacity="0",this.dot2.style.opacity="0";e+=";",this.lastStyle!==e&&(this.element.setAttribute("style",e),this.lastStyle=e)}}dispose(){this.element.remove()}}class mm extends EventTarget{constructor(){super(),R(this,"element",document.createElement("div")),R(this,"currentTime",0),R(this,"lyricLinesSize",new WeakMap),R(this,"lyricLineElementMap",new WeakMap),R(this,"currentLyricLines",[]),R(this,"processedLines",[]),R(this,"lyricLinesIndexes",new WeakMap),R(this,"hotLines",new Set),R(this,"bufferedLines",new Set),R(this,"isNonDynamic",!1),R(this,"hasDuetLine",!1),R(this,"scrollToIndex",0),R(this,"disableSpring",!1),R(this,"interludeDotsSize",[0,0]),R(this,"interludeDots",new pm),R(this,"bottomLine",new cm(this)),R(this,"enableBlur",!0),R(this,"enableScale",!0),R(this,"hidePassedLines",!1),R(this,"scrollBoundary",[0,0]),R(this,"currentLyricLineObjects",[]),R(this,"isSeeking",!1),R(this,"lastCurrentTime",0),R(this,"alignAnchor","center"),R(this,"alignPosition",.35),R(this,"scrollOffset",0),R(this,"size",[0,0]),R(this,"allowScroll",!0),R(this,"isPageVisible",!0),R(this,"initialLayoutFinished",!1),R(this,"posXSpringParams",{mass:1,damping:10,stiffness:100}),R(this,"posYSpringParams",{mass:.9,damping:15,stiffness:90}),R(this,"scaleSpringParams",{mass:2,damping:25,stiffness:100}),R(this,"scaleForBGSpringParams",{mass:1,damping:20,stiffness:50}),R(this,"onPageShow",()=>{this.isPageVisible=!0,this.setCurrentTime(this.currentTime,!0)}),R(this,"onPageHide",()=>{this.isPageVisible=!1}),R(this,"scrolledHandler",0),R(this,"isScrolled",!1),R(this,"resizeObserver",new ResizeObserver(l=>{let u=!1,c=!1;for(const f of l)if(f.target===this.element){const p=f.contentRect;this.size[0]=p.width,this.size[1]=p.height,c=!0}else if(f.target===this.interludeDots.getElement())this.interludeDotsSize[0]=f.target.clientWidth,this.interludeDotsSize[1]=f.target.clientHeight,u=!0;else if(f.target===this.bottomLine.getElement()){const p=[f.target.clientWidth,f.target.clientHeight],g=this.bottomLine.lineSize;(p[0]!==g[0]||p[1]!==g[1])&&(this.bottomLine.lineSize=p,u=!0)}else{const p=this.lyricLineElementMap.get(f.target);if(p){const g=[f.target.clientWidth,f.target.clientHeight],y=this.lyricLinesSize.get(p)??[0,0];(g[0]!==y[0]||g[1]!==y[1])&&(this.lyricLinesSize.set(p,g),p.onLineSizeChange(g),u=!0)}}u&&this.calcLayout(!0),c&&this.onResize()})),R(this,"wordFadeWidth",.5),R(this,"targetAlignIndex",0),R(this,"isPlaying",!0),this.resizeObserver.observe(this.element),this.resizeObserver.observe(this.interludeDots.getElement()),this.element.classList.add(Tt.lyricPlayer),this.element.appendChild(this.interludeDots.getElement()),this.element.appendChild(this.bottomLine.getElement()),this.interludeDots.setTransform(0,200),window.addEventListener("pageshow",this.onPageShow),window.addEventListener("pagehide",this.onPageHide);let t=0,e="none",r=0,s=0,n=0,a=Symbol("amll-scroll"),o=0,h=0;this.element.addEventListener("touchstart",l=>{this.beginScrollHandler()&&(l.preventDefault(),t=this.scrollOffset,r=l.touches[0].screenY,o=r,s=Date.now(),n=0)}),this.element.addEventListener("touchmove",l=>{if(this.beginScrollHandler()){l.preventDefault();const u=l.touches[0].screenY,c=u-r,f=u-o,p=f>0?"down":f<0?"up":"none";e!==p?(e=p,t=this.scrollOffset,r=u,s=Date.now()):this.scrollOffset=t-c,o=u,h=Date.now(),this.limitScrollOffset(),this.calcLayout(!0)}}),this.element.addEventListener("touchend",l=>{if(this.beginScrollHandler()){l.preventDefault(),r=0;const u=Date.now();if(u-h>100)return this.endScrollHandler();const c=u-s;n=(this.scrollOffset-t)/c*1e3;let f=0;const p=Symbol("amll-scroll");a=p;const g=y=>{f||(f=y),a===p&&this.beginScrollHandler()&&(this.scrollOffset+=n*(y-f)/1e3,n*=.99,this.limitScrollOffset(),this.calcLayout(!0),Math.abs(n)>1&&!this.scrollBoundary.includes(this.scrollOffset)&&requestAnimationFrame(g),this.endScrollHandler(),f=y)};requestAnimationFrame(g),this.endScrollHandler()}}),this.element.addEventListener("wheel",l=>{this.beginScrollHandler()&&(l.deltaMode===l.DOM_DELTA_PIXEL?(this.scrollOffset+=l.deltaY,this.limitScrollOffset(),this.calcLayout(!0)):(this.scrollOffset+=l.deltaY*50,this.limitScrollOffset(),this.calcLayout(!1)),this.endScrollHandler())})}beginScrollHandler(){const t=this.allowScroll;return t&&(this.isScrolled=!0,clearTimeout(this.scrolledHandler),this.scrolledHandler=setTimeout(()=>{this.isScrolled=!1,this.scrollOffset=0},5e3)),t}endScrollHandler(){}limitScrollOffset(){this.scrollOffset=Math.max(Math.min(this.scrollBoundary[1],this.scrollOffset),this.scrollBoundary[0])}setWordFadeWidth(t=.5){this.wordFadeWidth=Math.max(1e-4,t)}setEnableScale(t=!0){this.enableScale=t,this.calcLayout()}getEnableScale(){return this.enableScale}getWordFadeWidth(){return this.wordFadeWidth}setIsSeeking(t){this.isSeeking=t}setHidePassedLines(t){this.hidePassedLines=t,this.calcLayout()}setEnableBlur(t){this.enableBlur!==t&&(this.enableBlur=t,this.calcLayout())}setAlignAnchor(t){this.alignAnchor=t}setAlignPosition(t){this.alignPosition=t}setEnableSpring(t=!0){this.disableSpring=!t,t?this.element.classList.remove(Tt.disableSpring):this.element.classList.add(Tt.disableSpring),this.calcLayout(!0)}getEnableSpring(){return!this.disableSpring}getCurrentInterlude(){var t,e,r,s;if(this.bufferedLines.size>0)return;const n=this.currentTime+20,a=this.scrollToIndex;if(a===0){if((t=this.processedLines[0])!=null&&t.startTime){if(this.processedLines[0].startTime>n)return[n,Math.max(n,this.processedLines[0].startTime-250),-2,this.processedLines[0].isDuet];if(this.processedLines[1].startTime>n&&this.processedLines[0].endTime<n)return[Math.max(this.processedLines[0].endTime,n),this.processedLines[1].startTime,0,this.processedLines[1].isDuet]}}else if((e=this.processedLines[a])!=null&&e.endTime&&(r=this.processedLines[a+1])!=null&&r.startTime){if(this.processedLines[a+1].startTime>n&&this.processedLines[a].endTime<n)return[Math.max(this.processedLines[a].endTime,n),this.processedLines[a+1].startTime,a,this.processedLines[a+1].isDuet];if((s=this.processedLines[a+2])!=null&&s.startTime&&this.processedLines[a+2].startTime>n&&this.processedLines[a+1].endTime<n)return[Math.max(this.processedLines[a+1].endTime,n),this.processedLines[a+2].startTime,a+1,this.processedLines[a+2].isDuet]}}setLyricLines(t,e=0){this.initialLayoutFinished=!0;for(const r of t)for(const s of r.words)s.word=s.word.replace(/\s+/g," ");this.lastCurrentTime=e,this.currentTime=e,this.currentLyricLines=Zo(t),this.processedLines=Zo(t),this.isNonDynamic=!0;for(const r of this.processedLines)if(r.words.length>1){this.isNonDynamic=!1;break}this.hasDuetLine=this.processedLines.some(r=>r.isDuet),this.processedLines.forEach((r,s,n)=>{if(r.isBG)return;const a=n[s+1];a!=null&&a.isBG&&(a.startTime=Math.min(a.startTime,r.startTime),a.endTime=Math.max(a.endTime,r.endTime))});for(const r of this.currentLyricLineObjects)r.dispose();this.interludeDots.setInterlude(void 0),this.hotLines.clear(),this.bufferedLines.clear(),this.setCurrentTime(0,!0)}setCurrentTime(t,e=!1){var r,s,n,a,o,h,l,u,c;if(this.currentTime=t,!this.initialLayoutFinished&&!e)return;const f=new Set,p=new Set,g=new Set;for(const y of this.hotLines){const d=this.processedLines[y];if(d){if(d.isBG)continue;const m=this.processedLines[y+1];if(m!=null&&m.isBG){const _=this.processedLines[y+2],x=Math.min(d.startTime,m?.startTime),E=Math.min(Math.max(d.endTime,_?.startTime??Number.MAX_VALUE),Math.max(d.endTime,m?.endTime));(x>t||E<=t)&&(this.hotLines.delete(y),f.add(y),this.hotLines.delete(y+1),f.add(y+1),e&&((r=this.currentLyricLineObjects[y])==null||r.disable(),(s=this.currentLyricLineObjects[y+1])==null||s.disable()))}else(d.startTime>t||d.endTime<=t)&&(this.hotLines.delete(y),f.add(y),e&&((n=this.currentLyricLineObjects[y])==null||n.disable()))}else this.hotLines.delete(y),f.add(y),e&&((a=this.currentLyricLineObjects[y])==null||a.disable())}this.currentLyricLineObjects.forEach((y,d,m)=>{var _,x;const E=y.getLine();!E.isBG&&E.startTime<=t&&E.endTime>t&&(this.hotLines.has(d)||(this.hotLines.add(d),g.add(d),e&&y.enable(),(x=(_=m[d+1])==null?void 0:_.getLine())!=null&&x.isBG&&(this.hotLines.add(d+1),g.add(d+1),e&&m[d+1].enable())))});for(const y of this.bufferedLines)this.hotLines.has(y)||(p.add(y),e&&((o=this.currentLyricLineObjects[y])==null||o.disable()));if(e){this.bufferedLines.size>0?this.scrollToIndex=Math.min(...this.bufferedLines):this.scrollToIndex=this.processedLines.findIndex(y=>y.startTime>=t),this.bufferedLines.clear();for(const y of this.hotLines)this.bufferedLines.add(y);this.calcLayout()}else if(p.size>0||g.size>0)if(p.size===0&&g.size>0){for(const y of g)this.bufferedLines.add(y),(h=this.currentLyricLineObjects[y])==null||h.enable();this.scrollToIndex=Math.min(...this.bufferedLines),this.calcLayout()}else if(g.size===0&&p.size>0){if(sm(p,this.bufferedLines)){for(const y of this.bufferedLines)this.hotLines.has(y)||(this.bufferedLines.delete(y),(l=this.currentLyricLineObjects[y])==null||l.disable());this.calcLayout()}}else{for(const y of g)this.bufferedLines.add(y),(u=this.currentLyricLineObjects[y])==null||u.enable();for(const y of p)this.bufferedLines.delete(y),(c=this.currentLyricLineObjects[y])==null||c.disable();this.bufferedLines.size>0&&(this.scrollToIndex=Math.min(...this.bufferedLines)),this.calcLayout()}this.lastCurrentTime=t}async calcLayout(t=!1){var e;const r=this.getCurrentInterlude();let s=-this.scrollOffset,n=this.scrollToIndex,a=0;r?(a=r[1]-r[0],a>=4e3&&this.currentLyricLineObjects[r[2]+1]&&(n=r[2]+1)):this.interludeDots.setInterlude(void 0);const o=this.size[1]/5,h=this.currentLyricLineObjects.slice(0,n).reduce((g,y)=>{var d;return g+(y.getLine().isBG&&this.isPlaying?0:((d=this.lyricLinesSize.get(y))==null?void 0:d[1])??o)},0);this.scrollBoundary[0]=-h,s-=h,s+=this.size[1]*this.alignPosition;const l=this.currentLyricLineObjects[n];if(this.targetAlignIndex=n,l){const g=((e=this.lyricLinesSize.get(l))==null?void 0:e[1])??o;switch(this.alignAnchor){case"bottom":s-=g;break;case"center":s-=g/2;break}}const u=Math.max(...this.bufferedLines);let c=0,f=t?0:.05,p=!1;this.currentLyricLineObjects.forEach((g,y)=>{var d,m;const _=this.bufferedLines.has(y),x=_||y>=this.scrollToIndex&&y<u,E=g.getLine();!p&&a>=4e3&&(y===this.scrollToIndex&&r?.[2]===-2||y===this.scrollToIndex+1)&&(p=!0,this.interludeDots.setTransform(0,s),r&&this.interludeDots.setInterlude([r[0],r[1]]),s+=this.interludeDotsSize[1]);let v;this.hidePassedLines?y<(r?r[2]+1:this.scrollToIndex)&&this.isPlaying?v=1e-5:_?v=.85:v=this.isNonDynamic?.2:1:_?v=.85:v=this.isNonDynamic?.2:1;let A=0;this.enableBlur&&(x?A=0:(A=1,y<this.scrollToIndex?A+=Math.abs(this.scrollToIndex-y)+1:A+=Math.abs(y-Math.max(this.scrollToIndex,u))));const b=this.enableScale?97:100;let B=100;!x&&this.isPlaying&&(E.isBG?B=75:B=b),g.setTransform(s,B,v,window.innerWidth<=1024?A*.8:A,!1,c),E.isBG&&(x||!this.isPlaying)?s+=((d=this.lyricLinesSize.get(g))==null?void 0:d[1])??o:E.isBG||(s+=((m=this.lyricLinesSize.get(g))==null?void 0:m[1])??o),s>=0&&!this.isSeeking&&(E.isBG||(c+=f),y>=this.scrollToIndex&&(f/=1.05))}),this.scrollBoundary[1]=s+this.scrollOffset-this.size[1]/2,this.bottomLine.setTransform(0,s,!1,c)}setLinePosXSpringParams(t={}){}setLinePosYSpringParams(t={}){this.posYSpringParams={...this.posYSpringParams,...t},this.bottomLine.lineTransforms.posY.updateParams(this.posYSpringParams);for(const e of this.currentLyricLineObjects)e.lineTransforms.posY.updateParams(this.posYSpringParams)}setLineScaleSpringParams(t={}){this.scaleSpringParams={...this.scaleSpringParams,...t},this.scaleForBGSpringParams={...this.scaleForBGSpringParams,...t};for(const e of this.currentLyricLineObjects)e.getLine().isBG?e.lineTransforms.scale.updateParams(this.scaleForBGSpringParams):e.lineTransforms.scale.updateParams(this.scaleSpringParams)}pause(){this.interludeDots.pause(),this.isPlaying&&(this.isPlaying=!1,this.calcLayout())}resume(){this.interludeDots.resume(),this.isPlaying||(this.isPlaying=!0,this.calcLayout())}update(t=0){this.bottomLine.update(t/1e3),this.interludeDots.update(t/1e3)}onResize(){}getBottomLineElement(){return this.bottomLine.getElement()}resetScroll(){this.isScrolled=!1,this.scrollOffset=0,clearTimeout(this.scrolledHandler),this.scrolledHandler=0}getLyricLines(){return this.currentLyricLines}getCurrentTime(){return this.currentTime}getElement(){return this.element}dispose(){this.element.remove(),window.removeEventListener("pageshow",this.onPageShow),window.removeEventListener("pagehide",this.onPageHide)}}class ar extends EventTarget{constructor(){super(...arguments),R(this,"top",0),R(this,"scale",1),R(this,"blur",0),R(this,"opacity",1),R(this,"delay",0),R(this,"lineTransforms",{posY:new Oi(0),scale:new Oi(100)})}onLineSizeChange(t){}setTransform(t=this.top,e=this.scale,r=this.opacity,s=this.blur,n=!1,a=0){this.top=t,this.scale=e,this.opacity=r,this.blur=s,this.delay=a}static shouldEmphasize(t){return nm(t.word)?t.endTime-t.startTime>=1e3:t.endTime-t.startTime>=1e3&&t.word.trim().length<=7&&t.word.trim().length>1}dispose(){}}function gm(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var un,th;function ym(){if(th)return un;th=1;var i=4,t=.001,e=1e-7,r=10,s=11,n=1/(s-1),a=typeof Float32Array=="function";function o(y,d){return 1-3*d+3*y}function h(y,d){return 3*d-6*y}function l(y){return 3*y}function u(y,d,m){return((o(d,m)*y+h(d,m))*y+l(d))*y}function c(y,d,m){return 3*o(d,m)*y*y+2*h(d,m)*y+l(d)}function f(y,d,m,_,x){var E,v,A=0;do v=d+(m-d)/2,E=u(v,_,x)-y,E>0?m=v:d=v;while(Math.abs(E)>e&&++A<r);return v}function p(y,d,m,_){for(var x=0;x<i;++x){var E=c(d,m,_);if(E===0)return d;var v=u(d,m,_)-y;d-=v/E}return d}function g(y){return y}return un=function(y,d,m,_){if(!(0<=y&&y<=1&&0<=m&&m<=1))throw new Error("bezier x values must be in [0, 1] range");if(y===d&&m===_)return g;for(var x=a?new Float32Array(s):new Array(s),E=0;E<s;++E)x[E]=u(E*n,y,m);function v(A){for(var b=0,B=1,U=s-1;B!==U&&x[B]<=A;++B)b+=n;--B;var D=(A-x[B])/(x[B+1]-x[B]),k=b+D*n,P=c(k,y,m);return P>=t?p(A,k,y,m):P===0?k:f(A,b,b+n,y,m)}return function(A){return A===0?0:A===1?1:u(v(A),d,_)}},un}var _m=ym();const Vi=gm(_m),vm=/^[\p{Unified_Ideograph}\u0800-\u9FFC]+$/u;function bm(i){const t=[];for(const n of i){const a=n.word.replace(/\s/g,"").length,o=n.word.split(" ").filter(h=>h.trim().length>0);if(o.length>1){n.word.startsWith(" ")&&t.push({word:" ",startTime:0,endTime:0,obscene:!1});let h=0;for(const l of o){const u={word:l,obscene:n.obscene,startTime:n.startTime+h/a*(n.endTime-n.startTime),endTime:n.startTime+(h+l.length)/a*(n.endTime-n.startTime)};t.push(u),t.push({word:" ",startTime:0,endTime:0,obscene:!1}),h+=l.length}n.word.endsWith(" ")||t.pop()}else t.push({...n})}let e=[],r=[];const s=[];for(const n of t){const a=n.word;e.push(a),r.push(n),a.length>0&&a.trim().length===0?(e.pop(),r.pop(),r.length===1?s.push(r[0]):r.length>1&&s.push(r),s.push(n),e=[],r=[]):(!/^\s*[^\s]*\s*$/.test(e.join(""))||vm.test(a))&&(e.pop(),r.pop(),r.length===1?s.push(r[0]):r.length>1&&s.push(r),e=[a],r=[n])}return r.length===1?s.push(r[0]):s.push(r),s}function xm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wm(i,t=1,e={x:0,y:0}){const[r,s]=[e.x,e.y];return[i[0]*t,i[1]*t,i[2]*t,i[3],i[4]*t,i[5]*t,i[6]*t,i[7],i[8]*t,i[9]*t,i[10]*t,i[11],i[12]-r*t+r,i[13]-s*t+s,i[14],i[15]]}function Tm(i,t=4){const e=(r,s)=>r.toFixed(t);return`matrix3d(${i.map(e).join(", ")})`}const di=32,pu=(i,t)=>e=>Math.min(1,Math.max(0,(e-i)/(t-i))),Kn=.5,Em=pu(0,Kn),Am=pu(Kn,1),Sm=Vi(.2,.4,.58,1),Mm=Vi(.3,0,.58,1),Im=i=>t=>t<i?Sm(Em(t)):1-Mm(Am(t));function eh(i,t=0,e="rgba(0,0,0,var(--bright-mask-alpha, 1.0))",r="rgba(0,0,0,var(--dark-mask-alpha, 1.0))"){const s=2+i+t,n=i/s,a=(1-n)/2;return[`linear-gradient(to right,${e} ${a*100}%,${r} ${(a+n)*100}%)`,s]}let Rm=class extends MouseEvent{constructor(i,t){super(t.type,t),this.line=i}};function Cm(i){const t=i.match(/matrix\(([^)]+)\)/);if(t){const e=t[1].split(", "),r=Number.parseFloat(e[0]),s=Number.parseFloat(e[3]);return(r+s)/2}return 1}let Lm=class extends ar{constructor(i,t={words:[],translatedLyric:"",romanLyric:"",startTime:0,endTime:0,isBG:!1,isDuet:!1}){super(),R(this,"element",document.createElement("div")),R(this,"splittedWords",[]),R(this,"lineSize",[0,0]),R(this,"listenersMap",new Map),R(this,"onMouseEvent",n=>{const a=new Rm(this,n);for(const o of this.listenersMap.get(n.type)??[])o.call(this,a);if(!this.dispatchEvent(a)||a.defaultPrevented)return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!1}),R(this,"isEnabled",!1),R(this,"lastWord"),R(this,"_hide",!0),R(this,"_prevParentEl"),R(this,"lastStyle",""),this.lyricPlayer=i,this.lyricLine=t,this._prevParentEl=i.getElement(),i.resizeObserver.observe(this.element),this.element.setAttribute("class",Tt.lyricLine),this.lyricLine.isBG&&this.element.classList.add(Tt.lyricBgLine),this.lyricLine.isDuet&&this.element.classList.add(Tt.lyricDuetLine),this.lineTransforms.posY.setPosition(window.innerHeight*2),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div")),this.element.appendChild(document.createElement("div"));const e=this.element.children[0],r=this.element.children[1],s=this.element.children[2];e.setAttribute("class",Tt.lyricMainLine),r.setAttribute("class",Tt.lyricSubLine),s.setAttribute("class",Tt.lyricSubLine),this.rebuildElement(),this.rebuildStyle()}addMouseEventListener(i,t,e){if(t){const r=this.listenersMap.get(i)??new Set;r.size===0&&this.element.addEventListener(i,this.onMouseEvent,e),r.add(t),this.listenersMap.set(i,r)}}removeMouseEventListener(i,t,e){if(t){const r=this.listenersMap.get(i);r&&(r.delete(t),r.size===0&&this.element.removeEventListener(i,this.onMouseEvent,e))}}areWordsOnSameLine(i,t){if(i!=null&&i.mainElement&&t!=null&&t.mainElement){const e=i.mainElement,r=t.mainElement,s=e.getBoundingClientRect(),n=r.getBoundingClientRect();return Math.abs(s.top-n.top)<10}return!0}async enable(i=this.lyricLine.startTime){this.isEnabled=!0,this.element.classList.add(Tt.active);const t=this.element.children[0];for(const e of this.splittedWords){for(const r of e.elementAnimations)r.currentTime=0,r.playbackRate=1,r.play();for(const r of e.maskAnimations)r.currentTime=Math.min(this.totalDuration,Math.max(0,i-this.lyricLine.startTime)),r.playbackRate=1,r.play()}t.classList.add(Tt.active)}disable(){this.isEnabled=!1,this.element.classList.remove(Tt.active);const i=this.element.children[0];for(const t of this.splittedWords)for(const e of t.elementAnimations)(e.id==="float-word"||e.id.includes("emphasize-word-float-only"))&&(e.playbackRate=-1,e.play());i.classList.remove(Tt.active)}async resume(){if(this.isEnabled)for(const i of this.splittedWords){for(const t of i.elementAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(i))&&t.play();for(const t of i.maskAnimations)(!this.lastWord||this.splittedWords.indexOf(this.lastWord)<this.splittedWords.indexOf(i))&&t.play()}}async pause(){if(this.isEnabled)for(const i of this.splittedWords){for(const t of i.elementAnimations)t.pause();for(const t of i.maskAnimations)t.pause()}}setMaskAnimationState(i=0){const t=i-this.lyricLine.startTime;for(const e of this.splittedWords)for(const r of e.maskAnimations)r.currentTime=Math.min(this.totalDuration,Math.max(0,t)),r.playbackRate=1,t>=0&&t<this.totalDuration?r.play():r.pause()}getLine(){return this.lyricLine}show(){this._hide=!1,this.element.parentElement||(this._prevParentEl.appendChild(this.element),this.lyricPlayer.resizeObserver.observe(this.element)),this.rebuildStyle()}hide(){this._hide=!0,this.element.parentElement&&(this._prevParentEl.removeChild(this.element),this.lyricPlayer.resizeObserver.unobserve(this.element))}rebuildStyle(){let i="";i+=`transform:translateY(${this.lineTransforms.posY.getCurrentPosition().toFixed(1)}px) scale(${(this.lineTransforms.scale.getCurrentPosition()/100).toFixed(4)});`,!this.lyricPlayer.getEnableSpring()&&this.isInSight&&(i+=`transition-delay:${this.delay}ms;`),i+=`filter:blur(${Math.min(32,this.blur)}px);`,i!==this.lastStyle&&(this.lastStyle=i,this.element.setAttribute("style",i))}rebuildElement(){this.disposeElements();const i=this.element.children[0],t=this.element.children[1],e=this.element.children[2];if(this.lyricPlayer._getIsNonDynamic()){i.innerText=this.lyricLine.words.map(s=>s.word).join(""),t.innerText=this.lyricLine.translatedLyric,e.innerText=this.lyricLine.romanLyric;return}const r=bm(this.lyricLine.words);i.innerHTML="";for(const s of r)if(Array.isArray(s)){if(s.length===0)continue;const n=s.reduce((l,u)=>(l.endTime=Math.max(l.endTime,u.endTime),l.startTime=Math.min(l.startTime,u.startTime),l.word+=u.word,l),{word:"",startTime:Number.POSITIVE_INFINITY,endTime:Number.NEGATIVE_INFINITY,wordType:"normal",obscene:!1}),a=s.map(l=>ar.shouldEmphasize(l)).reduce((l,u)=>l||u,ar.shouldEmphasize(n)),o=document.createElement("span");o.classList.add(Tt.emphasizeWrapper);const h=[];for(const l of s){const u=document.createElement("span");if(a){u.classList.add(Tt.emphasize);const c=[];for(const p of l.word.trim().split("")){const g=document.createElement("span");g.innerText=p,c.push(g),h.push(g),u.appendChild(g)}const f={...l,mainElement:u,subElements:c,elementAnimations:[this.initFloatAnimation(l,u)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:a};this.splittedWords.push(f)}else u.innerText=l.word,this.splittedWords.push({...l,mainElement:u,subElements:[],elementAnimations:[this.initFloatAnimation(l,u)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:a});o.appendChild(u)}a&&this.splittedWords[this.splittedWords.length-1].elementAnimations.push(...this.initEmphasizeAnimation(n,h,n.endTime-n.startTime,n.startTime-this.lyricLine.startTime)),n.word.trimStart()!==n.word&&i.appendChild(document.createTextNode(" ")),i.appendChild(o),n.word.trimEnd()!==n.word&&ar.shouldEmphasize(n)&&i.appendChild(document.createTextNode(" "))}else if(s.word.trim().length===0)i.appendChild(document.createTextNode(" "));else{const n=ar.shouldEmphasize(s),a=document.createElement("span"),o={...s,mainElement:a,subElements:[],elementAnimations:[this.initFloatAnimation(s,a)],maskAnimations:[],width:0,height:0,padding:0,shouldEmphasize:n};if(ar.shouldEmphasize(s)){a.classList.add(Tt.emphasize);const h=[];for(const u of s.word.trim().split("")){const c=document.createElement("span");c.innerText=u,h.push(c),a.appendChild(c)}o.subElements=h;const l=Math.abs(o.endTime-o.startTime);o.elementAnimations.push(...this.initEmphasizeAnimation(s,h,l,o.startTime-this.lyricLine.startTime))}else a.innerText=s.word.trim();s.word.trimStart()!==s.word&&i.appendChild(document.createTextNode(" ")),i.appendChild(a),s.word.trimEnd()!==s.word&&i.appendChild(document.createTextNode(" ")),this.splittedWords.push(o)}t.innerText=this.lyricLine.translatedLyric,e.innerText=this.lyricLine.romanLyric}initFloatAnimation(i,t){const e=i.startTime-this.lyricLine.startTime,r=Math.max(1e3,i.endTime-i.startTime);let s=.05;this.lyricLine.isBG&&(s*=2);const n=t.animate([{transform:"translateY(0px)"},{transform:`translateY(${-s}em)`}],{duration:Number.isFinite(r)?r:0,delay:Number.isFinite(e)?e:0,id:"float-word",composite:"add",fill:"both",easing:"ease-out"});return n.pause(),n}initEmphasizeAnimation(i,t,e,r){const s=Math.max(0,r);let n=Math.max(1e3,e),a=[],o=n/2e3;o=o>1?Math.sqrt(o):o**3;let h=n/3e3;h=h>1?Math.sqrt(h):h**3,o*=.6,h*=.5,this.lyricLine.words.length>0&&i.word.includes(this.lyricLine.words[this.lyricLine.words.length-1].word)&&(o*=1.6,h*=1.5,n*=1.2),o=Math.min(1.2,o),h=Math.min(.8,h);const l=Number.isFinite(n)?n:0,u=Im(Kn);return a=t.flatMap((c,f,p)=>{const g=s+n/2.5/p.length*f,y=[],d=new Array(di).fill(0).map((E,v)=>{const A=(v+1)/di,b=u(A),B=u(A)*h,U=wm(xm(),1+b*.1*o),D=-b*.03*o*(p.length/2-f),k=-b*.025*o;return{offset:A,transform:`${Tm(U,4)} translate(${D}em, ${k}em)`,textShadow:`0 0 ${Math.min(.3,h*.3)}em rgba(255, 255, 255, ${B})`}}),m=c.animate(d,{duration:l,delay:Number.isFinite(g)?g:0,id:`emphasize-word-${c.innerText}-${f}`,iterations:1,composite:"replace",fill:"both"});m.onfinish=()=>{m.pause()},m.pause(),y.push(m);const _=new Array(di).fill(0).map((E,v)=>{const A=(v+1)/di;let b=Math.sin(A*Math.PI);return this.lyricLine.isBG&&(b*=2),{offset:A,transform:`translateY(${-b*.05}em)`}}),x=c.animate(_,{duration:l*1.4,delay:Number.isFinite(g)?g-400:0,id:"emphasize-word-float",iterations:1,composite:"add",fill:"both"});return x.onfinish=()=>{x.pause()},x.pause(),y.push(x),y}),a}get totalDuration(){return this.lyricLine.endTime-this.lyricLine.startTime}onLineSizeChange(i){this.updateMaskImageSync()}updateMaskImageSync(){for(const i of this.splittedWords){const t=i.mainElement;t?(i.padding=Number.parseFloat(getComputedStyle(t).paddingLeft),i.width=t.clientWidth-i.padding*2,i.height=t.clientHeight-i.padding*2):(i.width=0,i.height=0,i.padding=0)}this.lyricPlayer.supportMaskImage?this.generateWebAnimationBasedMaskImage():this.generateCalcBasedMaskImage(),this.isEnabled&&this.enable(this.lyricPlayer.getCurrentTime())}generateCalcBasedMaskImage(){for(const i of this.splittedWords){const t=i.mainElement;if(t){i.width=t.clientWidth,i.height=t.clientHeight;const e=i.height*this.lyricPlayer.getWordFadeWidth(),[r,s]=eh(e/i.width),n=`${s*100}% 100%`;this.lyricPlayer.supportMaskImage?(t.style.maskImage=r,t.style.maskRepeat="no-repeat",t.style.maskOrigin="left",t.style.maskSize=n):(t.style.webkitMaskImage=r,t.style.webkitMaskRepeat="no-repeat",t.style.webkitMaskOrigin="left",t.style.webkitMaskSize=n);const a=i.width+e,o=`clamp(${-a}px,calc(${-a}px + (var(--amll-player-time) - ${i.startTime})*${a/Math.abs(i.endTime-i.startTime)}px),0px) 0px, left top`;t.style.maskPosition=o,t.style.webkitMaskPosition=o}}}generateWebAnimationBasedMaskImage(){const i=Math.max(this.splittedWords.reduce((t,e)=>Math.max(e.endTime,t),0),this.lyricLine.endTime)-this.lyricLine.startTime;this.splittedWords.forEach((t,e)=>{const r=t.mainElement;if(r){const s=t.height*this.lyricPlayer.getWordFadeWidth(),[n,a]=eh(s/(t.width+t.padding*2)),o=`${a*100}% 100%`;this.lyricPlayer.supportMaskImage?(r.style.maskImage=n,r.style.maskRepeat="no-repeat",r.style.maskOrigin="left",r.style.maskSize=o):(r.style.webkitMaskImage=n,r.style.webkitMaskRepeat="no-repeat",r.style.webkitMaskOrigin="left",r.style.webkitMaskSize=o);const h=this.splittedWords.slice(0,e).reduce((_,x)=>_+x.width,0)+(this.splittedWords[0]?s:0),l=-(t.width+t.padding*2+s),u=_=>Math.max(l,Math.min(0,_));let c=-h-t.width-t.padding-s,f=0;const p=[];let g=c,y=0;const d=()=>{const _=c-g,x=Math.max(0,Math.min(1,f)),E=x-y,v=Math.abs(E/_);if(c>l&&g<l){const B=Math.abs(g-l)*v,U=`${u(g)}px 0`,D={offset:y+B,maskPosition:U};p.push(D)}if(c>0&&g<0){const B=Math.abs(g)*v,U=`${u(c)}px 0`,D={offset:y+B,maskPosition:U};p.push(D)}const A=`${u(c)}px 0`,b={offset:x,maskPosition:A};p.push(b),g=c,y=x};d();let m=0;this.splittedWords.forEach((_,x)=>{{const E=_.startTime-this.lyricLine.startTime,v=E-m;f+=v/i,v>0&&d(),m=E}{const E=_.endTime-_.startTime;f+=E/i,c+=_.width,x===0&&(c+=s*1.5),x===this.splittedWords.length-1&&(c+=s*.5),E>0&&d(),m+=E}});for(const _ of t.maskAnimations)_.cancel();try{const _=r.animate(p,{duration:i||1,id:`fade-word-${t.word}-${e}`,fill:"both"});_.pause(),t.maskAnimations=[_]}catch(_){console.warn("应用渐变动画发生错误",p,i,_)}}})}getElement(){return this.element}setTransform(i=this.top,t=this.scale,e=1,r=0,s=!1,n=0){super.setTransform(i,t,e,r,s,n);const a=this.isInSight,o=this.lyricPlayer.getEnableSpring();this.top=i,this.scale=t,this.delay=n*1e3|0;const h=this.element.children[0];if(h.style.opacity=`${e}`,s||!o)if(this.blur=Math.min(32,r),this.lineTransforms.posY.setPosition(i),this.lineTransforms.scale.setPosition(t),o)this.rebuildStyle();else{const l=this.isInSight;a||l?this.show():this.hide()}else if(this.lineTransforms.posY.setTargetPosition(i,n),this.lineTransforms.scale.setTargetPosition(t),this.blur!==Math.min(32,r)){this.blur=Math.min(32,r);const l=r.toFixed(3);this.element.style.filter=`blur(${l}px)`}}update(i=0){if(this.lyricPlayer.getEnableSpring())if(this.lineTransforms.posY.update(i),this.lineTransforms.scale.update(i),this.isInSight?this.show():this.hide(),this.lyricPlayer.getEnableSpring())this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,this.lineTransforms.scale.getCurrentPosition()/100-.97)/.03)*.2+.2}`);else{const t=window.getComputedStyle(this.element).transform,e=Cm(t);this.element.style.setProperty("--bright-mask-alpha",`${Math.max(0,Math.min(1,(e-.97)/.03))*.8+.2}`),this.element.style.setProperty("--dark-mask-alpha",`${Math.max(0,Math.min(1,(e-.97)/.03))*.2+.2}`)}}_getDebugTargetPos(){return`[位移: ${this.top}; 缩放: ${this.scale}; 延时: ${this.delay}]`}get isInSight(){var i;const t=this.lineTransforms.posY.getCurrentPosition(),e=((i=this.lyricPlayer.lyricLinesSize.get(this))==null?void 0:i[1])??0,r=t+e,s=this.lyricPlayer.size[1];return!(t>s+e||r<-e)}disposeElements(){var i,t;for(const e of this.splittedWords){for(const r of e.elementAnimations)r.cancel();for(const r of e.maskAnimations)r.cancel();for(const r of e.subElements)r.remove(),(i=r.parentNode)==null||i.removeChild(r);e.elementAnimations=[],e.maskAnimations=[],e.subElements=[],e.mainElement.remove(),(t=e.mainElement.parentNode)==null||t.removeChild(e.mainElement)}this.splittedWords=[]}dispose(){this.disposeElements(),this.lyricPlayer.resizeObserver.unobserve(this.element),this.element.remove()}};class Fm extends MouseEvent{constructor(t,e,r){super(`line-${r.type}`,r),this.lineIndex=t,this.line=e}}class Pm extends mm{constructor(){super(),R(this,"currentLyricLineObjects",[]),R(this,"supportPlusLighter",CSS.supports("mix-blend-mode","plus-lighter")),R(this,"supportMaskImage",CSS.supports("mask-image","none")),R(this,"innerSize",[0,0]),R(this,"onLineClickedHandler",t=>{const e=new Fm(this.lyricLinesIndexes.get(t.line)??-1,t.line,t);this.dispatchEvent(e)||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}),R(this,"_baseFontSize",Number.parseFloat(getComputedStyle(this.element).fontSize)),this.onResize(),this.element.classList.add("amll-lyric-player","dom"),this.disableSpring&&this.element.classList.add(Tt.disableSpring)}onResize(){const t=getComputedStyle(this.element);this._baseFontSize=Number.parseFloat(t.fontSize),this.rebuildStyle()}_getIsNonDynamic(){return this.isNonDynamic}get baseFontSize(){return this._baseFontSize}rebuildStyle(){}setWordFadeWidth(t=.5){super.setWordFadeWidth(t);for(const e of this.currentLyricLineObjects)e.updateMaskImageSync()}setLyricLines(t,e=0){super.setLyricLines(t,e),this.hasDuetLine?this.element.classList.add(Tt.hasDuetLine):this.element.classList.remove(Tt.hasDuetLine),this.supportMaskImage||this.element.style.setProperty("--amll-player-time",`${e}`);for(const r of this.currentLyricLineObjects)r.removeMouseEventListener("click",this.onLineClickedHandler),r.removeMouseEventListener("contextmenu",this.onLineClickedHandler),r.dispose();this.currentLyricLineObjects=this.processedLines.map((r,s)=>{const n=new Lm(this,r);return n.addMouseEventListener("click",this.onLineClickedHandler),n.addMouseEventListener("contextmenu",this.onLineClickedHandler),this.element.appendChild(n.getElement()),this.lyricLinesIndexes.set(n,s),this.lyricLineElementMap.set(n.getElement(),n),n}),this.setLinePosXSpringParams({}),this.setLinePosYSpringParams({}),this.setLineScaleSpringParams({}),this.calcLayout(!0)}pause(){super.pause(),this.element.classList.remove("playing"),this.interludeDots.pause();for(const t of this.currentLyricLineObjects)t.pause()}resume(){super.resume(),this.element.classList.add("playing"),this.interludeDots.resume();for(const t of this.currentLyricLineObjects)t.resume()}update(t=0){if(!this.initialLayoutFinished||(super.update(t),this.supportMaskImage||this.element.style.setProperty("--amll-player-time",`${this.currentTime}`),!this.isPageVisible))return;const e=t/1e3;this.interludeDots.update(t),this.bottomLine.update(e);for(const r of this.currentLyricLineObjects)r.update(e)}dispose(){super.dispose(),this.element.remove();for(const t of this.currentLyricLineObjects)t.dispose();this.bottomLine.dispose(),this.interludeDots.dispose()}}Vi(.2,.4,.58,1);Vi(.3,0,.58,1);window.lyrics=lc;const Dt=document.createElement("audio");Dt.volume=.18;Dt.preload="auto";const dt={lyric:new URL(location.href).searchParams.get("lyric")||"",music:new URL(location.href).searchParams.get("music")||"",album:new URL(location.href).searchParams.get("album")||"",enableSpring:!0,bgFPS:60,bgMode:new URL(location.href).searchParams.get("bg")||"mg",bgScale:1,bgFlowSpeed:2,bgPlaying:!0,bgStaticMode:!0,currentTime:0,enableBlur:!0,playing:!1,async mockPlay(){this.playing=!0;const i=Date.now(),t=this.currentTime*1e3;for(;this.playing&&this.currentTime<300;){const e=Date.now()-i;this.currentTime=(t+e)/1e3,Nn.updateDisplay(),Ct.setCurrentTime(t+e),await Nm()}},play(){this.playing=!0,Dt.load(),Dt.play()},pause(){this.playing=!1,Dt.paused?(Dt.play(),Ct.resume()):(Dt.pause(),Ct.pause())},fadeWidth:.5,lineSprings:{posX:{mass:1,damping:10,stiffness:100,soft:!1},posY:{mass:1,damping:15,stiffness:100,soft:!1},scale:{mass:1,damping:20,stiffness:100,soft:!1}}};dt.lyric="./assets/lyrics.ttml";dt.album="./assets/ブルーアーカイブ「優しさの記憶」.jpg";dt.music="./assets/鹿乃 - 優しさの記憶 (温柔的回忆).flac";function mu(i){if(window.globalBackground?.dispose(),i==="pixi")window.globalBackground=Pi.new(Gp);else if(i==="mg")window.globalBackground=Pi.new(Dp);else throw new Error("Unknown renderer mode");const t=window.globalBackground;t.setFPS(dt.bgFPS),t.setRenderScale(dt.bgScale),t.setStaticMode(dt.bgStaticMode),t.getElement().style.position="absolute",t.getElement().style.top="0",t.getElement().style.left="0",t.getElement().style.width="100%",t.getElement().style.height="100%",t.setAlbum(dt.album)}Dt.src=dt.music;Dt.load();const $t=new kn;$t.hide();$t.close();$t.title("AMLL 歌词测试页面");$t.add(dt,"lyric").name("歌词文件").onFinishChange(async i=>{Ct.setLyricLines(On(await(await fetch(i)).text()).lines.map(yu))});$t.add(dt,"music").name("歌曲").onFinishChange(i=>{Dt.src=i});$t.add(dt,"album").name("专辑图片").onFinishChange(i=>{window.globalBackground.setAlbum(i)});const br=$t.addFolder("背景");br.add(dt,"bgPlaying").name("播放").onFinishChange(i=>{i?window.globalBackground.resume():window.globalBackground.pause()});br.add(dt,"bgMode",["pixi","mg"]).name("背景渲染器").onFinishChange(i=>{mu(i)});br.add(dt,"bgScale",.01,1,.01).name("分辨率比率").onChange(i=>{window.globalBackground.setRenderScale(i)});br.add(dt,"bgFPS",1,60,1).name("帧率").onFinishChange(i=>{window.globalBackground.setFPS(i)});br.add(dt,"bgFlowSpeed",0,10,.1).name("流动速度").onFinishChange(i=>{window.globalBackground.setFlowSpeed(i)});br.add(dt,"bgStaticMode").name("静态模式").onFinishChange(i=>{window.globalBackground.setStaticMode(i)});{let i=function(e,r,s){const n=t.addFolder(e);n.close(),n.add(r,"mass").name("质量").onFinishChange(s),n.add(r,"damping").name("阻力").onFinishChange(s),n.add(r,"stiffness").name("弹性").onFinishChange(s),n.add(r,"soft").name("强制软弹簧（当阻力小于 1 时有用）").onFinishChange(s)};const t=$t.addFolder("歌词行动画/效果");t.add(dt,"fadeWidth",0,10,.01).name("歌词渐变宽度").onChange(e=>{Ct.setWordFadeWidth(e)}),t.add(dt,"enableBlur").name("启用歌词模糊").onChange(e=>{Ct.setEnableBlur(e)}),t.add(dt,"enableSpring").name("使用弹簧动画").onChange(e=>{Ct.setEnableSpring(e)}),i("水平位移弹簧",dt.lineSprings.posX,()=>{Ct.setLinePosXSpringParams(dt.lineSprings.posX)}),i("垂直位移弹簧",dt.lineSprings.posY,()=>{Ct.setLinePosYSpringParams(dt.lineSprings.posY)}),i("缩放弹簧",dt.lineSprings.scale,()=>{Ct.setLineScaleSpringParams(dt.lineSprings.scale)})}const Zn=$t.addFolder("音乐播放器"),Nn=Zn.add(dt,"currentTime").min(0).step(1).name("当前进度").onChange(i=>{Dt.currentTime=i,Ct.setCurrentTime(i*1e3,!0)});Zn.add(dt,"play").name("加载/播放");Zn.add(dt,"pause").name("暂停/继续");const Ct=new Pm;Ct.addEventListener("line-click",i=>{const t=i;i.preventDefault(),i.stopImmediatePropagation(),i.stopPropagation(),console.log(t.line,t.lineIndex),Dt.currentTime=t.line.getLine().startTime/1e3});const Me=new Sc;Me.showPanel(0);Me.dom.style.display="none";document.body.appendChild(Me.dom);let fi=-1;const gu=i=>{if(Me.end(),fi===-1&&(fi=i),!Dt.paused){const t=Dt.currentTime*1e3|0;dt.currentTime=t/1e3|0,Nn.max(Dt.duration|0),Nn.updateDisplay(),Ct.setCurrentTime(t)}Ct.update(i-fi),fi=i,Me.begin(),requestAnimationFrame(gu)};requestAnimationFrame(gu);window.globalLyricPlayer=Ct;const Nm=()=>new Promise(i=>requestAnimationFrame(i)),pi=(i,t,e)=>({words:i.words.map(r=>({obscene:!1,...r})),startTime:i.words[0]?.startTime??0,endTime:i.words[i.words.length-1]?.endTime??Number.POSITIVE_INFINITY,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:!1}),yu=i=>({...i,words:i.words.map(t=>({obscene:!1,...t}))});async function Om(){const i=dt.lyric,t=await(await fetch(i)).text();if(i.endsWith(".ttml")){const e=On(t).lines.map(yu);console.log(e),Ct.setLyricLines(e)}else if(i.endsWith(".lrc"))Ct.setLyricLines(ah(t).map(pi));else if(i.endsWith(".yrc"))Ct.setLyricLines(lh(t).map(pi));else if(i.endsWith(".lys"))Ct.setLyricLines(oh(t).map(pi));else if(i.endsWith(".qrc"))Ct.setLyricLines(hh(t).map(pi));else if(i==="bug"){const e=(s,n=1e3,a={})=>{let o=n;const h=[];for(const l of s.split("|")){const[u,c]=l.split(","),f=o+Number.parseInt(c);h.push({word:u,startTime:o,endTime:f,obscene:!1}),o=f}return{startTime:n,endTime:o+3e3,translatedLyric:"",romanLyric:"",isBG:!1,isDuet:!1,words:h,...a}},r=[e("Apple ,750|Music ,500|Like ,500|Ly,400|ri,500|cs ,250",1e3),e("BG ,750|Lyrics ,1000",2e3,{isBG:!0}),e("Next ,1000|Lyrics,1000",2500,{})];Ct.setLyricLines(r)}}(async()=>{mu(dt.bgMode),Dt.style.display="none";const i=document.getElementById("player");i&&(i.appendChild(Dt),i.appendChild(window.globalBackground.getElement()),i.appendChild(Ct.getElement())),dt.enableSpring||Ct.setEnableSpring(!1),await Om(),document.addEventListener("click",()=>{dt.play()},{once:!0}),$t.domElement.style.display="none",Me.dom.style.display="none",document.addEventListener("keydown",s=>{if(s.shiftKey&&s.key.toLowerCase()==="d"){const n=$t.domElement.style.display==="none";$t.domElement.style.display=n?"block":"none",Me.dom.style.display=n?"block":"none"}});let t=0,e=0;document.addEventListener("touchend",s=>{const n=s.changedTouches[0],a=window.innerWidth,o=window.innerHeight,h=n.clientX,l=n.clientY;if(h>a-200&&l>o-200){const u=Date.now();if(u-e<800?t++:t=1,e=u,t>=5){t=0;const c=$t.domElement.style.display==="none";$t.domElement.style.display=c?"block":"none",Me.dom.style.display=c?"block":"none"}}else t=0});const r=document.getElementById("playPrompt");r&&setTimeout(()=>r.style.display="flex",150)})();const rh=document.getElementById("playPrompt"),ih=document.getElementById("playButton");function Bm(){dt.play(),rh&&(rh.style.display="none")}ih&&ih.addEventListener("click",Bm);
